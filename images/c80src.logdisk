ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее EXEC    C     (              CTRACE  C                    MAKECLIBSUB                   PRINTF  C     0	
              EXTLIB  REL   %              COMMAND C                     TAB     C                     TOUPPER C                     SEEK    C     /              COMP    SUB                   STRCMP  C                     ISALPHA C                     PAGE0   ASM                   GETLINE C                     LCOM    SUB                   TPRINTF C                    MIN     C                     ATOI    C                     FPRINTF REL                  SCANF   REL    !               STDLIB  C     L"#$%&            LONGLIB ASM   $'()              STRCAT  C     *                STDIO   H     +,               EXTLIB  ASM  -./0123456       STRCPY  C     7                FSCANF  C     F89:;<            MATHLIB C     *=>?              UNLINK  C     @                FPRINTF C     =ABCD             FIXMSOFTASM   E                ITOA    C     F                ISLOWER C     G                ISDIGIT C     H                LPRL    SUB   I                CPROF   C     !JKL              LGFLTLIBASM   MN               ALLFRE  C     O                CMP     C     
P                MAX     C     Q                SCANF   C     FRSTUV            ISSPACE C     W                STDLIB  ASM   \XYZ[\]           FLOATLIBASM   b^_`abcd          TREE    C     e                STRLEN  C     f                INDEX   C     g                ABS     C     h                STDIOX  H     ij               DIEI    ASM   k                MAKESTDLSUB   l                RENAME  C     m                MAKFCB  C     n                CLIBMATHASM   op               DELETE  C     q                CLIBIO  ASM  .rstuvwxyz{|      COMPSTDLSUB   	}                TOLOWER C     ~                FLIB    IRL  ЂЃ‚ѓ„…†‡€       ISUPPER C     ‰                BDOS    C     Љ               ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* exec: function to chain to another C-generated com file, with     (1/15/84)
/*	 text argument passing.
/* Calling sequence:
/*	 exec(prog, args);
/*	 char *prog, *args;
/* where
/*	 prog is the name of the program being executed next
/*	 args is a pointer to a string of arguments separated by
/*	   blanks or tabs.  Embedded blanks within the arguments are
/*	   not allowed, unless the called program does not use the
/*	   default FCB parameters (and most don't) and can parse the
/*	   command line parameter list itself (like C80 programs can).
*/
exec(prog,args)
char *prog,*args;
{
#asm
	JMP @exec
;
;	CP/M memory pointers
;
@BASE	EQU 0000H	;either 0 or 4200h for CP/M systems
@FCB	EQU @BASE+5CH	;default file control block
@TBUFF	EQU @BASE+80H	;sector buffer
@BDOS	EQU @BASE+5	;bdos entry point
@TPA	EQU @BASE+100H	;transient program area
@ERRV	EQU 255 	;error value returned by bdos calls
;
;	CP/M BDOS CALL MNEMONICS
;
@OPENC	EQU 15		;open a file
@READS	EQU 20		;read a sector (sequential)
@SDMA	EQU 26		;set dma
;
;	Argument pointers
;
@ARGS:	DS 0
@ARG1:	DS 2
@ARG2:	DS 2
@ARG3:	DS 2
@ARG4:	DS 2
@ARG5:	DS 2
@ARG6:	DS 2
;
@exec:	LXI H,4
	DAD SP
	MOV E,M
	INX H
	MOV D,M 	;DE points to program name now
	LXI H,-60
	DAD SP		; compute &newfcb for use here
	PUSH H		; save for much later (will pop into bc)
	PUSH H		;make a few copies for local use below
	PUSH H
#endasm
	x_fcb();	/* set up com file for exec-ing */
#asm
	POP H		;get new fcb addr
	LXI B,9 	;set extension to com
	DAD B
	MVI M,'C'
	INX H
	MVI M,'O'
	INX H
	MVI M,'M'
	POP D		;get new fcb addr again
	MVI C,@OPENC	;open the file for reading
	CALL @BDOS
	CPI @ERRV
	JNZ @NOERR
	POP H		;if can't (like it doesn't exist), return -1
	LXI H,-1
	RET
@NOERR: LXI H,4 	;get args pointer
	DAD SP
	MOV A,M 	;HL = *HL
	INX H
	MOV H,M
	MOV L,A
	CALL @SPARG	;separate them into individual strings
	LHLD @ARG1
	MOV A,H
	ORA L
	JNZ @EXCL0
	LXI D,@ARG1	;no arguments -- create a blank FCB
	PUSH D		;call x?fcb with null string
	LXI H,@FCB
#endasm
	x_fcb();	/* */
#asm
	POP H
	JMP @EXCL6

@EXCL0: XCHG
	LXI H,@FCB
#endasm
	x_fcb();	/* stick first param into default FCB slot */
#asm
	LHLD @ARG2	;and stick second param string
	MOV A,H
	ORA L
	JNZ @EXCL6
	LXI H,@ARG2

@EXCL6: XCHG		;into second default fcb slot
	LXI H,@FCB+16
#endasm
	x_fcb();
#asm
	LXI D,@TBUFF+1	 ;now construct command line:
	LXI H,4
	DAD SP		;HL points to arg string pointer
	MOV A,M
	INX H
	MOV H,M
	MOV L,A
	MVI B,0 	;char count for com. line buf.
	MOV A,H 	;are there any arguments?
	ORA L
	JZ @EXCL9
	ORA M		; (Bug fix 7/83 WB)
	JNZ @EXCL5
@EXCL9: STAX D		;no--zero TBUFF and TBUFF+1
	JMP @EXCL2
@EXCL5: MVI A,' '	;yes--start buffer off with a ' '
	STAX D
	INX D
	INR B
@EXCL1: MOV A,M 	;now copy argument string to command line
	CPI 'a' 	;make sure it's upper case
	JM @EXCL8
	SUI 'a'-'A'
@EXCL8: STAX D
	INX D
	INX H
	INR B
	ORA A
	JNZ @EXCL1
	DCR B

@EXCL2: LXI H,@TBUFF	;set length of command line
	MOV M,B 	;at location tbuff

	LXI D,@CODE0	;copy loader down to end of tbuff
	LXI H,@TPA-42
	MVI B,42	;length of loader
@EXCL4: LDAX D
	MOV M,A
	INX D
	INX H
	DCR B
	JNZ @EXCL4

	POP B			;get back working fcb pointer
	LHLD @BASE+6
	SPHL
	LXI H,@BASE
	PUSH H			;set base of ram as return addr
	JMP @TPA-42		;(go to `CODE0:')
;
; THIS LOADER CODE IS NOW: 42 BYTES LONG.
;
@CODE0: LXI D,@TPA		;destination address of new program
@CODE1: PUSH D			;push dma addr
	PUSH B			;push fcb pointer
	MVI C,@SDMA		;set dma address for new sector
	CALL @BDOS
	POP D			;get pointer to working fcb in de
	PUSH D			;and re-push it
	MVI C,@READS		;read a sector
	CALL @BDOS
	POP B			;restore fcb pointer into bc
	POP D			;and dma address into de
	ORA A			;end of file?
	JZ @TPA-8		;if not, get next sector (goto `CODE2:')
	MVI C,@SDMA		;reset dma pointer
	LXI D,@TBUFF
	CALL @BDOS
	JMP @TPA		;and go invoke the program

@CODE2: LXI H,80H		; bump dma address
	DAD D
	XCHG
	JMP @TPA-39		;and go loop (at CODE1)
;
; this routine takes the string pointed to by HL,
; seperates it into non-white strings,
; and places them contiguously in array ARGST.
; also places pointers to these individual strings in ARGS
;
@SPARG: XCHG		;DE = original string
	LXI B,@ARGST	;BC = new string (w/ each substr 0-terminated)
	LXI H,@ARGS	;HL = pointer to ARGS space
@SEP0:	DCX D
@SEP1:	INX D		;scan over white space
	LDAX D
	CPI ' '
	JZ @SEP1
	CPI 9
	JZ @SEP1
	CPI 0		; char = 0?
	JZ @SPRET	; yes -- return
	MOV M,C 	; no -- store local pointer at proper args
	INX H
	MOV M,B 	;argsn = BC
	INX H
@TOWSP: STAX B		;store non-white
	INX B
	INX D		;now scan to next white space
	LDAX D
	CPI 0
	JZ @SEP2
	CPI ' '
	JZ @SEP2
	CPI 9
	JNZ @TOWSP
@SEP2:	XRA A
	STAX B		;store 0 to terminate this string
	INX B
	JMP @SEP0	; and loop
@SPRET: MOV M,A 	;set last argn to 0 and return
	INX H
	MOV M,A
	RET
@ARGST: DS 100
#endasm
}
r RMAC */
}
(CP/M always terminates on 0) */
#endif
$A7:	MOV	A,M		/* Skiееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*TRACE ROUTINE FOR C/80.  TO USE, ASSEMBLE THIS FILE		(1/16/84)
  TO A:CPROF.ASM, AND COMPILE AND ASSEMBLE THE C
  PROGRAM WITH THE -P COMPILER OPTION.
  FOR MACRO-80 COMPATIBILITY, ASSEMBLE AND LINK THIS.  */
CALL_() {
#asm
	POP H		;GET CALLING ADDRESS
	INX H		;COMPUTE REAL RETURN ADDRESS
	INX H
	INX H
	INX H
	PUSH H		;AND REPLACE IT
	PUSH B
	PUSH D
	DCX H
	DCX H
	DCX H
	MOV D,M 	;GET ROUTINE CALLED
	DCX H
	MOV E,M
	PUSH D		;SAVE CALLED ROUTINE.
	XCHG		;CHECK FOR 6 BLANK BYTES
	MVI B,6
	XRA A
CALL6:	DCX H		;(IF NOT, IT IS A
	CMP M		;SYSTEM RTN WITH NO
	JNZ CALL7	;NAME.)
	DCR B
	JNZ CALL6
CALL1:	DCX H		;BACK UP OVER NAME.
	CMP M
	JZ CALL2
	INR B
	JMP CALL1
CALL2:	INX H
	MOV A,B
	ORA A
	JZ CALL7
	CPI 8
	JNC CALL7
	PUSH H		;SAVE NAME ADDR
	LXI H,CALL3
	CALL CALL@O	;OUTPUT 'CALLING'
	POP H
	CALL CALL@O
	LXI H,CALL4
	CALL CALL@O
CALL7:	POP H		;RESTORE CALLED ROUTINE ADDRESS
	POP D		;RESTORE BC & DE PAIRS
	POP B
	PCHL		;GO TO CALLED ROUTINE
	
CALL3:	DB 'Calling ',0
CALL4:	DB 12Q,0
CALL5:	DB ' returns BCDE,HL = ',0
CALL@O: MOV A,M 	;OUTPUT BYTES
	ORA A		;UNTIL
	RZ		;A ZERO BYTE
	MOV E,A
	MVI D,0
	PUSH H
	PUSH D
	CALL putchar
	POP D
	POP H
	INX H
	JMP CALL@O
#endasm
}

RET_() {
#asm
	XTHL		;SAVE RETURN VALUE
	PUSH D		;SAVE FLOATING REG IF USED (DE FIRST)
	PUSH B
	MOV E,M 	;GET ADDRESS OF
	INX H		;ROUTINE RETURNING.
	MOV D,M
	LXI H,-6	;GET NAME
	DAD D
	XRA A		;BACK OVER NAME
RET1:	DCX H
	CMP M
	JNZ RET1
	INX H
	CALL CALL@O	;OUTPUT IT
	LXI H,CALL5
	CALL CALL@O
	POP H		;OUTPUT BC
	PUSH H
	CALL O@HEX
	POP B		;OUTPUT DE
	POP H
	PUSH H
	PUSH B
	CALL O@HEX
	LXI H,2CH	;OUTPUT SEPARATOR
	PUSH H
	CALL putchar
	POP H
	POP B
	POP D
	POP H		;OUTPUT HL
	PUSH H
	PUSH D
	PUSH B
	CALL O@HEX
	LXI H,CALL4
	CALL CALL@O
	POP B
	POP D
	POP H		;RESTORE VALUE
	RET		;REALLY RETURN

O@HEX:	MVI B,4 	;OUTPUT 4 HEX DIGITS FROM HL
O@H1:	MOV A,H 	;OUTPUT FROM HIGH NYBBLE OF HL
	RAR
	RAR
	RAR
	RAR
	ANI 17Q 	;CONVERT TO HEX
	ADI 220Q
	DAA
	ACI 100Q
	DAA
	MOV C,A
	PUSH H
	PUSH B
	CALL putchar	;OUTPUT IT
	POP B
	POP H
	DAD H		;SHIFT HL LEFT 4
	DAD H
	DAD H
	DAD H
	DCR B
	JNZ O@H1
	RET
#endasm
	putchar();	/* To declare external */
}

	LXI B,@ARGST	;BC = new string (w/ each substr 0-terminated)
	LXI H,@ARGS	;HL = pointer to ARGS space
@SEP0:	DCX D
@SEP1:	INX D		;scan over white space
	LDAX D
	CPI ' '
	JZ @SEP1
	CPI 9
	JZ @SEP1
	CPI 0		; char = 0?
	JZ @SPRET	; yes -- return
	ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееLIB C80ILIB[I]=INITNET,DIEI,PRINTF,SCANF,STDLIB0,CLIBMATH,CLIBIO,PAGE0

	LXI H,2CH	;OUTPUT SEPARATOR
	PUSH H
	CALL putchar
	POP H
	POP B
	POP D
	POP H		;OUTPUT HL
	PUSH H
	PUSH D
	PUSH B
	CALL O@HEX
	LXI H,CALL4
	CALL CALL@O
	POP B
	POP D
	POP H		;RESTORE VALUE
	RET		;REALLY RETURN

O@HEX:	MVI B,4 	;OUTPUT 4 HEX DIGITS FROM HL
O@H1:	MOV A,H 	;OUTPUT FROM HIGH NYBBLE OF HL
	RAR
	RAR
	RAR
	RAR
	ANI 17Q 	;CONVERT TO HEX
	ADI 220ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* printf.c: library file for format, fformat, and printf
 * compile: c -l32000
 * J. J. Gillogly, Apr 80
 * sprintf added J. J. Gillogly, Jul 80
 * Modified Jan 82 to work with #define kludge for multiple printf args
 * %u and unsigned octal and hex added WB Feb 82
 * long and floating descriptors added HT Apr 83
 * Split for float/nonfloat and long/nonlong versions WB 5/25/83.
 * Fix floating precision default, %3c, %% WB 11/15/83.
 * Fix for unsigned chars WB 12/26/83.
 * Fix for I/O redirection John Toscano 4/17/84.
 */

#undef printf
#undef fprintf
#undef sprintf

static int *prnt_p,	/* Pointer into printf arglist */
	    Pfo;	/* Channel number for output */
static char *Pf = "",	/* current location in user's format */
	    *Pst;	/* current location in user's output string */
static int Width;	/* minimum field width */
static int Pr;		/* precision */
static int ch;		/* really char but int is more efficient */
static char Pad;
static int ljust;	/* left-adjust flag */
static char *nbp,*nbpe; /* pointer to ascii converted number */

/* define functions to reduce entry points */
static Ps(),Pc(),getnum(),putsi(),putui(),putfld(),putpad(),hexdig();
static char *ocvti();

#define int_typ int
#define uns_typ unsigned

#define NBS 80

/* prnt_1 is used to mark the position of
   the printf argument list on the stack.
   Visually, the arguments, starting with the format string, will
   be stacked right below the marked position (prnt_p). The
   stacked arguments are values !!! (16- or 32-bits)
*/
prnt_1(firstarg) { prnt_p = &firstarg; }	/* Record arglist start */

prnt_2(lastarg) {
	format (*--prnt_p);			/* Process arglist */

#asm
@prnt@: DS	0
#endasm

/* now we are going to print the values. Instead of passing to printf
   the value to print (of unknown type), we pass the current pointer
   to the argument list. It is the responsibility of "printf" to
   retrieve the value physically located at prnt_p - 2 (if 16-bit) or
   prnt_p - 4 (if 32-bit). "printf" must also update prnt_p accordingly.
*/
	while (prnt_p > &lastarg) printf(prnt_p); }

prnt_3(lastarg) {
	Pfo = *--prnt_p;	
	fformat(Pfo,*--prnt_p);

#asm
	JMP	@prnt@
#endasm
/*	while (prnt_p > &lastarg) printf(prnt_p);	*/
}

prnt_4(lastarg) {	
	Pst = *--prnt_p;
	sformat(Pst,*--prnt_p);

#asm
	JMP	@prnt@
#endasm
/*	while (prnt_p > &lastarg) printf(prnt_p);	*/
}

format(form)
char *form;
{	extern fout;
	fformat(fout,form);
}

fformat(chan,form)
char *form;
{	Pfo = chan;
	Pf = form;
	Ps();
}

sformat(string,form)	/* user wants data to go to a string */
char *string,*form;
{	Pst = string;
	fformat(-2,form);/* illegal value for a channel */
}

static Ps()    /* output format up to next % */
{	while (*Pf != 0 && *Pf != '%') Pc(*Pf++);
}

static Pc(c)
char c;
{	if (Pfo == -2) {
		*Pst++ = c;
		*Pst = 0;	/* terminate each intermediate string */
		return; }
	putc(c,Pfo);
}

printf(arg)	/* print one arg using current format */
union {
	int *ival;
	} arg;
	{
		static int racine,realPr;
		static unsigned int uarg;
		static char *ptr,*end;

		arg.ival = prnt_p ;
		prnt_p -= 1;	/* update assuming a 16-bit value to print */
	again:	racine = Pr = 0;
		realPr = -1;

		if ((ch = *++Pf) == 0) return;
		Pad = ' ';
		if (ljust = (ch == '-')) ch = *Pf++;
		if (ch == '0') { Pad = '0'; ch = *Pf++; }
		Width = getnum();
		if (ch == '.') { ++Pf ; realPr = Pr = getnum(); }
		if ((ch = *Pf++) != 's' && Pr > 7) Pr = 7;
		switch (ch) {	/* decode the conversion type */

		case 'c':	ptr = --arg.ival;
				putfld(ptr,ptr+1); break;
		case 'd':	putsi((int_type)*--arg.ival,10); break;
		case 'o' :	racine = 8; goto p_ui;
		case 'u' :	racine = 10; goto p_ui;
		case 'x' :	racine = 16;
	p_ui:			uarg = *--arg.ival;
				putui((uns_type)uarg,racine);
				break;

		case 's' :	
				for (end = ptr = *--arg.ival; *end++; );
				if (--end - ptr > Pr && Pr) end = ptr + Pr;
				putfld(ptr,end);
				break;

		case 0	 :	return;
		default  :	Pc(ch); Ps(); goto again;
		}
		
	Ps();
}

static getnum () {
	int n;
	for (n=0; (ch = *Pf) >= '0' && ch <='9'; )
		n = 10*n + *Pf++ - '0';
	return n;
}

/* unsigned integer/long conversions to ascii. the number sn is
   converted in the specified radix sr. the ascii digits are
   generated in a buffer. the value returned is a pointer to
   the first character in the buffer.  The following routines use
   either longs or ints, depending on whether NOLONG is defined.
*/

static char *
ocvti (buflim, aln, alr)
char *buflim; uns_type aln;
	{
	static int lr;
	static uns_type ln;
	lr = alr; ln = aln;
	do {
		*--buflim = hexdig(lr == 10 ? ln % 10 : ln & (lr -1));
		ln = lr == 8 ? ln >>3 : lr == 10 ? ln/10 : ln>>4 ;
		}
	while (ln) ;
	return buflim;
}

/* Output a signed integer in the specified radix. */
static putsi(n,radix)
int_type n;	{
	char nbuf[NBS];  /* conversion buffer */
	static int_type dsn;
	dsn = n < 0 ? -n : n;
	nbp = ocvti ( nbpe = nbuf+NBS, dsn, radix);
	if (n < 0) {	if (Pad != ' ') { Pc('-'); --Width; }
			      else *--nbp = '-';
		   }
	putfld (nbp, nbpe);
}

static putui(ui,radix) /* output an unsigned integer in the specified radix */
uns_type ui;
	{
	char nbuf[NBS];  /* conversion buffer */

	nbp = ocvti (nbpe = nbuf + NBS, ui, radix);
	putfld (nbp, nbpe);
}
	
static putfld(string, end)/* output a field containing a specified string ending
			     at end. Takes care of justification and padding.
			  */
char *string,*end;
	{
	static int length;
	length = end - string;
	if (! ljust)
		putpad(Pad,length);
	while (length--) {
		Pc (*string++);
		--Width;
		}
	if (ljust) putpad(' ',0);
}

static putpad(ch,count) {
	while (Width > count) { Pc(ch); --Width; }
	}

static hexdig(c) {
	return c + (c <= 9 ? '0' : 'A' - 10); }

/* Definitions for printf and fprintf to allow multiple args. */

#define printf prnt_1(),prnt_2
#define fprintf prnt_1(),prnt_3
#define sprintf prnt_1(),prnt_4






















	if (n < 0) {	if (Pad != ' ')…‘VP DDфh		2BF@HCЃP‘ђ`T$d…X	1	BL@HCЃP“`T$Д…X ДШМКC@3216ЃР D4ИFCF@FLSЃPСђС`T4duH1CF@LTЃPСђ‘`d4dE%XiI>CL@GEЃђУУ T4ДuH11CL@LTЃђУУT dD•cE ТF@@CЃђ`DdИVF@ADDЃQђU TdХTИ9F@NOTЃ‘ђ“ХS Td5T(FADDA@Ѓ‘ђУУT Td”еD19FLOAT@ЃQ“ ddхUEDQ=HC@BFЃRР“ d„U$3(!%	HI@BLЃRP‘ T…T$И%I@@LЃ’S–ђ DД81L@@IЃ`TДDH19L@ASLЃSTФ TД4фШ1%ZL@MODЃSUS TДдTx19=RL@ORЃSХP TД„х(11=9LNEQ@4Ѓ“У‘Р dФхddФ5=YIMOVMF@Ѓ“SХ”‘ђ dФхe$Ф5U0ДБNEQ@4Ѓ”TТђ U”еDM%9SLONG@ЃХ e5tDM]AMU@@FЃP U¤U$ф	@ Цр(                ґ<^ГЈааЏЂЂL:> >іo°…ўБr€h”CO мЄn =€Шtґ ь#3Э6¬Ф Yђкyw 	м–mg yUЂk%›YА¬*ћ <dіk8 хр-dіk8аZЙfЯ`&…ўгb‘	¬ЪX! Ђм–m• iZа–Uѓ ёX.7Xµ’НІ +jК°@; ЇЃА•ѓ*С +ЦМвШn ,Ыјx[ІTnКѕАI•Е ЏlЫМлfЯ`&Eьh=Yґ\ОсfЧ  †Ђ <ЇX6Ё ґ©€ЊhМµ bа6Г °й€
Ѕ G?&Лв3тh®#?&IнКёh1«Из•»
Џ ’Љ†Syб¬8Wь^2 `ђ(¤ф+ћQдч•<«vU1Р01ЭҐD@YЃ [ї*	F~s $цц0Њ c Ђ0v¤ьѓ/€ПИўёЊь‰'ІD4 ь/;«Нй9х6_>¦ЉзФЙ=’ 5ЃЄюC-AАrcMксk т'ћѓеsШ|ѕx‘Шv†Z(“Щ,ЫlИ µРт2 А±  Ђ А†ю 9D6мКеР рЌnКІЂ.Qp >g<ґ®Ё”UAА.·кѓ "CдуР|®{—Пт8ґшВёЂ.K6у D@€  НѕАL‹6Ы3-p№юН®ЂCA ¬ь2Ў`ірК† 
ПГ* Au«ЙеrшК‡ 9X§Ч(††Ђ%њ&уг”CC О9бК!Ў`	з	uCЂАыJўЁpЕв7i0\'‘аф>ъ¦@!sШ\ѕz•П!rx¤р#ЋЁp \eCЂ+%›
Ќ9D4 jбfZђ6<-ЩV`ъ! `
д>Ё<<¬ё we^Pm;ЉЩ,Ыl/p­Ь/ЛRГў ,Ъx[ІА&е©#іmX †ЃЂ;R: `v@кЃ ?…бtы xЙ&,; D@  'њ АЩ aЯђ ?;ђvK¬U@ nQU q№]l–m	u€Ё ЂТ" @¶H†Ђ 0мАHЌ’   ` hоЃXT8’! @а8Ь>w‡Дb3№д7“ГкжIбnК¶АB~еfЫ`#Л C@ЂЗ—Г6Ј‡Х,‘б|АћWМYй|АћТМ…’ J%–m« Р0сћW/­ЩVmfСp5qќщb@ЗЙ„ѓ6ё џнК† 7*а…’=(ЗЊ [$C@АПдАкЂ 4МЪК6LЮ§ђ»6ьЂ<Y,Ыfdіm’гzЋЁPЭ…p ПГ* #xёЩ,ЪаГ№ lЪтНё L:Н­aG…»КріlрPщюхbѓЂЫЉБfЮ`"Й@ fЬP!Х [ІЇр 2 `‹6ХЂ<VпЛјГ  lЪ.лaЂ С FmuІOv '•Лм‘  yw T¬ћ$<?”*¤юL6©Р#XG9Y·Ш	›V@ААµ…SA$ўx %`0мрPюїЯм:љ! Ђv µ’x[Іe¬АЋ7(†е°иАSЌК!ёЂl:0гr€nЊ9D4,‡RBњў$Г©!NQaФђҐ{М‚Ђ,V«”CKњўP rНі+vUЦaСpFIэ,L ‡D   @!А
0 Ђ Ђ  d            !С& (Т  q  ‘  !  `   НfЂ¦ёЊтn	 ОБe№Dд«b‰Нй5щXЦvf
Н@ rН  Ј+n! ,Р  ъ2· ‚  rНі,ЫмСp№Z¬Ыlт§@ЈahЊl0eV@g+тп­А#ѕю"ІЄЁ(кЫ‚1ЂМЪаЇzіkЂ,µhClБ¶`%›K Цп+
НіаOлХ‡VЃe® ў^Ні,ЪX·pё«ш+Ґ›yА^#З«6ёЋ­А#ѕю"°¬Ш(кЫ‚3kЂ36ёЏЂ,ЪКНѕАOO[ЂG1}ьE Џ,«°
ЖЗАUАy]ЂQ°ёF:¶аЂQ°АF=eVP`#кг‚ЃЂ+nЇzЋ­ё#Фu€mИ#¬ъ¤@АWХтa_ЂQ°ёFсѕ©€3ХЉеjіh„/ТЕсй<WћSДсX­Ґ@A™µ@F#fЯ`'[„а#`°п )аzН­ АQ°№йAАЮ,ЪР:· Ћa
ўѓ
ППбѓ*њѓ?…МJс[І«(0ШК#
ЮUXl-Џ Вр#XТ« В3ЂЌЊ:;€ЖАHхр6Шu шrшX !є Ѓ–m	aЪ°L¶B KВ2і¬ьНІ`М:юЅYV|ь+eYрa[6€Ђ‘Кесy=›HБЫWФь.e] gс••oџДVФfТ0vm3fТ0vХ
0® 2Ѕ&_VњК{H=/h3Ксѓ=Y·њв<a]pf‹Е™wЂќl–CХ›gАћ#ЦKT®xD‘Ш®V«6ПЃ<ZГmp°Z,;NНјАLЫ–Бh°нXмAЃРНaЃ}‡pЃ„gзрй ю2©;ш`?Y!WтЎђюІЏб[!ь§d
Щ2Ф0q 9?(Лв3т€®#?(Iв3тЂЋбЊЬl•zБbІaXђu›*ВѓћЯВ•‰ P е^~[ј«И8Ьь;ЉА¬*тaVАwE‚йЃ@“тЬ| yYPqиwЃXV\‡aAХлЉЙ…qБЦl«
{WЂЂ•yш.wЃXVа:В¶ м;
!Ђ*ц•dЛtД @6т€@ +6Ѓ„8^¬ЫкВЅ псx€@@•сґX,Ёµ’! ·ђ$B 0оИ8„ џ’eсщ4Wџ“$сшРgLЮ§ЕkКђ„<Gм—‹%“-$bµB  UЄ@аКјь;ЉА¬*dТЄA ` „ єД   е^GВb0+
¤„@Ђ)рr¶aV@Ѓ…VuШ ‚Ђ•yш.wЃXU¬!‡JВ Ђ дј#+Дb3ЊдС`€A Ле’. 0мђ@ёеbµOw•џfХ`‘уэк!  ®QpDrF“…eaYyЉХ<-ЮVм!›U‚GПс$ 9WД  •К>=D ` е^‚зq…t Р еЦ!	Ђ  4ѕm_0†т†А¬+ИЅD @ ев‚зq…+vU	„ —X„ «Э`` i<„А¬*,с°®@@„$ џ–м*‚! .±  9uЃЂ‡ађЊ&aSђ‘4 9?-Я•X%ўБ„ —Л„f3qІ\¬P ! *уКxо#°« KВЙЂЂ“тМѕ#?,Љв3тДћ#?,м:ў! 'еY|F~UДgеI<F~TШuD%“-	/КВ2pЊЊ#dёЩ¶`%Жsњ„gБ’бbѓЂ,;rбbѓЂW(„ єД ` д/„a6Х	°®0JЅ‡uВGАEўСq‰Ђ
“{$B OЗ2шЊьr+€ПЗxЊьp#ІO’Н’! Ђ·Ф%Ђ-dЛ@ВњnQp
aСЂ§”CZВt`)ЖеЧђ¦+UК! ,Ы0бj„i`SUК`4ІD Ђ е›i‚\-%К!±!L:’еШp¦I
r€l8SЄе‚Ђ–m	pіkHQљ! %бXFНґБ-…вЙtІe­aN°  Й>іlQt®O#ІOЊЫл'‘Щ+qуэр<dєЩ.¶dЛc‚™¶x)ВгєЬ.3к$ћ|DЩ#аLѕ> &Љгаdћ> &м“Шјѕz•П"тyа^GdЗaў
ўz4t\Ў# !&GBБ*2BtHЎ# $$ЗDЃ*2B¬wXЎ& !#GbBЄbBv*Ў& $$ЗaВЄbB¬t`+! ›™GRBІ™‘‰ґuё!  #G@ВўduдЎЈ "ЁЗ`Ђ222bњuhЎЈ #ўЗX@*2:¤u$ЎЈ &"ЗT@*2b¤v$ЎЈ '"З`А22ў’¬vT!Ј -)'ЗAкb:,wd!¦ #¦*GuЃкb:¤wЬЎ¦ &"Зtкbb¤vд'!§¦Ё GyАr"J±‰‚vё&"Ё G_Ѓ"2v0#  $ЗeБ"2dv#  *ЗCА*2
"$ttЈ "$«GF *2jЄduЈ '"ЈЗVБ*2rz¤uА# )'Є§GDА*2љЄv¬Ј ў" GT r2
""
t°#!§¦Ё GV@к2Jrўwx#&'"Ј GrАІ2bz
ўuЊЈ&* GZІ2zЄўўt4#*' Зq кB4uА*¤! !&GKІB*’™”w(¤$ !#G^BЄBJdwL¤* !#GZВЄBЄdu$  #GDВўJdt$§,$) GMВўbvL&  #GQBўbLtш*&  *ЗdBЄb
"$u¦  §"Ghкb
љdul¦  ©©GkВЄbzlv@"¦ "$«GbВ*bjz$tђ"¦ &Є¦Gg‚Єbr*<wи&¦ ''ЄGZВbbz”v8*¦ )ЄЎG`BjbВz”v`'&&'§# Gq‚rbr*Љ¤wФ'&'§# G|АІjzІ2jwШ&§«#) GB@тjzІj2t&§«)# GfrjzІ’jv|&Є¦ GmBjr*Љ¤w(*©¤# GY@кЉJrўvШ
©¤Ј§ Gi‚rљbzr:v„&)Є GxBrљє
Ѓўwђ')« Ё) G]Ѓ"Є4t,**  &GD@jТ*’zf,*Ў )¬*FDЃRBdt# N   ћeger in the specified radix */
uns_type ui;
	{
	char nbuf[NBS];  /* conversion buffer */

	nbp = ocvti (nbpe = nbuf + NBS, ui, radix);
	putfld (nbp, nbpe);
}
	
static putfld(string, end)/* output a field containing a specified string ending
			     at end. Takes care of justification and padding.
			  */
char *string,*end;
	{
	static int length;
	length = end - strinееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* command: expand wild cards in the command line.  (7/25/83)
 * usage: command(&argc, &argv) modifies argc and argv as necessary
 * uses sbrk to create the new arg list
 * NOTE: requires makfcb() and bdos() from file stdlib.c.  When used
 *	with a linker and stdlib.rel, remove the #include stdlib.c.
 *
 * Written by Dr. Jim Gillogly; Modified for CP/M by Walt Bilofsky.
 */

#define MAXFILES 255	/* max number of expanded files */
#define FNSIZE 15	/* filename: 2(A:)+8+1+3+null */

int COMnf,*COMfn,COMc,*COMv;
char *COMarg,*COMs;
static expand();

command(argcp,argvp)
int *argcp,*argvp;
{
	int f_alloc[MAXFILES];

	COMfn = f_alloc;
	COMc = *argcp;
	COMv = *argvp;
	COMfn[0] = *COMv++;		     /* Don't expand first one */
	COMnf = 1;
	for (COMarg = *COMv; --COMc; COMarg = *++COMv)
	{	for (COMs = COMarg; *COMs; COMs++)
			if (*COMs == '?' || *COMs == '*')
			{	expand();
				goto contn;  /* expand each name at most once */
			}
		COMfn[COMnf++] = COMarg;     /* no expansion */
	    contn:;
	}
	*argcp = COMnf;
	COMfn[COMnf++] = -1;
	COMv = *argvp = sbrk(2 * COMnf);
	while (COMnf--) COMv[COMnf] = COMfn[COMnf];
}

static expand() {
	char fcb[36];
	static char *p,*q;
	static int i,flg;
	makfcb(COMarg,fcb);
	if (fcb[0] == -1) fcb[0] = '?'; 	/* Check for all users */
	for (i = flg = 1; i <= 11; ++i) {	/* Expand *'s */
		if (i == 9) flg = 1;
		if (fcb[i] == '*') flg = 0;
		if (flg == 0) fcb[i] = '?'; }
	flg = 17;
	bdos(26,0x80);				/* Make sure DMA address OK */
	while ((i = bdos(flg,fcb)) != -1) {
		COMfn[COMnf++] = q = sbrk(FNSIZE);
		if (COMnf >= MAXFILES-1) {
			for (p = "Too many file names.\n"; putchar(*p++); );
			exit(0); }
		p = 0x81 + i * 32;		/* Where to find dir. record */
		if (COMarg[1] == ':' && COMarg[0] != '?') {
			*q++ = COMarg[0]; *q++ = ':'; }
		for (i = 12; --i; ) {
			if (i == 3) *q++ = '.';
			if ((*q = *p++ & 0177) != ' ') ++q; }
		*q = 0;
		flg = 18;
	}	}

/* #include "stdlib.c"	*/    /* Remove this if using linker and stdlib.rel */
/* tab - filter to insert tabs in a file wherever possible */
/* Walt Bilofsky - March 1980 */
/* Usage: tab <infile >outfile */
main() {
char line[150],*p,c,*q;
int i,j;
p=line;
while ((c=getchar()) > 0)
   if (c == '\t')
	{ do {*p++ = ' ';} while ((p-line)&7);}
   else if ((*p++ = c) == '\n') {
	*p = 0;
	p = line;
	while (*p) {
	   if (*p == ' ' && p[1] == ' ' && (((p-line)&7) != 7)) {
		q = p+1;
		while (*q++ == ' ') if (((q-line)&7) == 0) { putchar('\t');
							   p=q; goto foo; }
		}
	   putchar(*p++);
	   foo: ;
	   }
	p = line;
	}
}
f];
}

static expand() {
	char fcb[36];
	static char *p,*q;
	static int i,flg;
	makfcb(COMarg,fcb);
	if (fcb[0] == -1) fcb[0] = '?'; 	/* Check for all users */
	for (i = flg = 1; i <= 11; ++i) {	/* Expand *'s */
		if (i == 9) flg = 1;
		if (fcb[i] == '*') flg = 0;
		if (flg == 0) fcb[i] = '?'; }
	flg = 17;
	bdos(26,0x80);				/* Make sure DMA address OK */
	while ((i ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* toupper - Convert character to upper case if in [a..z].  */
toupper(c) {
/*	if ('a' <= c && c <= 'z')
		return (c - 0x20);
	return (c);			*/
#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	XRI 20H
	MOV L,A
#endasm
}

	*/
#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	XRI 20H
	MOV L,A(p-line)&7) != 7)) {
		q = p+1;
		while (*q++ == ' ') if (((q-line)&7) == 0) { putchar('\t');
							   p=q; goto foo; }
		}ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	seek.c - move to another position in an open file.  (1/28/84)
 *	Usage: seek(fdes,offset,type)
 *		  The read/write pointer for the file open on
 *		channel "fdes" is moved "offset" bytes forward
 *		or backward from:
 *			type =	0: beginning of file
 *				1: current location
 *				2: end of file
 *		If type = 3, 4 or 5, the pointer is moved "offset"
 *		records (256 bytes) instead.  Returns -1 for error, else 0.
 *		  The first version of this routine was written and
 *		contributed by Al Bolduc, 37 Catherine Av., Reading, MA.
 *		Recent fixes contributed by Rick Barnich.
 *
 *	Usage: ftell(fdes); ftellr(fdes);
 *		  Ftell returns the current offset of file fdes.  If the
 *		current position is more than 65K bytes down the file, the
 *		value returned will only be correct mod 256.  Ftellr returns
 *		the offset in records, for use on long files.
 *
 *	Change history:
 *		1/28/84:  Don't extend "r" files.  Ftell, ftellr, reopen. (RGB)
 *		7/23/83:  Ftell wrong in last CP/M sector if odd.
 *		2/24/83:  Bug in ftellr (off by 1 at byte 0).
 *		2/5/82:   Bug in ftellr (off by 1).
 *		11/14/81: Don't try to read ahead on non-update files.
 *		10/21/81: Original release.
 */
#define CPM 0		/* Defined for CP/M version; comment out for HDOS */

extern	int	IObuf[],IOind[],IOsect[];
extern	char	IOmode[],IObin[],IOrw[],IOseek[];

#ifdef CPM
extern	int	IOfcb[];
#define EOF 26		/* Ctrl-Z fills at end of file */
#define RECSIZ 128

#else
#define EOF 0		/* 0 fills at end of file */
#define RECSIZ 256
#endif

seek(fdes,offset,type) {
	static unsigned sector;
	static int byte,tmp,b,mode,rflag;
	static char *buf,*p;

	rflag = 0;
	if ((mode = IOmode[fdes]) != 'r') {
		skinit();			/* Trap writes in putc */
		if (IOind[fdes] & 255) {	/* Write current record out */
			write(fdes,IObuf[fdes],256);
			/* but don't change pos'n now; pos will later */
			IOsect[fdes] -= 256 / RECSIZ;
		}	}
	if (type > 2) { sector = offset; byte = 0; type =- 3; }
		else { sector = offset / 256;
		       byte = offset % 256; }
	switch(type) {
		case 1: sector =+ ftellr(fdes);
			byte =+ 0377 & ftell(fdes);
		case 0: doit:
			if (byte < 0) { --sector; byte =+ 256; }
			sector =+ byte >> 8;
			byte =& 255;
#ifdef CPM
			if (rflag == 0 || sector != tmp)
#endif
			 {  if (pos(sector,fdes)) return -1;
			    if (read(fdes,IObuf[fdes],256) <= 0) {
				    if (mode == 'r' || byte) return -1;
#ifndef CPM
				    for (p = 256 + (buf = IObuf[fdes]);
						p != buf; *--p = EOF);
#endif
			 }	    }
			if (byte == 0) { mode = byte = 256; }
			if (mode != 'r') {
				IOrw[fdes] = 0;
				pos(sector,fdes);
#ifdef CPM
				if (type == 2 && IObin[fdes] != 'b')
				       for (p = 256 + (buf = IObuf[fdes]),
					   rflag = 0; p != buf; buf++)
					      if (rflag) *buf = EOF;
					      else if (*buf == EOF) rflag = 1;
#endif
				}
			IOind[fdes] = byte;
			IOseek[fdes] = 1;
			return 0;
		case 2: if (offset > 0) return -1;
			b = 256;
#ifdef CPM
			tmp = pos(-1,fdes);
			if (tmp & 1) b = 128;
			tmp = (tmp + 1) >> 1;
#else
			tmp = -1 - pos(-1,fdes);
#endif
			if (IObin[fdes] != 'b') {
				/* ASCII file - find last byte */
				pos(--tmp,fdes);
				if (read(fdes,IObuf[fdes],256) <= 0) return -1;
				rflag = 1;
#ifdef CPM
				for (buf = IObuf[fdes];
						b-- && *buf != EOF; ++buf);
				b = buf - IObuf[fdes];
#else
				for (buf = IObuf[fdes] + b;
						     *--buf == EOF && b; --b);
#endif
				byte =+ b; }
			    else byte =- b & 255;
			sector =+ tmp; goto doit;
		default: return -1;
	}	}

ftell(fdes) int fdes; {
	static int _fd;
	return IOind[_fd = fdes] == 256 ?  RECSIZ * IOsect[_fd] :
		RECSIZ * (IOsect[_fd] - IOrw[_fd]) + IOind[_fd]; }

ftellr(fdes) int fdes; {
	return (IOsect[fdes] - (IOind[fdes] == 256 ? 0 : IOrw[fdes]))
							    / (256/RECSIZ); }

#ifdef CPM
static _bdos() {
#asm
	POP H
	POP D
	POP B
	PUSH B
	PUSH D
	PUSH H
	CALL 5
	MOV L,A
	RLC
	SBB A
	MOV H,A
#endasm
}
#endif

/* pos - position over sector.	HDOS: returns 0, or nr. records to
	requested sector from EOF.  CP/M: returns 0, nonzero for error, or
	if sector == -1 returns length of file in 128-byte sectors. */

pos(sector,fdes) int sector,fdes; {
	static int *p,fcb;
	static char *q,*r;
#ifdef CPM		/* CP/M version */
	q = p = 33 + (fcb = IOfcb[fdes-1]);
	if (sector == -1) {		/* Find end of file */
		_bdos(35,fcb);
		return *p; }
	*p = 2 * sector;	 /* CP/M sector numbers are double */
	q[2] = 0;		 /* Zero high byte */
	r = IObuf[fdes];
	_bdos(26,r);		 /* Set DMA address */
	if (_bdos(33,fcb) != 0) {/* Read random to set file ptr */
		*r = EOF;	 /* Put EOF there in case we have to write */
		if (IOmode[fdes] == 'r' ||	/* Don't read past end of file*/
			_bdos(34,fcb)) return -1;/*  but try writing there. */
		}
	IOsect[fdes] = 2 * sector;	   /* If success, remember where */
#else
			/* HDOS version */
#asm
	POP D
	POP H		/* Get channel in H */
	POP B		/* Get sector in B */
	PUSH B
	PUSH H
	PUSH D
	MOV A,L
	DCR A
	DB 255,39	;SCALL 047Q
	MOV H,B
	MOV L,C
	RC
#endasm
	IOsect[fdes] = sector;		/* If success, remember where */
#endif
	return 0;
}


/* Plug putc to read next sector after writing, for file in update mode */
skinit() {
	extern __PC2,uputc();
	__PC2 = uputc;
}

/* This routine replaces write() from putc() when a file has been repositioned.
 *	It reads the next record after writing.
 */
uputc(fdes,buf,cnt) int fdes; char *buf; int cnt; {
	static int i;
	static char *p;

	i = write(fdes,buf,cnt);		/* Write it */
	if (IOmode[fdes] != 'r' && IOseek[fdes] /* If write channel had seek, */
	      && read(fdes,buf,cnt)) {		/* read next sector if there */
		pos(ftellr(fdes) - 1,fdes);	/* back up */
		IOrw[fdes] = 0; 		/* and position to write it */
		}
	else for (p = buf + 256; p > buf; *--p = EOF);	/* else erase buffer */
	return i;
	}
 and position to write it */
		}
	else for (p = bui] == '*') flg = 0;
		if (flg == 0) fcb[i] = '?'; }
	flg = 17;
	bdos(26,0x80);				/* Make sure DMA address OK */
	while ((i C $1
RMAC $1 $$SZPZ
ERA $1.ASM
to read next sector after writing, for file in update mode */
skinit() {
	extern __PC2,uputc();
	__PC2 = uputc;
}

/* This routine replaces write() from putc() when a file has been repositioned.
 *	It reads the next record after writing.
 */
uputc(fdes,buf,cnt) int fdes; char *buf; int cnt; {
	static int i;
	static char *p;

	i = write(fdes,buf,cnt);		/* Write it */
	ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

strcmp(str1, str2)
char *str1, *str2;
{
#asm
	POP	B	; return address
	POP	H	; get first string (str2)
	POP	D	; get second string (str1)
	PUSH	D	; restore stack for caller
	PUSH	H
	PUSH	B
SCLOOP: LDAX	D	; get next byte from second string
	CMP	M	; compare that with first string
	JNZ	SCDIFF	; they didn't compare
	INX	D	; increment both pointers
	INX	H
	ORA	A	; both the same.  see if both zero
	JNZ	SCLOOP	; nope.  get the next ones
	LXI	H,0	; yup.	they matched all the way to the null
	JMP	SCRET	; unified return for timing
SCDIFF: LXI	H,-1	;
	JC	SCRET	; first string < second string
	LXI	H,1	; first string > second string
SCRET:	DS	0	; unified return
#endasm
}

	JC	SCRET	; first string < second string
	LXI	H,1	; first string  buf + 256; p > buf; *--p = EOF);	/* else erase buffer */
	return i;
	}
 and position to write it */
		}
	else for (p = bui] == '*') flg = 0;
		if (flg == 0) fcb[i] = '?'; }
	flg = 17;
	bdos(26,0x80);				/* Make sure DMA address OK */
	while ((i ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* isalpha  -  is the input in [A..Z, a..z] ?
*/
isalpha(c) {
/*  return (('A' <= c && c <= 'Z') || ('a' <= c && c <= 'z')); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'z'+1
	RNC
	INR L
	CPI 'a'
	RNC
	CPI 'Z'+1
	RC
	DCR L
#endasm
}


	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'z'+1
	RNC
	INR L
	CPI 'a'
	RNC
	CPI 'Z'+1
	RC
	DCR ; both the same.  see if both zero
	JNZ	SCLOOP	; nope.  get the next ones
	LXI	H,0	; yup.	they matched all the way to the nullееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее; May 10, 1984	07:57  drm  "PAGE0.ASM"
; page 0 definitions for use in lang routine libraries

	public bdose,wboote,defdsk,deffcb,defbuf
; NOTE: if a .PRL file is generated, these "externals" will have
; their relocation bit set so that they will reference "page 0"
; that is directly before the TPA, where ever that may be.
;
; NOTE: use "wboote" for program termination and access to char I/O
; vectors, use absolute 0 for access to BIOS for configuration info.
;
wboote	equ	0000h
bdose	equ	wboote+5
defdsk	equ	wboote+4
deffcb	equ	wboote+5ch
defbuf	equ	wboote+80h

	end
> second string
SCRET:	DS	0	; unified return
#endasm
}

	JC	SCRET	; first string < second string
	LXI	H,1	; first string  buf + 256; p > buf; *--p = EOF);	/* else erase buffer */
	return i;
	}
 and position to write it */
		}
	else for (p = bui] == '*') flg = 0;
		if (flg == 0) fcb[i] = '?'; }
	flg = 17;
	bdos(26,0x80);				/* Make sure DMA address OK */
	while ((i ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* getline - get a string from the console.  Returns length of the string,
	0 terminated, without the newline at the end. */
getline(s,lim)
char *s;
{	static char *t;

	for (t = s; --lim > 0 && (*t = getchar()) != '\n' && *t != -1; ++t);
	*t = '\0';
	return t - s;
}


{	static char *t;

	for (t = s; --lim > 0 && (*t = getchar()) != '\n' && *t != -1; ++t);
	*t = '\0';access to char I/O
; vectors, use absolute 0 for access to BIOS for configuration info.
;
wboote	equ	0000h
bdose	equ	wboote+ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееLINK $1,C80ILIB.IRL[S,$$SZ]
> second string
SCRET:	DS	0	; unified return
#endasm
}

	JC	SCRET	; first string < second string
	LXI	H,1	; first string  buf + 256; p > buf; *--p = EOF);	/* else erase buffer */
	return i;
	}
 and position to write it */
		}
	else for (p = bui] == '*') flg = 0;
		if (flg == 0) fcb[i] = '?'; }
	flg = 17;
	bdos(26,0x80);				/* Make sure DMA address OK */
	while ((i ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* printf.c: library file for format, fformat, and printf
 * compile: c -l32000
 * J. J. Gillogly, Apr 80
 * sprintf added J. J. Gillogly, Jul 80
 * Modified Jan 82 to work with #define kludge for multiple printf args
 * %u and unsigned octal and hex added WB Feb 82
 * Fix for I/O redirection; John Toscano 4/17/84.
 */

#undef printf
#undef fprintf
#undef sprintf
static int *prnt_p,	/* Pointer into printf arglist */
	    Pfo;	/* Channel number for output */
static char *Pf = "",	/* current location in user's format */
	    *Pst;	/* current location in user's output string */
static int Pr; /* precision */
static char Pad;
static int Rad, Neg, Uns;

prnt_1(firstarg) { prnt_p = &firstarg; }	/* Record arglist start */

prnt_2(lastarg) {
	format(*--prnt_p);			/* Process arglist */
#asm
@prnt@: DS 0
#endasm
	while (prnt_p > &lastarg) printf(*--prnt_p); }

prnt_3(lastarg) {
	Pfo = *--prnt_p;
	fformat(Pfo,*--prnt_p);
#asm
	JMP @prnt@
#endasm
}

prnt_4(lastarg) {
	Pst = *--prnt_p;
	sformat(Pst,*--prnt_p);
#asm
	JMP @prnt@
#endasm
}

format(form)
char *form;
{	extern fout;
	fformat(fout,form);
}

fformat(chan,form)
int chan; char *form;
{	Pfo = chan;
	Pf = form;
	Ps();
}

sformat(string,form)	/* user wants data to go to a string */
char *string,*form;
{	Pst = string;
	fformat(-2,form);/* illegal value for a channel */
}

Ps()	/* output format up to next % */
{	while (*Pf != 0 && *Pf != '%')
		Pc(*Pf++);
}

Pc(c)
char c;
{	if (Pfo == -2) {
		*Pst++ = c;
		*Pst = 0;  /* terminate each intermediate string */
		return; }
	putc(c,Pfo);
}

printf(arg)	/* print one arg using current format */
char *arg;
{	if (*Pf++ == 0) return; /* otherwise next char is % */
	for (Pr = 0; *Pf >= '0' && *Pf <= '9';) /* precision */
		Pr = 10*Pr + *Pf++ - '0';
	Pad = ' '; Rad = Uns = 10; Neg = 0;
	switch(*Pf++)
	{   case 'd': Uns = 0;	      /* decimal */
	    case 'u': On(arg); break; /* unsigned decimal */
	    case 'o': Pad = '0'; Rad = 8; On(arg); break; /* octal */
	    case 'x': Pad = '0'; Rad = 16; On(arg); break; /* hex */
	    case 'c': Pc(arg); break; /* single char */
	    case 's': while (*arg) { Pc(*arg++); --Pr; }
		      Pd(' ');
		      break;	/* left-adjusted strings only */
	}
	Ps();
}

Od(n)	/* output digit: hex, octal, or decimal */
int n;
{	Pc(n < 10? n+'0' : 'A'+n-10);
}

Pd()
{	while (--Pr >= 0) Pc(Pad);
}

On(num)
register unsigned num;
{	Pr--;
	/* if negative, don't output the - yet, but save it for end */
	if (Uns == 0) if (num & 0100000) {Pr--; num = -num; Neg = 1; }
	if (num < Rad && num >= 0)
	{	Pd();
		if (Neg) Pc('-');
		Od(num);
	}
	else
	{	On(Rad==8?  num>>3:
		   Rad==10? num/10 :
			    num>>4);
		Od(Rad==10? num % 10 : num & (Rad-1));
	}
}
/* Definitions for printf and fprintf to allow multiple args. */

#define printf prnt_1(),prnt_2
#define fprintf prnt_1(),prnt_3
#define sprintf prnt_1(),prnt_4
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

min(i,j) { return i < j ? i : j; }

               STDLIB  C     LxyЂ             ееееееееееееееееееееееееееееееееcase 's': while (*arg) { Pc(*arg++); --Pr; }
		      Pd(' ');
		      break;	/* left-adjusted strings only */
	}
	Ps();
}

Od(n)	/* output digit: hex, octal, or decimal */
int n;
{	Pc(n < 10? n+'0' : 'A'+n-10);
}

Pd()
{	while (--Pr >= 0) Pc(Pad);
}

On(num)
register unsigned num;
{	Pr--;
	/* if negative, don't output the - yet, but save it for end */
	if (Uns =ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

atoi(s)        /* convert string to integer */
char *s;
{
	static int n, sign;
	sign = 1;
	n = 0;
	switch (*s) {
		case '-': sign = -1;
		case '+': ++s;
		}
	while (*s >= '0' && *s <= '9') n = 10 * n + *s++ - '0';
	return(sign * n);
}

ase '-': sign = -1;
		case '+': ++s;
		}
	while (*s >= '0' && *s <= '9') n = 10 * n + *s++ - '0';
	return(sign * n);

#define sprintf prnt_1(),prnt_4
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…‘”’S• e$еCуAI9PьКPRNT?3Ѓ”“•Н ddх$ФH=I5SFORMAЃ”’S•ҐаZ`yp      K@ -(<ё                 ґ B DX ’*А ±X‹  3@ +6Б 0eЈ@ rл` h  К¦`¬  еfУ Ќ 2EX  V+` m ` V rЉ°  ¬V"А Ъz еfЩ@‡FЂ"¬  +€° 6§Ђ°  « 9EX  V+` md rіm`‚ГЈ@‘P  еЃ –mv rіl ‚ЙЃ –m‹ `  9fЩђ  fЬЂH„ іm ‹ _Пч(„ іm€•›e ,L·  U@ В`4  e^U  7	ЂЫь2Н№аЫѕ Кї@Є  #P YёL rіoШ‡r "¬ #џ¬*<*АЂ1 №D @ дЬ& 4OЎ!V  " rn ў¬ еfЂ &\&                ґАB \ў¬  Н  X  V+`   "Б ,& !їДXT U@ b*  n X(љ  2«0$B  FX0 U‚Ђ-7шe›X DX4 шµeXРU  €Ё  ¬Ь& °P « ZрЙсjВµА"Ђ ъ2БЂЄ  #P YёL ` mп``V
 ґџб“вХ…t ET  F"  ЫЮ"Б ,* *  1  ›„А
 Ј_б–mв e_V ЃАР ›xАYWфB °@ « 0нё„ №Y¶ь V+fУђ aР(«ЂЬ¬Ъ>Б`°пX„ №Yґ$V+fРа&m*fЂ VЁ„ rіiЁ+‚БaЮ°1V  ЉДX  B \¬Ъd~?Г,Ъ^Н  8dљ  
Ё  ЊE@ fб0 E‚ЂvМ
Zо!Г ЪјЕj€A@+6љ‚°X,И‚ ,& Гі`BЂ E„А8d›^А­QV rіo +‚БaЬЂ&ИfЂ Ьк ®аF@Њ7Ђ,Ёа   0пX·,
[–*В 3вХ…vЂ„ ` ‹ 
°  ¬V"А  rеfХ@ ‹сюfХ°&mџbµEX(КН» М‡zАД Ђ ‹	Ђ0иШ„ a0„ ,& ! .VmиЉЩ·ј	›H@ДX\ U…А  Є*В`Vmа`°X,;Ц! .Vm)ЉЩґ›R@ДXt E‡АX| F"ГаітЭ•Z@ШudU‡Аb,> еaРh  л`Ђh  К°Ђb¬ Нѕ@,«**Г ±V €°ш «Ђ9EX|КНЈаМхЃІEX(КНї`mИ aФ0лfЫ@*c R@# Ј ,М №`FPЛ3Ђ(јC О 
*x T03ТЃЂ   Уіn@&\B   K{АЕX„К!  X„ U@ В` ‹ F h  КўЂ‚¬ Ђ  6ВЃІ©Ш «ЂA@h  еP ЉЂ 
НВ`D2h?Г",B Гї b¬B лp€±­“.#       ZЉ! ,Ъў"Д`  rНѕ@BJ Н¬ЂB@ rеfФ A[6§№EXЊ "ц†YµФ•bЃ8”›U­Q( Н¦ LР ‡gXЊ VН°@ЊVЁ‡Ђ3kР#4  bµY¶Ш‚БhџBBJ НІаЊVЁ„ fШрFh  Еj„_прьюНі@‚J Н«@‚¬F |?Г,ЪвКЅ ‚J Нµ@ЊVЁ„ fЫ FmµaС°QV# Ѕџб–mРeP Q% fЭђF+TB 3o#4  aС°Q% fЯ F+TB 3h+6тKFБD8”›qЃ8”›CЃY  
®A Л6±2eЕ     -5¬г—И„Ё іi(+Є!  ґXљ  2Єа(„Ё іiш+4  aЦ0Q	P 9fХ@Q) fСрQ  9” ‘ r€qH6°‚±ZўА rН¦@®VmE`°X, • –mybµD  6Ј‚іjP+*ж‚Љ°`  p?Г'Е«*в€E +6эЂ0EX V"АА;љ
*Ба± e№ ў¬ еa+6Џѓ0X"Ђ rщd€VсЛдB  B%  dE„@ў° rНІЂ¬VЁ„° іl+•›QA,EѓАX<К*В Vm`°D%  етЙ—Ђ  Срa 9fЯрW(„ іi 36єЃ€±h «Ђ3o€#*¦
°`  еbР+6З0X2ФАaV- €±h ЊшµeWЂa 9rіi`0Ќ›YЃfб0КНї`V €°0¦
°hсjК± В К!  ¬ЫБ`Іe±АВ rН«аО±V fЮрUµЃ –m“rіoШUЃЂb, Г±АМ‘ 9fЪ@`€$ Нў@Њ«! w<B7 :Д   е›nБѓ,‘
Бю9|Љ°@ D@ fЩ fUр€ , !) ,ЫЄLїГ'Е«
„ѓ€J@ИШЉ# %  е›}Aњў¬ е– –mцbµD Ђ еКН  ,‚"Ба," !) ,Ъ]їГ,ЪpК­@в0К*Б Q	` 9fС v+TB \¬ЪHБ`°X, uЉ°€4  fСPFU‘‘@QV r€K Л6§ѓ±Zў@ rеfХђv‚Б`€°x „  №EX<КНЈаМ„  ѕY иPRNT?1Ћ… e$еCу(й PRNT?3Ћ­Ђe$еCуHмFORMATЋК dddх$Фн`SFORMAЋ е$”еDhЙ°:H@Њ‘ЂT4TЕHМFOUTЊµѓґTЛ2Q@ЊћѓФ4дхHП(4C@LTЊОФ„”$ИЛи>LLONG@Њі‚е4ДфдtНА@SWITCЊ™Ф…T$ИЙx2S@ЊѕД4uHИ0$C@LEЊаѓD4tXЙ&C@MULTЊВ‚TДФфHО %L@ANDЊЊ‚ФД5(И(-L@DIVЊ”дДфдtМш-CL@LTЊ«‚ФДдTxЛ@=C@UGTЊ•ЂЕUD8М8<FTOAЊ  $t	А  ћ
Od(n)	/* output digit: hex, octal, or decimal */
int n;
{	Pc(n < 10? n+'0' : 'A'+n-10);
}

Pd()
{	while (--Pr >= 0) Pc(Pad);
}

On(num)
register unsigned num;
{	Pr--;
	/* if negative, don't output the - yet, but save it for end */
	if (Uns =ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…TРРS‘ eTдtUD8MQ,эA>SCAN?FЃ‘ЏФРРS e3х44йAPЧШ\    K@  @ ељ  °  «  –мЄr *А б0К! ,Ъ
 Н  ‹VU2 ` ‹  0й° «  2Xt( B  2D7ДК! &б0КН  	сjК« ‡W   $B MВ` D‚ fЂ Єф ! &б0 "Z 3@ h  К±а rе7	Ђ  2С>„„   дЬ& 2@ 	p                ЩђU— >-YV” UѓЂ"ыьEeАX шµe[рV rі@ ‹ 2EX( шµe^pV
 7	ЂЕ«*р 
°P ЊE‚Ђfб0‡xА/чш‹ 2Y   ‹ 2eВ   ·ё›f@X@ FНЇ`Є!  V\ B °0 « 2eЎ`,Ы2 еfУР	сjКЈА,ЫЬ ГЎ`"  EЃЂ2б   ZJ! ,Ъ< "В@Ђ›Z UU„Ђ#ђ6ј 3o°*Є Љ°ђ E я€°ђДЂЉ°ђ  }sНв,$  ЂґМ•\ЂEXH "F 3iш6Ў І¬(«	 Y/рИ‹	 0мH…юяdЛb@EXЦ*В@Р •fЂEXH’!їЩ,ЪНі ѓь2|ZІ­p%›{Ђ¶dКН« Љ!ю>-XW›{Ђ             B YґЁ"  3l€*хЂ€@@Л6л °п°„ іo0EОя„n0eК! ,ЫаС>„™2б@                         % АB{ьrщ`  €Ђ Н»Ђ,Є:*А@:H*А@;ь2"ВЂЊ7	Ђ, "Іа¬( ёА!—(„  hџBB,( !)Ђ",D *БЂ±X‹ 3h ‹ 
±@ ЊEЉ fб0 E€ ‹VUtfЩђ6№Ђіkђ*¦ѓ
± •›O@'Е«*Е0кР« [oрЙсjВ¶@B¬P n -·шdшµeZ°&ЛaЫ !V( €±@¶И	›BАY¶dК*Д Р •q@u4›{ЂuhB °° ‹ 
±@ёL µџб“вХ…|А„   ‹ 
±@ ЊEЉ t Uѓ b± rЉ±4  ePЂ6M–„€@  ‚Ђ, *Е 1( ›„А  rіi(E‡ЂlЪкКЁАb¬8 л`@h  лaа И‹ 0и « 9Yµt‚Гў`МЫ<! X‡bЂД Ђ ‹ 0мP„ `@Љ–·ЃіhX6МЂZoрЙсjК° l;!їДX`›{Ђ%±@b  E†Ђґ,›f@¬ЪJБaа6–І®`« :ЕX›N@Эb¬< a mо aАX‹ ¬+’Г№Ђl;&*ААЕ«
лЃ°кh0« ¬«ж*БЂЪЄеaЂX« 3mh4  aУрfma`вХ•BЃX0›xАДXђZНі ,< #fЪ 6UVaа+6ћЂ0O‹VU'aХ`Fmо a`вХ•PAXђ F"ДЂ·(« 4OЎ!V €°асjКЄ Њ:¦ГЄАЊ:*ВАЕ«*±‚
±  Ш *ААЕ«
·0кh3џѓ3lИ ЊшµaWРFMa`вХ•dЃX0›AA¬Ы2 С>„™·ё‡OБ„   ‹ °А « ДX  Vn Xx "ў†Y  *ж‚@   bЂ‹ 
НВ` ‹ 
±@”B] 9Yґ ‚Бb`mґe^`FMЂ ‘$ b`X« 3@ UaЂ‹ J mfС FU|b@‹ 
Ьў¬< С>„…X  Ь& ZoрЙсjВ­`ў¬P #bЂV( 7	Ђ±V fРPVUOaЂ‹ J m=fРЂVUkb@‹ 
Ьў¬< #aа‰ф$Г¦@ІЦ°QV( €±@ ¬Ь& °рц‚
±0 ЊEЉ Xђ l `Аm‰b@m™ aа6ЁІЇи(„  №EXxКН  ‹ 
± сjК· ў¬L Н»АЊЫ2
ВєЂў¬L |ZІ®€(« 3mШ+6Яіnђ+*ы‚Љ°°сjКѕ ў¬H #b@[”U‡Ђ'Р“6ч 0пР+ю‚°м€(« ¬Є*ДЂ`џѓ0кh3џѓ3@ 
ўx UР3xіЂјР ­аf@Љ:Ђ/°М\A`0[   :*ВЂ±V €° ­KSA…X( шµeV aV u€J ЛеЦЙ–°3lИ ‹ Щ·T•hЃ…Xx "ц†O‹V|aЪ aV rіiишµeXрfmо aЩрaV rЉ°•›t@X,ўaЦ fm™ іk@3*Щ
° Ъѓ_пцXЂ , "А@ r"БЂ–mdЉ°` ¬V"БЂЫ
"А@ЪЙ`АX¬Eѓ ·XE‚Ђґ	’ ѓA@о€UNGETCЋЬe5DіхшоH6SCAN?FЋжѓdcх44иош6S?SCANЊф$„ЙS@ЊІ Д4ДXЛЂC@GEЊУѓ4TКh,C@GTЊЮЃ$дИ E@Њчд4ХTЕHП€Q@Њз‚Ф4дхHПЁ%C@UGEЊЉd5t•D8НАGETCЊф dtUD4„А G@њ   ћНЈаМ„  ѕY иPRNT?1Ћ… e$еCу(й PRNT?3Ћ­Ђe$еCуHмFORMATЋК dddх$Фн`SFORMAЋ е$”еDhЙ°:H@Њ‘ЂT4TЕHМFOUTЊµѓґTЛ2Q@ЊћѓФ4ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* May 9, 1984	16:09  drm  "STDLIB.C" */
/* modified to use PAGE0 definitions from elswhere, and BDOS() to
   return what the system returned in HL (A=L,B=H) */
/* stdlib.c - Standard C library - (c) 1983 The Software Toolworks.
   Some of these routines were provided by Jim and Gary Gilbreath.
   The fast str routines were donated by Dr. Jim Gillogly.

   If this file is #included at the end of a source program, routines
   will be compiled automatically as needed.

   In the following, s, t are strings terminated by a 0 byte, and c is
   a char or an int containing an ASCII character.  Other args are ints
   except where noted otherwise.

   abs(i)	Absolute value of i.
   alloc(i)	Returns pointer to i bytes of available memory.
   atoi(s)	Integer value of string s, optional leading +/-,
		stops at first non-digit.
   bdos(c,de)	Calls CP/M bdos with registers shown; returns contents of HL
   free(p)	Frees up memory at p.  P must have been value returned by alloc.
   getline(s,i) Reads a line from console into s, stopping at newline or i char-
		acters.  0-terminates string; returns length including 0 byte.
   index(s,t)	Position in string s of string t, or -1 if not there.
   isalpha(c)	1 if c is an alphabetic character A-Z or a-z.
   isdigit(c)	1 if c is an ASCII digit 0-9.
   islower(c)	1 if c is a lower case character a-z.
   isspace(c)	1 if c is a blank, tab or newline.
   isupper(c)	1 if c is an upper case character A-Z.
   itoa(i,s)	Converts i to an ASCII string in char s[7]; returns s.
   makfcb(s,fcb) Unpack file name s into char fcb[36] to make a CP/M fcb.
   max(i,j)	The greater of i and j.
   min(i,j)	The lesser of i and j.
   rename(s,t)	Renames the file named s to be called t.  Returns -1 for
		failure, a non-negative number for success.
   strcat(s,t)	Appends t to s.  No checking for overflow of s.
   strcmp(s,t)	-1, 0 or 1 if s < t, s == t, s > t respectively.
   strcpy(s,t)	Copies t into s.  No checking for overflow of s.
   strlen(s)	The number of bytes in s, exclusive of the 0 byte.
		(Note: it takes strlen(s)+1 bytes to hold s.)
   tolower(c)	c, but if upper case it is converted to lower case.
   toupper(c)	c, but if lower case it is converted to upper case.
   unlink(s)	Deletes the file s, if it exists.

   None of these routines calls any other functions, except that the file
   routines call bdos and makfcb. */

/*	*	*/

/* rename - rename oldfile to be newfile  */

rename(old,new)
char *old,*new;
{
	char fcb[54];

	makfcb(new,fcb+16);	       /* enter new name */
	makfcb(old,fcb);	       /* and old one. */
	bdos(26, 0x80); 	       /* first, set dma addr to junk area */
	return bdos(23,fcb);	       /* rename it */
}

/*	*	*/

/* unlink - remove (erase) a file from the file directory  */

unlink(name)
char *name[];
{
	char fcb[36];

	makfcb(name,fcb);	       /* make fcb for name */
	bdos(26,0x80);		       /* first, set dma addr to junk area */
	bdos(19, fcb);		       /* erase the file */
}

/*	*	*/

abs(i) { return i < 0 ? -i : i; }

/*	*	*/

/* alloc and free - (c) 1983 Walt Bilofsky.

  Usage: alloc(n) returns pointer to n bytes of memory. 
	 free(p) returns memory at p to free pool; p must have
		been gotten from alloc.
	 Uses: sbrk(). */

static struct block0 {
	unsigned size0;
	char *next0; }
    freelist = { 0, -1 };		/* -1 is largest unsigned */

#define PSIZE sizeof(unsigned)		/* Size of header word */
#define TRIFLE sizeof(struct block0)	/* Largest allowable wastage */

alloc(n) unsigned n; {
	static char *p,*pn;
	static int size;
	if ((n =+ PSIZE) < sizeof(struct block0))
				n = sizeof(struct block0);
	for (;;) {
		for (p = &freelist; (pn = p->next0) != -1; p = pn)
			if (n <= pn->size0) {
				/* Decide whether to fragment block */
				if (n + TRIFLE <= pn->size0) {
					p = p->next0 = pn + n;
					p->size0 = pn->size0 - n;
					pn->size0 = n; }
				p->next0 = pn->next0;
				return pn + PSIZE; }
		if ((p = sbrk(size = n < 1024 ? 1024 : n)) == -1) return -1;
		p->size0 = size;
		free(p + PSIZE);
	}	}

free(q) char *q; {
	static char *p, *pn;
	q =- PSIZE;
	for (p = &freelist; p != -1; p = pn)
	    if ((pn = p->next0) > q) {
		/* Merge with following block? */
		if (q + q->size0 == pn) {
			q->size0 =+ pn->size0;
			pn = pn->next0; }
		/* Merge with preceding block? */
		if (p + p->size0 == q) {
			p->size0 =+ q->size0;
			q = p; }
		p->next0 = q;
		q->next0 = pn;
		return; }
	}

/*	*	*/

atoi(s)        /* convert string to integer */
char *s;
{
	static int n, sign;
	sign = 1;
	n = 0;
	switch (*s) {
		case '-': sign = -1;
		case '+': ++s;
		}
	while (*s >= '0' && *s <= '9') n = 10 * n + *s++ - '0';
	return(sign * n);
}

/*	*	*/

/* bdos(c,de) - call bdos with given values of c and de.
		return value from register a */
bdos() {
#asm
	extrn bdose
	POP H
	POP D		; Get arguments into d
	POP B		; and b.
	PUSH B		; Restore stack.
	PUSH D
	PUSH H
	CALL bdose	; Call BDOS.
			; Return value from HL.
#endasm
}

/*	*	*/

/* getline - get a string from the console.  Returns length of the string,
	0 terminated, without the newline at the end. */
getline(s,lim)
char *s;
{	static char *t;

	for (t = s; --lim > 0 && (*t = getchar()) != '\n' && *t != -1; ++t);
	*t = '\0';
	return t - s;
}

/*	*	*/

index(s,t)	/* find string t in s, return index, or -1 if fail*/
char s[], t[];
{
	static int i,j,k;

	for (i = 0; s[i] != '\0'; i++) {
	   for (j=i,k=0; t[k] != '\0' && s[j]==t[k]; ++j, ++k)
		;
	   if (t[k] == '\0') return(i);
	}
	return(-1); /* no match*/
}

/*	*	*/

/* isalpha  -  is the input in [A..Z, a..z] ?
*/
isalpha(c) {
/*  return (('A' <= c && c <= 'Z') || ('a' <= c && c <= 'z')); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'z'+1
	RNC
	INR L
	CPI 'a'
	RNC
	CPI 'Z'+1
	RC
	DCR L
#endasm
}

/*	*	*/

/* isdigit  -  is the input in [0..9] ?
*/
isdigit(c) {
/*  return ('0' <= c && c <= '9'); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI '0'
	RC
	CPI '9'+1
	RNC
	INR L
#endasm
}

/*	*	*/

/* islower  -  is the input in [a..z] ?
*/
islower(c) {
/*  return ('a' <= c && c <= 'z'); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	INR L
#endasm
}

/*	*	*/

/* isspace  -  is the input blank ?
*/
isspace(c)
{   switch (c) {
	case ' ': case '\t': case '\n': return 1; }
    return 0;
}

/*	*	*/

/* isupper  -  is the input in [A..Z] ?
*/
isupper(c) {
/*  return ('A' <= c && c <= 'Z'); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	INR L
#endasm
}

/*	*	*/

/* itoa - convert n to characters in s. */
char *itoa(n, s)
char s[];
int n;
{
	static int c, k;
	static char *p, *q;

	if ((k = n) < 0)
		k = -k;
	q = p = s;
	do {
		*p++ = k % 10 + '0';
	} while (k /= 10);
	if (n < 0) *p++ = '-';
	*p = 0;
	while (q < --p) {
		c = *q; *q++ = *p; *p = c; }
	return (s);
}

/*	*	*/

/* makfcb(file,fcb) - unpack filename into char fcb[36]. */
makfcb(file,fcb) {
#asm
	POP B
	POP H
	POP D
	PUSH D
	PUSH H
	PUSH B
#endasm
	x0fcb();
}

/*	*	*/

max(i,j) { return i > j ? i : j; }

/*	*	*/

min(i,j) { return i < j ? i : j; }

/*	*	*/

/* Copy 0-terminated string tt onto end of 0-terminated string ss */
strcat(ss,tt)
char ss[], tt[];
{
	while (*ss) ++ss;		/* find end of string */
	while (*ss++ = *tt++);		/* copy til zero byte */
}

/*	*	*/

strcmp(str1, str2)
char *str1, *str2;
{
#asm
	POP	B	; return address
	POP	H	; get first string (str2)
	POP	D	; get second string (str1)
	PUSH	D	; restore stack for caller
	PUSH	H
	PUSH	B
SCLOOP: LDAX	D	; get next byte from second string
	CMP	M	; compare that with first string
	JNZ	SCDIFF	; they didn't compare
	INX	D	; increment both pointers
	INX	H
	ORA	A	; both the same.  see if both zero
	JNZ	SCLOOP	; nope.  get the next ones
	LXI	H,0	; yup.	they matched all the way to the null
	JMP	SCRET	; unified return for timing
SCDIFF: LXI	H,-1	;
	JC	SCRET	; first string < second string
	LXI	H,1	; first string > second string
SCRET:	DS	0	; unified return
#endasm
}

/*	*	*/

strcpy(to, from)
char *to, *from;
{
#asm
	POP	B	; return address
	POP	H	; get from arg
	POP	D	; get to arg
	PUSH	D	; restore stack for caller
	PUSH	H
	PUSH	B
	DCX	H	; back off for a running start
STLOOP: INX	H	; point at next FROM char
	MOV	A,M	; put it into accumulator
	STAX	D	; store it in TO string
	INX	D	; increment TO string
	ORA	A	; check for last char
	JNZ	STLOOP	; copied the 0 byte.  Go away.
#endasm
}

/*	*	*/

strlen(string)
char *string;
{
#asm
	POP	B	; return address
	POP	D	; the string
	PUSH	D	; restore stack
	PUSH	B
	LXI	H,0	; initialize length
SLLOOP: LDAX	D	; get next char
	ORA	A	; test for zero
	JZ	SLDONE	; end of string
	INX	D	; point at next character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONE: DS	0	; fall through for timer
#endasm
}

/*	*	*/

/* tolower  -  if the input is in [A..Z], convert to lower case
*/
tolower(c) {
/*  if ('A' <= c && c <= 'Z')
	return (c + 0x20);
    return c;		*/
#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	XRI 20H
	MOV L,A
#endasm
}

/*	*	*/

/* toupper - Convert character to upper case if in [a..z].  */
toupper(c) {
/*	if ('a' <= c && c <= 'z')
		return (c - 0x20);
	return (c);			*/
#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	XRI 20H
	MOV L,A
#endasm
}




#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее* Long runtime library; C/80 3.0 (5/28/83) - (c) 1983 Walter Bilofsky
* Rev. for DRI ASM's 5-2-85 drm

	public L?shif,L?comp,L?mdiv

	extrn I@@F,C@@F,U@@F,F@@C,F@@U,F@@I,L@@F,F@@L
	extrn facl?,facl?1,facl?2,fac?,fac?1,save?,fmlt?1,fmlt?2
	extrn dum?,save?1,fdiv?a,fdiv?b,fdiv?c,fdiv?g,flt?pk
	extrn R?b,f?stak,digc??,fmtc??
	extrn L?adsb,I?long,l?stak,Four?b
	extrn movrm@,llong@,C@1632,her@32,L@@C,L@@U,L@@I,C@3216
	extrn swaps@,long@0

L?shif: DS	0
L@and:	LXI	H,2
	DAD	SP
	MOV	A,M
	ANA	E
	MOV	E,A
	INX	H
	MOV	A,M
	ANA	D
	MOV	D,A
	INX	H
	MOV	A,M
	ANA	C
	MOV	C,A
	INX	H
	MOV	A,M
	ANA	B
	MOV	B,A
	POP	H
	INX	SP
	INX	SP
	XTHL
	RET
L@asr:	XRA	A
	ORA	B
	ORA	C
	ORA	D
	JNZ	Lasr9
	ORA	E
	JZ	Lasr3
	MOV	A,E
	CPI	32
	JNC	Lasr9
Lasr2:	MVI	B,4
	LXI	H,5
	DAD	SP
	XRA	A
	MOV	A,M
	ORA	A
	JP	Lasr1
	STC
Lasr1:	MOV	A,M
	RAR
	MOV	M,A
	DCX	H
	DCR	B
	JNZ	Lasr1
	DCR	E
	JNZ	Lasr2
Lasr3:	POP	H
	POP	D
	POP	B
	PCHL
Lasr9:
	LXI	H,5
	DAD	SP
	MOV	A,M
	ORA	A
	MVI	A,0
	JP	Lasr8
	DCR	A
Lasr8:	MVI	B,4
Lasr7:	MOV	M,A
	DCX	H
	DCR	B
	JNZ	Lasr7
	JMP	Lasr3
L@asl:	XRA	A
	ORA	B
	ORA	C
	ORA	D
	JNZ	Lasl9
	ORA	E
	JZ	Lasr3
	MOV	A,E
	CPI	32
	JNC	Lasl9
Lasl2:	MVI	B,4
	LXI	H,2
	DAD	SP
	XRA	A
Lasl4:	MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Lasl4
	DCR	E
	JNZ	Lasl2
	JMP	Lasr3
Lasl9:	LXI	H,5
	DAD	SP
	XRA	A
	JMP	Lasr8
	RET
L?comp: DS	0
cl@lt:	LXI	H,4
	CALL	swaps@
cl@gt:	LXI	H,1
cl@glt: PUSH	H
	CALL	sstak
	POP	H
	PUSH	PSW
	CALL	long@0
	JNZ	clgt1
	POP	PSW
	JMP	clgt2
clgt1:	POP	PSW
	LXI	H,2
	JNC	clgt2
	DCR	L
clgt2:	POP	D
	POP	B
	POP	B
	PUSH	D
	DCR	L
	RET
cl@le:	LXI	H,4
	CALL	swaps@
cl@ge:	LXI	H,2
	JMP	cl@glt
sstak:	LXI	H,6
	DAD	SP
	MOV	A,M
	SUB	E
	MOV	E,A
	INX	H
	MOV	A,M
	SBB	D
	MOV	D,A
	INX	H
	MOV	A,M
	SBB	C
	MOV	C,A
	INX	H
	MOV	A,M
	MOV	L,B
	MOV	H,A
	SBB	B
	MOV	B,A
	PUSH	PSW
	MOV	A,H
	XRA	L
	JP	snorml
	POP	PSW
	CMC
	RET
snorml: POP	PSW
	RET
	RET
L?mdiv: DS	0
L@mul:	PUSH	B
	PUSH	D
	LXI	D,0
	PUSH	D
	PUSH	D
Lmshtx: MVI	B,4
	LXI	H,7
	DAD	SP
	XRA	A
Lmrtx:	MOV	A,M
	RAR
	MOV	M,A
	DCX	H
	DCR	B
	JNZ	Lmrtx
	JNC	Lmul0
	MVI	B,4
	LXI	H,10
	DAD	SP
	XCHG
	LXI	H,0
	DAD	SP
	XRA	A
Lmnxt:	LDAX	D
	ADC	M
	MOV	M,A
	INX	D
	INX	H
	DCR	B
	JNZ	Lmnxt
Lmul0:	LXI	H,4
	MOV	B,L
	MOV	A,H
	DAD	SP
Lmzchk: ORA	M
	JNZ	Lmshty
	INX	H
	DCR	B
	JNZ	Lmzchk
	JMP	Lmexi
Lmshty: MVI	B,4
	LXI	H,10
	DAD	SP
	XRA	A
Lmlfty: MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Lmlfty
	JMP	Lmshtx
Lmexi:	LXI	H,8
	DAD	SP
	MOV	E,M
	INX	H
	MOV	D,M
	INX	H
	INX	H
	INX	H
	MOV	M,E
	INX	H
	MOV	M,D
	POP	D
	POP	B
	LXI	H,8
	DAD	SP
	SPHL
	RET
L@mod:	MVI	L,0
	JMP	Ldiv0
L@div:	MVI	L,1
Ldiv0:	PUSH	H
	PUSH	B
	PUSH	D
	MOV	A,B
	ORA	A
	JP	Ldiv1
	CALL	negst4
	MVI	A,-1
Ldiv1:	PUSH	PSW
	LXI	H,0
	PUSH	H
	PUSH	H
	MVI	L,17
	DAD	SP
	MOV	B,M
	DCX	H
	MOV	C,M
	DCX	H
	MOV	D,M
	DCX	H
	MOV	E,M
	PUSH	B
	PUSH	D
	MOV	A,B
	ORA	A
	JP	Ldiv2
	CALL	negst4
	MVI	A,-1
Ldiv2:	LXI	H,9
	DAD	SP
	XRA	M
	MOV	M,A
	LXI	H,0
	PUSH	H
	PUSH	H
	MVI	A,32
Ldiv10: PUSH	PSW
	LXI	H,6
	DAD	SP
	XRA	A
	MVI	B,8
Ldiv3:	MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Ldiv3
	LXI	H,13
	DAD	SP
	XCHG
	LXI	H,19
	DAD	SP
	LXI	B,4*256
Ldiv5:	LDAX	D
	CMP	M
	JC	Ldiv4
	JNZ	Ldiv44
	DCX	H
	DCX	D
	DCR	B
	JNZ	Ldiv5
Ldiv44:
	INR	C
Ldiv4:
	CMC
	PUSH	PSW
	LXI	H,4
	DAD	SP
	POP	PSW
	MVI	B,4
Ldiv7:	MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Ldiv7
	MOV	A,C
	ORA	A
	JZ	Ldiv8
	LXI	H,16
	DAD	SP
	XCHG
	LXI	H,10
	DAD	SP
	XRA	A
	XCHG
	MVI	B,4
Ldiv9:	LDAX	D
	SBB	M
	STAX	D
	INX	H
	INX	D
	DCR	B
	JNZ	Ldiv9
Ldiv8:
	POP	PSW
	DCR	A
	JNZ	Ldiv10
	LXI	H,18
	DAD	SP
	MOV	A,M
	ORA	A
	JNZ	Ldiv20
	LXI	H,8
	DAD	SP
	XCHG
	LXI	H,0
	DAD	SP
	XCHG
	MVI	B,4
Ldiv21: MOV	A,M
	STAX	D
	INX	H
	INX	D
	DCR	B
	JNZ	Ldiv21
Ldiv20:
	LXI	H,13
	DAD	SP
	MOV	A,M
	ORA	A
	CM	negst4
	POP	D
	POP	B
	LXI	H,16
	DAD	SP
	SPHL
outLL:	POP	H
	INX	SP
	INX	SP
	XTHL
	RET
negst4:
	PUSH	H
	PUSH	B
	LXI	B,4*256
	LXI	H,6
	DAD	SP
	XRA	A
ngst4l: MOV	A,C
	SBB	M
	MOV	M,A
	INX	H
	DCR	B
	JNZ	ngst4l
	POP	B
	POP	H
	RET
L@or:	LXI	H,2
	DAD	SP
	MOV	A,M
	ORA	E
	MOV	E,A
	INX	H
	MOV	A,M
	ORA	D
	MOV	D,A
	INX	H
	MOV	A,M
	ORA	C
	MOV	C,A
	INX	H
	MOV	A,M
	ORA	B
	MOV	B,A
	JMP	outLL
L@xor:	LXI	H,2
	DAD	SP
	MOV	A,M
	XRA	E
	MOV	E,A
	INX	H
	MOV	A,M
	XRA	D
	MOV	D,A
	INX	H
	MOV	A,M
	XRA	C
	MOV	C,A
	INX	H
	MOV	A,M
	XRA	B
	MOV	B,A
	JMP	outLL
	RET
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* Copy 0-terminated string tt onto end of 0-terminated string ss */
strcat(ss,tt)
char ss[], tt[];
{
	while (*ss) ++ss;		/* find end of string */
	while (*ss++ = *tt++);		/* copy til zero byte */
}

t)
char ss[], tt[];
{
	while (*ss) ++ss;		/*
	INX	H
	INX	D
	DCR	B
	JNZ	Ldiv21
Ldiv20:
	LXI	H,13
	DAD	SP
	MOV	A,M
	ORA	A
	CM	negst4
	POP	D
	POP	B
	LXI	H,16
	DAD	SP
	SPHL
outLL:	POP	H
	INX	SP
	INX	SP
	XTHL
	RET
negst4:
	PUSH	H
	PUSH	B
	LXI	B,4*256
	LXI	H,6
	DAD	SP
	XRA	A
ngееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/***************************************************************************
*
*	  C P / M   C	R U N	T I M E   L I B   H E A D E R	F I L E
*	  -------------------------------------------------------------
*	Copyright 1982 by Digital Research Inc.  All rights reserved.
*
*	This is an include file for assisting the user to write portable
*	programs for C.  All processor dependencies should be located here.
*
****************************************************************************/

/*
 *	Standard type definitions
 */

#define byte	char
#define BYTE	char				/* signed byte */
#define UBYTE	char				/* unsigned byte */
#define bool	int				/* 2 valued (true/false)   */
#define BOOLEAN int
#define word	unsigned int
#define WORD	int				/* signed word */
#define UWORD	unsigned int			/* unsigned word */
#define short	int
#define void	/**/				/* Void function return    */
#define VOID	/**/
#define ushort	unsigned int
#define bits	unsigned int
#define metachar int

#define LONG	long				/* signed long (32 bits)   */
#define ULONG	long				/* Unsigned long	   */
#define FLOAT	float				/* Floating Point	   */
#define DOUBLE	float				/* Double precision	   */
#define DEFAULT int				/* Default size 	   */

#define REG	register			/* register variable	   */
#define LOCAL	auto				/* Local var on 68000	   */
#define EXTERN	extern				/* External variable	   */
#define MLOCAL	static				/* Local to module	   */
#define GLOBAL	/**/				/* Global variable	   */


/****************************************************************************/
/*	Miscellaneous Definitions:					    */
/****************************************************************************/
#define FAILURE (-1)			/*	Function failure return val */
#define SUCCESS (0)			/*	Function success return val */
#define YES	1			/*	"TRUE"			    */
#define NO	0			/*	"FALSE" 		    */
#define FOREVER for(;;) 		/*	Infinite loop declaration   */
#define NULL	0			/*	Null character value	    */
#define NULLPTR (char *) 0		/*	Null pointer value	    */
#define EOF	(-1)			/*	EOF Value		    */
#define TRUE	(1)			/*	Function TRUE  value	    */
#define FALSE	(0)			/*	Function FALSE value	    */


/* printf.h: definitions for printf and fprintf to allow multiple args.
 */

#undef printf
#undef fprintf
#undef sprintf
#define printf prnt_1(),prnt_2
#define fprintf prnt_1(),prnt_3
#define sprintf prnt_1(),prnt_4

/* Header file for scanf */

#undef scanf
#undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscanf STK_pos(),s_scan

/* DOS defination */

#define dos bdos

_pos(),scan_f
#define fscanf OV	E,A
	INX	H
	MOV	A,M
	ORA	D
	MOV	D,A
	INX	H
	MOV	A,M
	ORA	C
	MOV	C,A
	INX	H
	MOV	A,M
	ORA	B
	MOV	B,A
	JMP	outLL
L@xor:	LXI	H,2
	DAD	SP
	MOV	A,M
	XRA	E
	MOV	E,A
	INX	H
	MOV	A,M
	XRA	D
	MOV	D,A
	INX	H
	MOV	A,M
	XRA	C
	MOV	C,A
	INX	H
	MOV	A,M
	XRA	B
	MOV	B,A
	JMP	outLL
	RET
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее* Floating point library; C/80 3.0 (7/7/83) - (c) 1983 Walter Bilofsky
* Rev. for DRI ASM's 5-2-85 drm

	public atof,Bf@Bl,Bf@Hc,Bf@Hi,Bf@Hu,Bl@Bf,Bl@Hc,Bl@Hi,Bl@Hu
	public C@1632,C@3216,C@@F,C@@L,cf@eq,cf@fls,cf@ge,cf@gt,cf@le
	public cf@lt,cf@ne,cf@tru,cf@zro,cl@ge,cl@glt,cl@gt,cl@le,cl@lt
	public comp@4,div10@,eq@4,F@@C,F@@I,F@@L,F@@U,f@add,f@div,f@mul
	public f@neg,f@not,f@round,f@sub,fadd@,fadda@,fcomp@,fint@
	public flneg@,float@,flt@0,foutt@,ftoa,Hc@Bf,Hc@Bl,her@32,Hi@Bf
	public Hi@Bl,Hu@Bf,Hu@Bl,I@@F,I@@L,inxhr@,L@@C,L@@F,L@@I,L@@U
	public L@add,L@and,L@asl,L@asr,L@com,L@div,L@mod,L@mul,L@neg
	public L@not,L@or,L@sub,L@xor,llong@,lneq@4,long@0,movfm@,movfr@
	public movmf@,movrf@,movrm@,mul10@,neq@4,pushf@,qint@,sign@
	public slong@,st4@,swap4@,swaps@,U@@F,U@@L,zero@

	extrn c@sxt,h@,g@

facl?:	DB	0
facl?1: DB	0
facl?2: DB	0
fac?:	DB	0
fac?1:	DB	0
save?:	DB	0
fmlt?1: DB	0
fmlt?2: DB	0
dum?:	DB	0
save?1: DB	0
errcod: DB	0
fdiv?a: DB	0
fdiv?b: DB	0
fdiv?c: DB	0
fdiv?g: DB	0
flt?pk: DS	0
F@add:	XRA	A
	JMP	Dual
F@sub:	MVI	A,1
	JMP	Dual
F@mul:	MVI	A,2
	JMP	Dual
F@div:	MVI	A,3
Dual:	CALL	movfr@
	POP	H
	POP	D
	POP	B
	PUSH	H
	LXI	H,movrf@
	PUSH	H
	LXI	H,Ftab
Fexecl: ORA	A
	JZ	Fexec
	DCR	A
	INX	H
	INX	H
	JMP	Fexecl
Fexec:	MOV	A,M
	INX	H
	MOV	H,M
	MOV	L,A
	PCHL
Ftab:	DW	fadd@
	DW	fsub
	DW	fmult
	DW	fdiv
F@neg:	MOV	A,C
	XRI	80H
	MOV	C,A
	RET
cf@le:	CALL	relopf
	JP	ftrue
ffalse: DCR	L
	RET
cf@lt:	CALL	relopf
	DCR	A
	JNZ	ffalse
ftrue:	INR	A
	RET
cf@ge:	CALL	relopf
	DCR	A
	RM
	DCR	L
	RET
cf@gt:	CALL	relopf
	RM
	DCR	L
	RET
relopf:
	CALL	movfr@
	POP	B
	POP	H
	POP	D
	XTHL
	PUSH	B
	MOV	B,H
	MOV	C,L
	CALL	fcomp@
	LXI	H,1
	ORA	A
	RET
cf@eq:	CALL	cf@zro
	JNC	eq@4
	JZ	cf@tru
cf@fls: DCR	E
cf@tru: POP	H
	POP	B
	XTHL
	XCHG
	DCR	L
	RET
cf@ne:	CALL	cf@zro
	JNC	neq@4
	JZ	cf@fls
	JMP	cf@tru
cf@zro: XRA	A
	LXI	H,7
	DAD	SP
	ORA	B
	JZ	zer1
	XRA	A
	ORA	M
	RNZ
	INR	A
zer1:	ORA	M
	STC
	LXI	D,2
	RET
fsub:	CALL	flneg@
fadd@:	MOV	A,B
	ORA	A
	RZ
	LDA	fac?
	ORA	A
	JZ	movfr@
	SUB	B
	JNC	fadd1
	CMA
	INR	A
	XCHG
	CALL	pushf@
	XCHG
	CALL	movfr@
	POP	B
	POP	D
fadd1:	CPI	25
	RNC
	PUSH	PSW
	CALL	unpack
	MOV	H,A
	POP	PSW
	CALL	shiftr
	ORA	H
	LXI	H,facl?
	JP	fadd3
	CALL	fadda@
	JNC	round
	INX	H
	INR	M
	CZ	overr
	MVI	L,1
	CALL	shradd
	JMP	round
fadd3:	XRA	A
	SUB	B
	MOV	B,A
	MOV	A,M
	SBB	E
	MOV	E,A
	INX	H
	MOV	A,M
	SBB	D
	MOV	D,A
	INX	H
	MOV	A,M
	SBB	C
	MOV	C,A
fadflt: CC	negr
normal: MOV	L,B
	MOV	H,E
	XRA	A
norm1:	MOV	B,A
	MOV	A,C
	ORA	A
	JNZ	norm3
	MOV	C,D
	MOV	D,H
	MOV	H,L
	MOV	L,A
	MOV	A,B
	SUI	8
	CPI	0E0H
	JNZ	norm1
zero@:	XRA	A
zero0:	STA	fac?
	RET
norm2:	DCR	B
	DAD	H
	MOV	A,D
	RAL
	MOV	D,A
	MOV	A,C
	ADC	A
	MOV	C,A
norm3:	JP	norm2
	MOV	A,B
	MOV	E,H
	MOV	B,L
	ORA	A
	JZ	round
	LXI	H,fac?
	ADD	M
	MOV	M,A
	JNC	zero@
	RZ
round:	MOV	A,B
roundb: LXI	H,fac?
	ORA	A
	CM	rounda
	MOV	B,M
	INX	H
	MOV	A,M
	ANI	80H
	XRA	C
	MOV	C,A
	JMP	movfr@
rounda: INR	E
	RNZ
	INR	D
	RNZ
	INR	C
	RNZ
	MVI	C,80H
	INR	M
	RNZ
overr1: JMP	overr
fadda@: MOV	A,M
	ADD	E
	MOV	E,A
	INX	H
	MOV	A,M
	ADC	D
	MOV	D,A
	INX	H
	MOV	A,M
	ADC	C
	MOV	C,A
	RET
negr:	LXI	H,fac?1
	MOV	A,M
	CMA
	MOV	M,A
	XRA	A
	MOV	L,A
	SUB	B
	MOV	B,A
	MOV	A,L
	SBB	E
	MOV	E,A
	MOV	A,L
	SBB	D
	MOV	D,A
	MOV	A,L
	SBB	C
	MOV	C,A
	RET
shiftr: MVI	B,0
shftr1: SUI	8
	JC	shftr2
	MOV	B,E
	MOV	E,D
	MOV	D,C
	MVI	C,0
	JMP	shftr1
shftr2: ADI	9
	MOV	L,A
shftr3: XRA	A
	DCR	L
	RZ
	MOV	A,C
shradd: RAR
	MOV	C,A
	MOV	A,D
	RAR
	MOV	D,A
	MOV	A,E
	RAR
	MOV	E,A
	MOV	A,B
	RAR
	MOV	B,A
	JMP	shftr3
fmult3: MOV	B,E
	MOV	E,D
	MOV	D,C
	MOV	C,A
	RET
fmult:	CALL	sign@
	RZ
	MVI	L,0
	CALL	muldiv
	MOV	A,C
	STA	fmlt?1
	XCHG
	SHLD	fmlt?2
	LXI	B,0
	MOV	D,B
	MOV	E,B
	LXI	H,normal
	PUSH	H
	LXI	H,fmult2
	PUSH	H
	PUSH	H
	LXI	H,facl?
fmult2: MOV	A,M
	INX	H
	ORA	A
	JZ	fmult3
	PUSH	H
	MVI	L,8
fmult4: RAR
	MOV	H,A
	MOV	A,C
	JNC	fmult5
	PUSH	H
	LHLD	fmlt?2
	DAD	D
	XCHG
	POP	H
	LDA	fmlt?1
	ADC	C
fmult5: RAR
	MOV	C,A
	MOV	A,D
	RAR
	MOV	D,A
	MOV	A,E
	RAR
	MOV	E,A
	MOV	A,B
	RAR
	MOV	B,A
	DCR	L
	MOV	A,H
	JNZ	fmult4
pophrt: POP	H
	RET
div10@: CALL	pushf@
	LXI	B,8420H
	LXI	D,0000H
	CALL	movfr@
fdivt:	POP	B
	POP	D
fdiv:	CALL	sign@
	CZ	dv0err
	MVI	L,0FFH
	CALL	muldiv
	INR	M
	INR	M
	DCX	H
	MOV	A,M
	STA	fdiv?a
	DCX	H
	MOV	A,M
	STA	fdiv?b
	DCX	H
	MOV	A,M
	STA	fdiv?c
	MOV	B,C
	XCHG
	XRA	A
	MOV	C,A
	MOV	D,A
	MOV	E,A
	STA	fdiv?g
fdiv1:	PUSH	H
	PUSH	B
	MOV	A,L
fdivc:
	PUSH	H
	LXI	H,fdiv?c
	SUB	M
	POP	H
	MOV	L,A
	MOV	A,H
fdivb:
	PUSH	H
	LXI	H,fdiv?b
	SBB	M
	POP	H
	MOV	H,A
	MOV	A,B
fdiva:
	PUSH	H
	LXI	H,fdiv?a
	SBB	M
	POP	H
	MOV	B,A
fdivg:
	LDA	fdiv?g
	SBI	0
	CMC
	JNC	fdiv2
	STA	fdiv?g
	POP	PSW
	POP	PSW
	STC
	DB	0D2H
fdiv2:	POP	B
	POP	H
	MOV	A,C
	INR	A
	DCR	A
	RAR
	JM	roundb
	RAL
	MOV	A,E
	RAL
	MOV	E,A
	MOV	A,D
	RAL
	MOV	D,A
	MOV	A,C
	RAL
	MOV	C,A
	DAD	H
	MOV	A,B
	RAL
	MOV	B,A
	LDA	fdiv?g
	RAL
	STA	fdiv?g
	MOV	A,C
	ORA	D
	ORA	E
	JNZ	fdiv1
	PUSH	H
	LXI	H,fac?
	DCR	M
	POP	H
	CZ	overr
	JNZ	fdiv1
muldiv: MOV	A,B
	ORA	A
	JZ	muldv2
	MOV	A,L
	LXI	H,fac?
	XRA	M
	ADD	B
	MOV	B,A
	RAR
	XRA	B
	MOV	A,B
	JP	muldv1
	ADI	80H
	MOV	M,A
	JZ	pophrt
	CALL	unpack
	MOV	M,A
dcxhrt: DCX	H
	RET
mldvex: CALL	sign@
	CMA
	POP	H
muldv1: ORA	A
muldv2: POP	H
	CM	overr
	JMP	zero@
mul10@: CALL	movrf@
	MOV	A,B
	ORA	A
	RZ
	ADI	2
	CC	overr
	MOV	B,A
	CALL	fadd@
	LXI	H,fac?
	INR	M
	RNZ
	JMP	overr
sign@:	LDA	fac?
	ORA	A
	RZ
signc:	LDA	facl?2
	DB	(CPI)
fcomps: CMA
	RAL
	SBB	A
	RNZ
inrart: INR	A
	RET
fflo:	MVI	B,98H
	MOV	A,C
	JMP	floatr
float@: MVI	B,88H
	LXI	D,0000H
floatr: LXI	H,fac?
	MOV	C,A
	MOV	M,B
	MVI	B,0
	INX	H
	MVI	M,80H
	RAL
	JMP	fadflt
flneg@: LXI	H,facl?2
	MOV	A,M
	XRI	80H
	MOV	M,A
	RET
pushf@: XCHG
	LHLD	facl?
	XTHL
	PUSH	H
	LHLD	facl?2
	XTHL
	PUSH	H
	XCHG
	RET
movfm@: CALL	movrm@
movfr@: XCHG
	SHLD	facl?
	MOV	H,B
	MOV	L,C
	SHLD	facl?2
	XCHG
	RET
movrf@: LXI	H,facl?
	JMP	movrm@
inxhr@: INX	H
	RET
movmf@: LXI	D,facl?
move:	MVI	B,4
move1:	LDAX	D
	MOV	M,A
	INX	D
	INX	H
	DCR	B
	JNZ	move1
	RET
unpack: LXI	H,facl?2
	MOV	A,M
	RLC
	STC
	RAR
	MOV	M,A
	CMC
	RAR
	INX	H
	INX	H
	MOV	M,A
	MOV	A,C
	RLC
	STC
	RAR
	MOV	C,A
	RAR
	XRA	M
	RET
fcomp@: MOV	A,B
	ORA	A
	JZ	sign@
	LXI	H,fcomps
	PUSH	H
	CALL	sign@
	MOV	A,C
	RZ
	LXI	H,facl?2
	XRA	M
	MOV	A,C
	RM
	CALL	fcomp2
fcompd: RAR
	XRA	C
	RET
fcomp2: INX	H
	MOV	A,B
	CMP	M
	RNZ
	DCX	H
	MOV	A,C
	CMP	M
	RNZ
	DCX	H
	MOV	A,D
	CMP	M
	RNZ
	DCX	H
	MOV	A,E
	SUB	M
	RNZ
	POP	H
	POP	H
	RET
fint@:	LXI	B,6900H
	MOV	D,C
	MOV	E,C
	CALL	fadd@
	LXI	H,fac?
	MOV	A,M
qint@:	MOV	B,A
	MOV	C,A
	MOV	D,A
	MOV	E,A
	ORA	A
	RZ
	PUSH	H
	CALL	movrf@
	CALL	unpack
	XRA	M
	MOV	H,A
	CM	qinta
	MVI	A,98H
	SUB	B
	CALL	shiftr
	MOV	A,H
	RAL
	CC	rounda
	MVI	B,0
	CC	negr
	POP	H
	RET
qinta:	DCX	D
	MOV	A,D
	ANA	E
	INR	A
	RNZ
dcxbrt: DCX	B
	RET
int:	LXI	H,fac?
	MOV	A,M
	CPI	98H
	LDA	facl?
	RNC
	MOV	A,M
	CALL	qint@
	MVI	M,98H
	MOV	A,E
	PUSH	PSW
	MOV	A,C
	RAL
	CALL	fadflt
	POP	PSW
	RET
overr:	CALL	erreur
	DB	1
	RET
dv0err: CALL	erreur
	DB	3
	RET
erreur:
	XTHL
	PUSH	PSW
	LDA	errcod
	ORA	A
	JNZ	exiterr
	MOV	A,M
	STA	errcod
exiterr:
	INX	H
	POP	PSW
	XTHL
	RET
Hc@Bf:	CALL	Hc@Bl
	JMP	HiBf0
Hi@Bf:	CALL	Hi@Bl
HiBf0:	CALL	fflo
	JMP	movrf@
Hu@Bf:	CALL	Hu@Bl
Bl@Bf:
	MOV	A,B
	ORA	A
	JP	BlBf0
	CALL	L@neg
	MVI	A,-1
BlBf0:	PUSH	PSW
	PUSH	B
	MVI	C,0
	CALL	fflo
	POP	B
	CALL	pushf@
	MOV	E,C
	MOV	D,B
	MVI	C,0
	CALL	fflo
	LDA	fac?
	ORA	A
	JZ	R?b
	ADI	16
	STA	fac?
R?b:	POP	B
	POP	D
	CALL	fadd@
	POP	PSW
	ORA	A
	CM	flneg@
	JMP	movrf@
Bf@Hc:	CALL	Bf@Bl
	XCHG
	JMP	c@sxt
Bf@Hu:	DS	0
Bf@Hi:	CALL	Bf@Bl
	XCHG
	RET
Bf@Bl:	MOV	A,B
	ORA	A
	JNZ	BfBl0
	MOV	C,A
	MOV	D,A
	MOV	E,A
	RET
BfBl0:
	LXI	H,0
	MOV	A,C
	XRI	80H
	JM	BfBl1
	MOV	C,A
	INR	H
BfBl1:	MOV	A,B
	CPI	128+32
	JNC	BfBlov
	CPI	128+24
	JC	BfBl2
	SUI	8
	MOV	B,A
	INR	L
BfBl2:	PUSH	H
	CALL	movfr@
	CALL	fint@
	MVI	B,0
	POP	H
	DCR	L
	JNZ	BfBl3
	MOV	B,C
	MOV	C,D
	MOV	D,E
	MVI	E,0
BfBl3:	DCR	H
	RNZ
	JMP	L@neg
BfBlov: LXI	B,7FFFH
	LXI	D,-1
	JMP	BfBl3
F@not:	LXI	H,1
	MOV	A,B
	ORA	A
	RNZ
	DCR	L
	RET
flt@0:	MOV	A,B
	ORA	A
	RET
f?stak: DS	0
I@@F:	XTHL
	PUSH	H
	LXI	H,Hi@Bf
	JMP	C@1632
C@@F:	XTHL
	PUSH	H
	LXI	H,Hc@Bf
	JMP	C@1632
U@@F:	XTHL
	PUSH	H
	LXI	H,Hu@Bf
	JMP	C@1632
F@@C:	PUSH	H
	LXI	H,Bf@Hc
	JMP	C@3216
F@@U:	PUSH	H
	LXI	H,Bf@Hu
	JMP	C@3216
F@@I:	PUSH	H
	LXI	H,Bf@Hi
	JMP	C@3216
L@@F:	XRA	A
	JMP	C3232
F@@L:	MVI	A,1
C3232:	PUSH	B
	PUSH	D
	PUSH	H
	LXI	H,her@32
	PUSH	H
	LXI	H,10
	DAD	SP
	CALL	movrm@
	ORA	A
	JZ	Bl@Bf
	JMP	Bf@Bl
	RET
@tmvb:	DW	-27009,-26600
@umvb:	DW	9216,-27532
digc??: DB	0
fmtc??: DB	0
@vmvb:	DW	16960,15,-31072,1,10000,0,1000,0
	DW	100,0,10,0,1,0
@wmvb:	DW	9216,-27788,20480,-28605,16384,-29412,0,-30342
	DW	0,-31160,0,-31968,0,32768,-13107,31820
	DW	-10486,31011,4718,30211,-18666,29265,-14933,28455
	DW	-16493,27478,-13194,26667
ftoa:	LXI	H,8
	DAD	SP
	CALL	h@
	MOV	A,L
	STA	digc??
	LXI	H,10
	DAD	SP
	CALL	g@
	MOV	A,L
	STA	fmtc??
	LXI	H,4
	DAD	SP
	CALL	movrm@
	CALL	movfr@
	POP	D
	POP	H
	PUSH	H
	PUSH	D
	CALL	sign@
	JP	fout1
	MVI	M,'-'
	INX	H
fout1:	MVI	M,'0'
	JZ	fout19a
	PUSH	H
	CM	flneg@
	LDA	fmtc??
	ANI	0137Q
	CPI	'E'
	JZ	fout41
	LDA	digc??
	ADI	6
	CALL	f@round
fout41: XRA	A
	PUSH	PSW
	CALL	foutcb
fout3:	DS	0
	LXI	H,@umvb
	CALL	llong@
	CALL	fcomp@
	ORA	A
	JP	fout5
	CALL	mul10@
	POP	PSW
	DCR	A
	PUSH	PSW
	JMP	fout3
foutcb: DS	0
	LXI	H,@tmvb
	CALL	llong@
	CALL	fcomp@
	ORA	A
	POP	H
	JPO	fout9
	PCHL
fout9:	CALL	div10@
	POP	PSW
	INR	A
	PUSH	PSW
	CALL	foutcb
fout5:	LDA	fmtc??
	ANI	0137Q
	CPI	'E'
	JNZ	fout5a
	LDA	digc??
	CALL	f@round
	CALL	foutcb
fout5a: MVI	A,1
	CALL	qint@
	CALL	movfr@
	POP	PSW
	POP	H
	ADI	7-1
	MOV	C,A
	LDA	fmtc??
	ANI	0137Q
	CPI	'E'
	MVI	B,2
	MOV	A,C
	JZ	fout6
	ADI	2
	MOV	B,A
	MVI	A,0
	JZ	fout6a
	JP	fout6
fout6a: MVI	M,'.'
	INX	H
	LDA	digc??
	DCR	B
fout32: MVI	M,'0'
	INX	H
	DCR	A
	JZ	fout17
	INR	B
	JM	fout32
	MVI	B,0
	STA	digc??
	XRA	A
fout6:	PUSH	PSW
	LDA	digc??
	PUSH	PSW
	MVI	C,7
	XCHG
	LXI	H,@vmvb
	XCHG
fout8:	DCR	C
	JM	fout8b
	DCR	B
	JM	fout8g
	JNZ	fout8f
	MVI	M,'.'
	INX	H
fout8g: POP	PSW
	DCR	A
	JM	fout11
	PUSH	PSW
fout8f: PUSH	B
	PUSH	H
	PUSH	D
	CALL	movrf@
	POP	H
	MVI	B,2FH
fout10: INR	B
	MOV	A,E
	SUB	M
	MOV	E,A
	INX	H
	MOV	A,D
	SBB	M
	MOV	D,A
	INX	H
	MOV	A,C
	SBB	M
	MOV	C,A
	DCX	H
	DCX	H
	JNC	fout10
	CALL	fadda@
	INX	H
	INX	H
	CALL	movfr@
	XCHG
	POP	H
	MOV	M,B
	INX	H
	POP	B
	JMP	fout8
fout8b: MOV	A,B
	DCR	A
	CALL	foutt@
	DCR	B
	MVI	M,'.'
	CP	inxhr@
	POP	PSW
	CALL	foutt@
fout11: LDA	fmtc??
	ANI	040Q
	JNZ	fout12
fout11a: DCX	 H
	MOV	A,M
	CPI	'0'
	JZ	fout11a
	CPI	'.'
	CNZ	inxhr@
fout12: POP	PSW
	ORA	A
	JZ	fout17
fout20: MVI	M,'e'
	INX	H
	MVI	M,'+'
	JP	fout14
	MVI	M,'-'
	CMA
	INR	A
fout14: MVI	B,'0'-1
fout15: INR	B
	SUI	10
	JNC	fout15
	INX	H
	MOV	M,B
fout19: INX	H
	ADI	'0'+10
	MOV	M,A
fout19a: INX	H
fout17: MVI	M,0
	RET
foutt@: DCR	A
	RM
	MVI	M,'0'
	INX	H
	JMP	foutt@
f@round: ADD	A
	RM
	CPI	28
	RNC
	ADD	A
	MOV	E,A
	MVI	D,0
	LXI	H,@wmvb
	DAD	D
	CALL	movrm@
	JMP	fadd@
	RET
atof:	DS	0
	LXI	H,2
	DAD	SP
	MOV	E,M
	INX	H
	MOV	D,M
	XCHG
	MOV	A,M
	CALL	ffin
	JMP	movrf@
ffin:	CPI	'-'
	PUSH	PSW
	JZ	fin1
	CPI	'+'
	JZ	fin1
	DCX	H
fin1:	CALL	zero@
	MOV	B,A
	MOV	D,A
	MOV	E,A
	CMA
	MOV	C,A
finc:	CALL	chrgtr
	JC	findig
	CPI	'.'
	JZ	findp
	CPI	'e'
	JZ	founde
	CPI	'E'
	JNZ	fine
founde:
	CALL	chrgtr
	CALL	minpls
finec:	CALL	chrgtr
	JC	finedg
	INR	D
	JNZ	fine
	XRA	A
	SUB	E
	MOV	E,A
	INR	C
findp:	INR	C
	JZ	finc
fine:	PUSH	H
	MOV	A,E
	SUB	B
fine2:	CP	finmul
	JP	fine3
	PUSH	PSW
	CALL	div10@
	POP	PSW
	INR	A
fine3:	JNZ	fine2
	POP	D
	POP	PSW
	CZ	flneg@
	XCHG
	RET
finmul: RZ
finmlt: PUSH	PSW
	CALL	mul10@
	POP	PSW
dcrart: DCR	A
	RET
findig: PUSH	D
	MOV	D,A
	MOV	A,B
	ADC	C
	MOV	B,A
	PUSH	B
	PUSH	H
	PUSH	D
	CALL	mul10@
	POP	PSW
	SUI	30H
	CALL	finlog
	POP	H
	POP	B
	POP	D
	JMP	finc
finlog: CALL	pushf@
	CALL	float@
faddt:	POP	B
	POP	D
	JMP	fadd@
finedg: MOV	A,E
	RLC
	RLC
	ADD	E
	RLC
	ADD	M
	SUI	'0'
	MOV	E,A
	JMP	finec
chrgtr: INX	H
chrgt2: MOV	A,M
	CPI	':'
	RNC
chrcon: CPI	' '
	JZ	chrgtr
notlf:	CPI	'0'
	CMC
	INR	A
	DCR	A
	RET
minpls: DCR	D
	CPI	0A8H
	RZ
	CPI	'-'
	RZ
	INR	D
	CPI	'+'
	RZ
	CPI	0A7H
	RZ
	DCX	H
	RET

* Long runtime library; C/80 3.0 (5/28/83) - (c) 1983 Walter Bilofsky
* Rev. for DRI ASM's 5-2-85 drm

L?shif: DS	0
L@and:	LXI	H,2
	DAD	SP
	MOV	A,M
	ANA	E
	MOV	E,A
	INX	H
	MOV	A,M
	ANA	D
	MOV	D,A
	INX	H
	MOV	A,M
	ANA	C
	MOV	C,A
	INX	H
	MOV	A,M
	ANA	B
	MOV	B,A
	POP	H
	INX	SP
	INX	SP
	XTHL
	RET
L@asr:	XRA	A
	ORA	B
	ORA	C
	ORA	D
	JNZ	Lasr9
	ORA	E
	JZ	Lasr3
	MOV	A,E
	CPI	32
	JNC	Lasr9
Lasr2:	MVI	B,4
	LXI	H,5
	DAD	SP
	XRA	A
	MOV	A,M
	ORA	A
	JP	Lasr1
	STC
Lasr1:	MOV	A,M
	RAR
	MOV	M,A
	DCX	H
	DCR	B
	JNZ	Lasr1
	DCR	E
	JNZ	Lasr2
Lasr3:	POP	H
	POP	D
	POP	B
	PCHL
Lasr9:
	LXI	H,5
	DAD	SP
	MOV	A,M
	ORA	A
	MVI	A,0
	JP	Lasr8
	DCR	A
Lasr8:	MVI	B,4
Lasr7:	MOV	M,A
	DCX	H
	DCR	B
	JNZ	Lasr7
	JMP	Lasr3
L@asl:	XRA	A
	ORA	B
	ORA	C
	ORA	D
	JNZ	Lasl9
	ORA	E
	JZ	Lasr3
	MOV	A,E
	CPI	32
	JNC	Lasl9
Lasl2:	MVI	B,4
	LXI	H,2
	DAD	SP
	XRA	A
Lasl4:	MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Lasl4
	DCR	E
	JNZ	Lasl2
	JMP	Lasr3
Lasl9:	LXI	H,5
	DAD	SP
	XRA	A
	JMP	Lasr8
	RET
L?comp: DS	0
cl@lt:	LXI	H,4
	CALL	swaps@
cl@gt:	LXI	H,1
cl@glt: PUSH	H
	CALL	sstak
	POP	H
	PUSH	PSW
	CALL	long@0
	JNZ	clgt1
	POP	PSW
	JMP	clgt2
clgt1:	POP	PSW
	LXI	H,2
	JNC	clgt2
	DCR	L
clgt2:	POP	D
	POP	B
	POP	B
	PUSH	D
	DCR	L
	RET
cl@le:	LXI	H,4
	CALL	swaps@
cl@ge:	LXI	H,2
	JMP	cl@glt
sstak:	LXI	H,6
	DAD	SP
	MOV	A,M
	SUB	E
	MOV	E,A
	INX	H
	MOV	A,M
	SBB	D
	MOV	D,A
	INX	H
	MOV	A,M
	SBB	C
	MOV	C,A
	INX	H
	MOV	A,M
	MOV	L,B
	MOV	H,A
	SBB	B
	MOV	B,A
	PUSH	PSW
	MOV	A,H
	XRA	L
	JP	snorml
	POP	PSW
	CMC
	RET
snorml: POP	PSW
	RET
	RET
L?mdiv: DS	0
L@mul:	PUSH	B
	PUSH	D
	LXI	D,0
	PUSH	D
	PUSH	D
Lmshtx: MVI	B,4
	LXI	H,7
	DAD	SP
	XRA	A
Lmrtx:	MOV	A,M
	RAR
	MOV	M,A
	DCX	H
	DCR	B
	JNZ	Lmrtx
	JNC	Lmul0
	MVI	B,4
	LXI	H,10
	DAD	SP
	XCHG
	LXI	H,0
	DAD	SP
	XRA	A
Lmnxt:	LDAX	D
	ADC	M
	MOV	M,A
	INX	D
	INX	H
	DCR	B
	JNZ	Lmnxt
Lmul0:	LXI	H,4
	MOV	B,L
	MOV	A,H
	DAD	SP
Lmzchk: ORA	M
	JNZ	Lmshty
	INX	H
	DCR	B
	JNZ	Lmzchk
	JMP	Lmexi
Lmshty: MVI	B,4
	LXI	H,10
	DAD	SP
	XRA	A
Lmlfty: MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Lmlfty
	JMP	Lmshtx
Lmexi:	LXI	H,8
	DAD	SP
	MOV	E,M
	INX	H
	MOV	D,M
	INX	H
	INX	H
	INX	H
	MOV	M,E
	INX	H
	MOV	M,D
	POP	D
	POP	B
	LXI	H,8
	DAD	SP
	SPHL
	RET
L@mod:	MVI	L,0
	JMP	Ldiv0
L@div:	MVI	L,1
Ldiv0:	PUSH	H
	PUSH	B
	PUSH	D
	MOV	A,B
	ORA	A
	JP	Ldiv1
	CALL	negst4
	MVI	A,-1
Ldiv1:	PUSH	PSW
	LXI	H,0
	PUSH	H
	PUSH	H
	MVI	L,17
	DAD	SP
	MOV	B,M
	DCX	H
	MOV	C,M
	DCX	H
	MOV	D,M
	DCX	H
	MOV	E,M
	PUSH	B
	PUSH	D
	MOV	A,B
	ORA	A
	JP	Ldiv2
	CALL	negst4
	MVI	A,-1
Ldiv2:	LXI	H,9
	DAD	SP
	XRA	M
	MOV	M,A
	LXI	H,0
	PUSH	H
	PUSH	H
	MVI	A,32
Ldiv10: PUSH	PSW
	LXI	H,6
	DAD	SP
	XRA	A
	MVI	B,8
Ldiv3:	MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Ldiv3
	LXI	H,13
	DAD	SP
	XCHG
	LXI	H,19
	DAD	SP
	LXI	B,4*256
Ldiv5:	LDAX	D
	CMP	M
	JC	Ldiv4
	JNZ	Ldiv44
	DCX	H
	DCX	D
	DCR	B
	JNZ	Ldiv5
Ldiv44:
	INR	C
Ldiv4:
	CMC
	PUSH	PSW
	LXI	H,4
	DAD	SP
	POP	PSW
	MVI	B,4
Ldiv7:	MOV	A,M
	RAL
	MOV	M,A
	INX	H
	DCR	B
	JNZ	Ldiv7
	MOV	A,C
	ORA	A
	JZ	Ldiv8
	LXI	H,16
	DAD	SP
	XCHG
	LXI	H,10
	DAD	SP
	XRA	A
	XCHG
	MVI	B,4
Ldiv9:	LDAX	D
	SBB	M
	STAX	D
	INX	H
	INX	D
	DCR	B
	JNZ	Ldiv9
Ldiv8:
	POP	PSW
	DCR	A
	JNZ	Ldiv10
	LXI	H,18
	DAD	SP
	MOV	A,M
	ORA	A
	JNZ	Ldiv20
	LXI	H,8
	DAD	SP
	XCHG
	LXI	H,0
	DAD	SP
	XCHG
	MVI	B,4
Ldiv21: MOV	A,M
	STAX	D
	INX	H
	INX	D
	DCR	B
	JNZ	Ldiv21
Ldiv20:
	LXI	H,13
	DAD	SP
	MOV	A,M
	ORA	A
	CM	negst4
	POP	D
	POP	B
	LXI	H,16
	DAD	SP
	SPHL
outLL:	POP	H
	INX	SP
	INX	SP
	XTHL
	RET
negst4:
	PUSH	H
	PUSH	B
	LXI	B,4*256
	LXI	H,6
	DAD	SP
	XRA	A
ngst4l: MOV	A,C
	SBB	M
	MOV	M,A
	INX	H
	DCR	B
	JNZ	ngst4l
	POP	B
	POP	H
	RET
L@or:	LXI	H,2
	DAD	SP
	MOV	A,M
	ORA	E
	MOV	E,A
	INX	H
	MOV	A,M
	ORA	D
	MOV	D,A
	INX	H
	MOV	A,M
	ORA	C
	MOV	C,A
	INX	H
	MOV	A,M
	ORA	B
	MOV	B,A
	JMP	outLL
L@xor:	LXI	H,2
	DAD	SP
	MOV	A,M
	XRA	E
	MOV	E,A
	INX	H
	MOV	A,M
	XRA	D
	MOV	D,A
	INX	H
	MOV	A,M
	XRA	C
	MOV	C,A
	INX	H
	MOV	A,M
	XRA	B
	MOV	B,A
	JMP	outLL
	RET

* 32 bit common library routines; C/80 3.0 (7/1/83) - (c) 1983 Walter Bilofsky
* Rev. for DRI ASM's 5-2-85 drm

Four?b: DS	0
movrm@:
llong@: MOV	E,M
	INX	H
	MOV	D,M
	INX	H
	MOV	C,M
	INX	H
	MOV	B,M
	INX	H
	RET
st4@:	XTHL
	CALL	llong@
	XTHL
slong@: MOV	M,E
	INX	H
	MOV	M,D
	INX	H
	MOV	M,C
	INX	H
	MOV	M,B
	RET
eq@4:	POP	H
	PUSH	B
	MVI	C,1
	JMP	comp@4
neq@4:	POP	H
	PUSH	B
	MVI	C,0
comp@4:
	PUSH	D
	PUSH	H
	LXI	H,2
	DAD	SP
	XCHG
	LXI	H,6
	DAD	SP
	MVI	B,4
lneq@4: LDAX	D
	CMP	M
	INX	H
	INX	D
	JNZ	diff
	DCR	B
	JNZ	lneq@4
	XRA	A
	JMP	exneq
diff:	MVI	A,1
exneq:	POP	H
	POP	D
	POP	D
	POP	D
	XTHL
	MVI	H,0
	XRA	C
	MOV	L,A
	RET
swap4@: LXI	H,2
swaps@: DAD	SP
	MOV	A,M
	MOV	M,E
	MOV	E,A
	INX	H
	MOV	A,M
	MOV	M,D
	MOV	D,A
	INX	H
	MOV	A,M
	MOV	M,C
	MOV	C,A
	INX	H
	MOV	A,M
	MOV	M,B
	MOV	B,A
	RET
long@0: MOV	A,B
	ORA	C
	ORA	D
	ORA	E
	RET
L@not:	LXI	H,1
	CALL	long@0
	RNZ
	DCR	L
	RET
l?stak: DS	0
C@@L:	XTHL
	PUSH	H
	LXI	H,Hc@Bl
	JMP	C@1632
U@@L:	XTHL
	PUSH	H
	LXI	H,Hu@Bl
	JMP	C@1632
I@@L:	XTHL
	PUSH	H
	LXI	H,Hi@Bl
C@1632: PUSH	B
	PUSH	D
	PUSH	H
	LXI	H,8
	DAD	SP
	CALL	movrm@
	POP	H
	PUSH	D
	LXI	D,her@32
	PUSH	D
	PUSH	H
	MOV	H,B
	MOV	L,C
	RET
her@32: LXI	H,8
	DAD	SP
	CALL	slong@
	POP	H
	POP	D
	POP	B
	RET
L@@C:	PUSH	H
	LXI	H,Bl@Hc
	JMP	C@3216
L@@U:	PUSH	H
	LXI	H,Bl@Hu
	JMP	C@3216
L@@I:	PUSH	H
	LXI	H,Bl@Hi
C@3216: PUSH	B
	PUSH	D
	PUSH	H
	LXI	H,10
	DAD	SP
	CALL	movrm@
	POP	H
	CALL	callhl
	MOV	B,H
	MOV	C,L
	LXI	H,6
	DAD	SP
	MOV	E,M
	INX	H
	MOV	D,M
	INX	H
	CALL	slong@
	POP	D
	POP	B
	POP	H
	POP	PSW
	RET
callhl: PCHL
	RET
I?long: DS	0
Hu@Bl:	XCHG
	LXI	B,0
	RET
Hc@Bl:	MOV	A,L
	CALL	sgnbyt
	MOV	E,L
	MOV	D,A
	MOV	C,A
	MOV	B,A
	RET
Hi@Bl:	MOV	A,H
	CALL	sgnbyt
	XCHG
	MOV	C,A
	MOV	B,A
	RET
sgnbyt: ORA	A
	MVI	A,-1
	RM
	INR	A
	RET
Bl@Hu:
Bl@Hi:	XCHG
	RET
Bl@Hc:	XCHG
	JMP	c@sxt
	RET
L?adsb: DS	0
L@sub:	CALL	L@neg
L@add:	POP	H
	XTHL
	DAD	D
	XCHG
	POP	H
	XTHL
	MOV	A,L
	ADC	C
	MOV	C,A
	MOV	A,H
	ADC	B
	MOV	B,A
	RET
L@neg:	MVI	A,0
	SUB	E
	MOV	E,A
	MVI	A,0
	SBB	D
	MOV	D,A
	MVI	A,0
	SBB	C
	MOV	C,A
	MVI	A,0
	SBB	B
	MOV	B,A
	RET
L@com:	MOV	A,E
	CMA
	MOV	E,A
	MOV	A,D
	CMA
	MOV	D,A
	MOV	A,C
	CMA
	MOV	C,A
	MOV	A,B
	CMA
	MOV	B,A
	RET
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

strcpy(to, from)
char *to, *from;
{
#asm
	POP	B	; return address
	POP	H	; get from arg
	POP	D	; get to arg
	PUSH	D	; restore stack for caller
	PUSH	H
	PUSH	B
	DCX	H	; back off for a running start
STLOOP: INX	H	; point at next FROM char
	MOV	A,M	; put it into accumulator
	STAX	D	; store it in TO string
	INX	D	; increment TO string
	ORA	A	; check for last char
	JNZ	STLOOP	; copied the 0 byte.  Go away.
#endasm
}

 string
	INX	D	; increment TO string
	ORA	A	; check for last chееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее#define NOLONG			/* define to defeat long integer code */
#define NOFLOAT 		/* define to defeat float code */
/*
 * SCANF.C for C/80 Version 3.1
 * by Grant B. Gustafson, 1982-83
 * Version Date: 1/25/84
 *
 * Purpose: To provide formatted input as described on pages 147-149
 *	    of Kernighan & Ritchie, "The C Programming Language",
 *	    Prentice-Hall, Englewood Cliffs, 1978.
 *	    Switchable float and long support for the C/80 Mathpak.
 *
 * Returns: The number of successfully matched and assigned data items
 *	    A short count is returned for missing or illegal data items
 *	    EOF = -1 is returned for end-of-file
 *
 * Limitations:
 *
 *     1. The function ungetc() must be used on exit from scanff() to meet
 *	  the K & R (p 148) specification.  A very limited ungetc is included,
 *	  but it only affects reading with scanf.  If you mix scanf calls with
 *	  other functions using getc or getchar, strange things will happen.
 *
 *     2. Under C/80, the coding n = (scanf(...)); returns the
 *	  number n of arguments processed. Double parentheses are required.
 *	  WARNING:  n = scanf(...); will fill n with a stack address.
 *
 * Portability:
 *
 * Radix 2 conversion %b is not listed in the K&R standard, however
 * it is available in many modern compilers. Primary use is debugging.
 *
 * Short integers %h are taken to be the same as integers %d. This is
 * in keeping with the PDP-11 16-bit machine standard (K & R page 182).
 *
 * Unix conversion %[...]: Reference: S.R.Bourne, "The Unix System", p 306.
 * String input using a limited character set. At least 2 chars must
 * follow %[ and the last must be ]. Use %[^ to mean "all but", or the
 * complement of the allowed character set.
 *
 * Examples:  %[^\n] inputs a string until a newline is found.
 *	      %[0-9A-F] inputs a string using 0123456789ABCDEF only.
 *	      %[^\1\3\n\32] inputs until ctrl-A, crtl-C or ctrl-Z.
 *	      %[^]--] inputs until a ']' or '-' is found.
 *
 * The Unix conversions %hd, %hx, %ho, %D, %O, %X, %E, %F are not supported.
 *
 * Both getchar() and getc() are assumed to follow the K&R convention
 * of returning -1 for END-OF-FILE. We do not translate getc() = 26 (^Z).
 *
 * History:
 * 7/83 first release
 * kill0x() bug, NOLONG/NOFLOAT switches, data type & function coercion. GBG
 * %% bug fix, Unix string input %[...]. 8/83 GBG
 * tolower and simple ungetc 1/84 WB
 *
 */

/* See S.R.Bourne, "The Unix System", p 309. NOT the same as in stdlib.c */
static char *index(str,c) char *str;
{ static char *p; p = str;
  while(*p) { if(*p - c) ++p; else return p;}
  return 0;}

/* Define white space for binary mode.	NOT the same as in stdlib.c */
static int Isspace(ch) char ch;
{ return (index("\40\t\r\n",ch) ? 1:0);}

static tolower(c) char c; {
	if (c >= 'A' && c <= 'Z') c += 'a' - 'A';
	return c; }

static int bufFLAG = 0,chan,radix,hadany,_keep;
static char *memory;
static union { char c; int i;
#ifndef NOLONG
	long l;
#endif
#ifndef NOFLOAT
	float f;
#endif
		} **STKtop;

static int nxtCHR()			/* get buffered char from input */
{ static int _keep;			 /* return -1 for end of file */
  if(bufFLAG) return _keep;		 /* or next input stream char */
  bufFLAG = -1;
  if(chan) return (_keep = getc(chan));
  if(memory) return (_keep = (*memory ? *memory++ : -1));
  return (_keep = getchar());
}

static advCHR() 			/* advance to next buffered char */
{ static i;
  if((i = nxtCHR()) != -1) { bufFLAG = 0;
		hadany = 1; }		/* tally to remember nr chars eaten */
  return i; }

static skipBL() 			/* skip over BLanks */
{ while( Isspace(nxtCHR()) ) advCHR();
  hadany = 0; } 			/* remember no chars eaten */

static int cvDIGIT(ch)			/* return value of digit or -1 */
{ static int z;
	if((z = ch) >= '0' && z <= '9') z -= '0';
  else	if((z &= 0137) >= 'A' && z <= 'F') z -= 'A' - 10;
  else	return (-1);
	if(z < radix) return z;
  return (-1);
}

static kill0x() 			/* kill 0x from hex string */
{ skipBL();
  if(nxtCHR() != '0') return;
  advCHR();
  if(tolower(nxtCHR()) == 'x') advCHR();
}

static char unchars[11] = {0,0,0,0,0,0,0,0,0,0,0};

ungetc(c,chan) {
	unchars[chan < 32 ? chan : chan - 25] = c; }

static int scanff(arg)			/* called by scanf, sscanf, fscanf */
char *arg;
{ static int n,NOsupr,sign,value,width,x,cc,*STKlow;
  static char *p,*q,*format;
  auto char strBUF[81];

#ifndef NOLONG
  static long ln;
#endif
#ifndef NOFLOAT
  float atof();
#endif
  bufFLAG = _keep = unchars[n = chan < 32 ? chan : chan - 25];
  n = unchars[n] = 0;
  STKlow = &arg;
  format = *--STKtop;
   while((cc = *format++) && nxtCHR() != -1)
	{ if(Isspace(cc)) continue;
	  if(cc == '%')
	    if(*format != '%') goto start; else ++format;
	  skipBL(); if(cc != nxtCHR() ) break; advCHR(); continue;
start:	  sign = NOsupr = 1;
	  if(*format == '*') { NOsupr = 0; ++format;}
	  else if(--STKtop == STKlow) goto quit;
	  width = 0; radix = 10;
	  while((x = cvDIGIT(cc = *format++)) != -1) width = width*radix + x;
	  switch(tolower(cc))
	     { case 'x': kill0x(); radix = 16; goto loop;
	       case 'o': radix = 8; goto loop;
	       case 'b': radix = 2; goto loop;
	       case 'h':
	       case 'd': skipBL(); if(nxtCHR() != '-') goto loop;
			 sign = -1; advCHR();
  loop:        case 'u': value = 0; skipBL();
			 while((x = cvDIGIT(nxtCHR())) != -1)
			      { value = value*radix + x;
				advCHR();
				if(--width == 0) break;
			      } /* end while */
			 if (hadany == 0) goto quit;	/* If no chars eaten */
			 if(NOsupr) (*STKtop)->i = sign*value;
			 break;
	       case 's': skipBL();
			 if(NOsupr) p = *STKtop;
			 while((x = nxtCHR()) != -1)
			      { if(Isspace(x)) break;
				advCHR();
				if(NOsupr) *p++ = x;
				if(--width); else break;
			      } /* end while */
			 if(NOsupr) *p = '\0';
			 if (hadany == 0) goto quit;	/* If no chars eaten */
			 break;
	       case 'c': if (nxtCHR() == -1) goto quit;
			 if(NOsupr) (*STKtop)->c = nxtCHR();
			 advCHR(); break;
	       case '[': sign = cc = 0;
			 if((x = *format++) == '^') { cc = 1; x = *format++;}
			 if((q = index(format,']')) == 0) goto quit;
			 p = strBUF;
			 while(format <= q && ++sign < 80)
			      { *p++ = x;
				if(*format == '-')
				  { ++format;
				    while(x < *format && ++sign < 80)
					 *p++ = ++x;
				  }
				x = *format++;
			      }
			 format = q+1; *p = '\0';

			 p = *STKtop;
			 while((x = nxtCHR()) != -1)
			      { q = index(strBUF,x);
				if((cc && q == 0) || (q && cc == 0))
				  { if(NOsupr) *p++ = x; advCHR();}
				else break;
			      }
			 if(NOsupr) *p = '\0';
			 break;
/* long integer code */
#ifndef NOLONG
	       case 'l': switch(tolower(*format++))
			   { case 'x': kill0x(); radix = 16;
				       goto loop1;
			     case 'o': radix = 8; goto loop1;
			     case 'b': radix = 2; goto loop1;
			     case 'd': skipBL();
				       if(nxtCHR() - '-');
				       else { sign = -1; advCHR();}
	  loop1:	     case 'u': skipBL();
				  ln = 0;
				  while((x = cvDIGIT(nxtCHR())) != -1)
				     { ln = ln * radix + x;
				       advCHR();
				       if(--width == 0) break;
				     } /* end while */
				  if(sign - 1) ln = -ln;
				  if (hadany == 0) goto quit;
				  if(NOsupr) (*STKtop)->l = ln;
				  break;
			     case 'e':	/* double is an error */
			     case 'f':
			     default:  goto quit;
			   } /* end switch */
			 break;
#endif
/* float code */
#ifndef NOFLOAT
	       case 'e':
	       case 'f': skipBL(); p = strBUF;
			 if(width > 20) width = 20;
			 while((x = nxtCHR()) != -1)
			      { if(index("0123456789.-+Ee",x) )
				  { *p++ = x; advCHR();}
				else break;
				if(--width == 0) break;
			      } /* end while */
			 *p = '\0';
			 if (hadany == 0) goto quit;
			 if (NOsupr) (*STKtop)->f = atof(strBUF);
			 break;
#endif
	       default:  goto quit;
	     } /* end switch case */
	     n += NOsupr;
	} /* end while */
quit:
 if(memory) return n;			/* no end of file for a string */
 while((x = nxtCHR()) != -1)
      { if(x == '\n') break;		/* normal with linefeed terminator */
	if(Isspace(x)) advCHR();	/* delete trailing blanks */
	else { ungetc(x,chan);		/* put last char back on input */
	       break;}
      } /* end while */
 return nxtCHR() != -1 ? n :		/* not at end of file */
			     -1;	/* return -1 for end of file */
} /* end function scanff() */

STK_pos(arg) int arg;
{ chan=memory=0; STKtop = &arg;}	/* find entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scan()
{ memory = *--STKtop; return scanff();}

/* definitions for multiple args */
#undef scanf
#undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscanf STK_pos(),s_scan

/* end file SCANF.C */
f
	SBB	C
	MOV	C,A
	MVI	A,0
	SBB	B
	MOV	B,A
	RET
L@com:	MOV	A,E
	CMA
	MOV	E,A
	MOV	A,D
	CMA
	MOV	D,A
	MOV	A,C
	CMA
	MOV	C,A
	MOV	A,B
	CMA
	MOV	B,A
	RET
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* C/80 3.0 Transcendental function library (6/6/83).  (c) 1983 Walt Bilofsky;
   (c) 1982 Knowledge Engineering Inc.	Reproduction of all or any part of
   this material in source or assembly language form is prohibited.
   Object programs containing executable code generated by this material
   may be distributed without restriction; credit to C/80 is appreciated. */

/* Source for the transcendental functions: "Computer Approximations,"
   by Hart, Cheney, et al., John Wiley & Sons, Inc., NY, 1968.	Part of
   the SIAM series in Applied Mathematics.  */

#define pi2    1.570796326795
#define pi     3.14159265359
#define sqrt10 3.162277660168
#define ln10   2.302585092994
#define log10e 0.43429448190
#define log2   0.30102999567

#ifneed cos
float cos(f) float f;
{   float sin(), fabs();
    return sin(fabs(f) + pi2); }
#endif

#ifneed sin
float sin(arg)
float arg;
{	/* Coefficients are #3370 from Hart & Cheney (18.80D). */
	static float p[5] = {
	  .1357884e8, -.49429081e7, .440103053e6, -.138472724e5, .145968841e3 };
	static float q[5] = {
	  .864455865e7, .408179225e6, .946309610e4, .132653491e3, 1.0 };
	static float y,ysq;
	static long quad,e;
	float F_poly();

	quad = (arg >= 0.0) ? 0 : (arg = -arg, 2);
	arg *= .63661977;		/* 2 / pi */
	y = arg - (e = arg);
	quad=(e + quad) % 4;
	if (quad & 1) y = 1.0 - y;
	if(quad & 2) y = -y;

	ysq = y * y;
	return y * F_poly(ysq,p,4)/F_poly(ysq,q,4);
}
#endif

#ifneed atan
float atan(f) float f;
/*	Eqns. 6.5.21, & 6.5.22	& Table 5097 */
{	static float p[6] = {
		33.05861847399, 58.655751569, 32.3909748562,
		5.853195211263, .1952374193623, -.002434603300441 };
	static float q[5] = {
		33.05861847399, 69.67529105952, 49.00434821822,
		12.97557886271, 1.0};
	static int sign, recip;
	float F_poly(),fabs();

	float f2, f2sq;
	if ((f2 = fabs(f)) == 0.0) return 0;
	if (recip = (f2 > 1.0)) f2 = 1.0 / f2;	/* 0 < f2 < 1 */
	f2sq = f2 * f2;
	f2 =* F_poly(f2sq, p, 5) / F_poly(f2sq, q, 4);
	if (recip) f2 = pi2 - f2;
	return f < 0.0 ? -f2 : f2;
}
#endif

#ifneed sqrt
float sqrt(f) float f;
/*	Eqns. 6.1.3 & 6.1.7; Initial guess from table 0231 */
{	static float p[] = {.58812e-2, .5267875, .5881229 };
	static float f2, temp, scale;
	static int t;
	float F_poly();

	if (f < 0.0) return -1.0;
	if (f == 0.0) return 0.0;
	scale = 1.0;
	while (f > 1.0) { f =* 0.01; scale =* 10.0; }
	while (f < 0.01) { f =* 100.0; scale =* 0.1; }
	f2 = F_poly(f, p, 2) / (f + .999998e-1);
	for (t = 10; t--; ) {
		temp = 0.5 * (f2 + f / f2);
		if (temp == f2) break;
		f2 = temp; }
	return f2 * scale;
}
#endif

#ifneed exp
float exp(f) float f;		/* = e^f */
{	float pow10();
	return pow10(log10e * f); }
#endif

#ifneed pow
float pow(f1,f2)	      /* f1 ^ f2 */
float f1,f2;
{	static int i;
	static float p,ans;
	float log(),fabs(),pow10();

	p = fabs(f2);		/* Note - doesn't check for neg power */
	ans = 1.0;
	if ((i = p) < 10 && (float)i == p) while (i--) ans =* f1;
	    else ans = pow10(p * log(f1));
	return f2 < 0.0 ?  1.0/ans : ans;
	}
#endif

#ifneed pow10
float pow10(f) float f; 	/* 10^f */
/*	Eq. 6.2.34 & Table 1403 */
{	static float c[7] = {
		1.0, .2302585092158E1, .2650949191501E1, .2034670312104E1,
		.1171493469046E1, .5358845480519, .2321569786604 };
	static float powtn[9] = {
		.1258925411794E+01, .1584893192461E+01, .1995262314969E+01,
		.2511886431510E+01, .3162277660168E+01, .3981071705535E+01,
		.5011872336273E+01, .6309573444802E+01, .7943282347243E+01 };
	static float powt[9] = {1e1,1e2,1e3,1e4,1e5,1e6,1e7,1e8,1e9};
	static float powtt[3] = {1e10, 1e20, 1e30};
	static int n1, n2, recip;
	static float f2;
	float F_poly();

	if (recip = (f < 0.0)) f = -f;
	if (f > 39.0) return 0.0;	/* Error - overflow */
	n1 = n2 = 0;
	if (f >= 0.1) {
		n1 = f; f =- n1;
		n2 = 10.0 * f; f =- 0.1 * n2; }
	f2 = f ? F_poly(f,c,6) : 1.0;
	if (n2) f2 =* powtn[n2-1];
	if (n1 >= 10) {	f2 =* powtt[n1/10 - 1];
			n1 =% 10; }
	if (n1) f2 =* powt[n1-1];
	return recip ? 1.0/f2 : f2; }
#endif

#ifneed ln
float ln(f) float f; { float log(); return log(f) * ln10; }
#endif

/* Natural and base 10 log routines */
#ifneed log
float log(f) float f;
/*	From Table 2325 & Eq. 6.3.28 */
{	static float p[4] = { -8.625170319686, 11.70031513942,
			      -3.932918863942, 0.1960631750250};
	static float q[4] = { -9.930094301066, 16.78051701465, -8.135425915213,
			       1.0 };
	static float n, z, zsq, num;
	static int pow2;
	float F_poly();
	union { float f_;
		char c_[4]; } ff;


	if (f <= 0) return 0;		/* Error */
	ff.f_ = f;
	pow2 = (0xFF & ff.c_[3]) - 0x80;/* Get exponent and set to 0 */
	ff.c_[3] = 0x80; f = ff.f_;	/* and put back in f. */
	if (f == 0.5) { z = 0.0; --pow2;}	/* Log 1 is 0 */
	else {	num = f * sqrt10;	/* Now compute log10 of fract. part */
		z = (num - 1.0) / (num + 1.0);
		zsq = z * z;
		z = (z * F_poly(zsq,p,3) / F_poly(zsq,q,3) - 0.5);
		}
	return z + pow2 * log2; 	/* Add exponent back in */
	}
#endif

#ifneed F_poly
float F_poly(x, p, n)  /* evaluate nth deg. polynomial, n >= 1 */
float x,p[];
{   static float result;  static int i;
    for (result = p[i = n]; i; ) result = p[--i] + x * result;
    return result; }
#endif

#ifneed fabs
float fabs(f) float f; { return f < 0 ? -f : f; }
#endif
; ) re	/* return -1 for end of file */
} /* end function scanff() */

STK_pos(arg) int arg;
{ chan=memory=0; STKtop = &arg;}	/* find entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* unlink - remove (erase) a file from the file directory  */
/* May 10, 1984 07:40 drm */
extern defbuf;
unlink(name)
char *name[];
{
	char fcb[36];

	makfcb(name,fcb);	       /* make fcb for name */
	bdos(26,defbuf);	       /* first, set dma addr to junk area */
	bdos(19, fcb);		       /* erase the file */
}

r name */
	bdos(26,defbuf);	       /* first, set dma add
	return z + pow2 * log2; 	/* Add exponent back in */
	}
#endif

#ifneed F_poly
float F_poly(x, p, n)  /* evaluate nth degееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* printf.c: library file for format, fformat, and printf
 * compile: c -l32000
 * J. J. Gillogly, Apr 80
 * sprintf added J. J. Gillogly, Jul 80
 * Modified Jan 82 to work with #define kludge for multiple printf args
 * %u and unsigned octal and hex added WB Feb 82
 * long and floating descriptors added HT Apr 83
 * Split for float/nonfloat and long/nonlong versions WB 5/25/83.
 * Fix floating precision default, %3c, %% WB 11/15/83.
 * Fix for unsigned chars WB 12/26/83.
 * Fix for I/O redirection John Toscano 4/17/84.
 */

/*#define NOFLOAT 1	/* Define to eliminate floating point code*/
/*#define NOLONG 1	/* Define to eliminate longs */

#undef printf
#undef fprintf
#undef sprintf

static int *prnt_p,	/* Pointer into printf arglist */
	    Pfo;	/* Channel number for output */
static char *Pf = "",	/* current location in user's format */
	    *Pst;	/* current location in user's output string */
static int Width;	/* minimum field width */
static int Pr;		/* precision */
static int ch;		/* really char but int is more efficient */
static char Pad;
static int ljust;	/* left-adjust flag */
static char *nbp,*nbpe; /* pointer to ascii converted number */

/* define functions to reduce entry points */
static Ps(),Pc(),getnum(),putsi(),putui(),putfld(),putpad(),hexdig();
static char *ocvti();

#ifndef NOLONG
#define int_typ long
#define uns_typ long
#else
#define int_typ int
#define uns_typ unsigned
#endif

#ifndef NOFLOAT
static putdb();
#endif

#define NBS 80

/* prnt_1 is used to mark the position of
   the printf argument list on the stack.
   Visually, the arguments, starting with the format string, will
   be stacked right below the marked position (prnt_p). The
   stacked arguments are values !!! (16- or 32-bits)
*/
prnt_1(firstarg) { prnt_p = &firstarg; }	/* Record arglist start */

prnt_2(lastarg) {
	format (*--prnt_p);			/* Process arglist */

#asm
@prnt@: DS	0
#endasm

/* now we are going to print the values. Instead of passing to printf
   the value to print (of unknown type), we pass the current pointer
   to the argument list. It is the responsibility of "printf" to
   retrieve the value physically located at prnt_p - 2 (if 16-bit) or
   prnt_p - 4 (if 32-bit). "printf" must also update prnt_p accordingly.
*/
	while (prnt_p > &lastarg) printf(prnt_p); }

prnt_3(lastarg) {
	Pfo = *--prnt_p;	
	fformat(Pfo,*--prnt_p);

#asm
	JMP	@prnt@
#endasm
/*	while (prnt_p > &lastarg) printf(prnt_p);	*/
}

prnt_4(lastarg) {	
	Pst = *--prnt_p;
	sformat(Pst,*--prnt_p);

#asm
	JMP	@prnt@
#endasm
/*	while (prnt_p > &lastarg) printf(prnt_p);	*/
}

format(form)
char *form;
{	extern fout;
	fformat(fout,form);
}

fformat(chan,form)
char *form;
{	Pfo = chan;
	Pf = form;
	Ps();
}

sformat(string,form)	/* user wants data to go to a string */
char *string,*form;
{	Pst = string;
	fformat(-2,form);/* illegal value for a channel */
}

static Ps()    /* output format up to next % */
{	while (*Pf != 0 && *Pf != '%') Pc(*Pf++);
}

static Pc(c)
char c;
{	if (Pfo == -2) {
		*Pst++ = c;
		*Pst = 0;	/* terminate each intermediate string */
		return; }
	putc(c,Pfo);
}

printf(arg)	/* print one arg using current format */
union {
	int *ival;
#ifndef NOLONG
	long *lval;
#endif
#ifndef NOFLOAT
	float *fval;
#endif
	} arg;
	{
		static int racine,realPr;
		static unsigned int uarg;
#ifndef NOLONG
		static long larg;
#endif
		static char *ptr,*end;

		arg.ival = prnt_p ;
		prnt_p -= 1;	/* update assuming a 16-bit value to print */
	again:	racine = Pr = 0;
		realPr = -1;

		if ((ch = *++Pf) == 0) return;
		Pad = ' ';
		if (ljust = (ch == '-')) ch = *Pf++;
		if (ch == '0') { Pad = '0'; ch = *Pf++; }
		Width = getnum();
		if (ch == '.') { ++Pf ; realPr = Pr = getnum(); }
		if ((ch = *Pf++) != 's' && Pr > 7) Pr = 7;
		switch (ch) {	/* decode the conversion type */

		case 'c':	ptr = --arg.ival;
				putfld(ptr,ptr+1); break;
		case 'd':	putsi((int_type)*--arg.ival,10); break;
#ifndef NOLONG
		case 'l':
			prnt_p -= 1; /* total 32-bit update */
			larg = *--arg.lval;
			switch (ch = *Pf++) {
			case 'u' :	/* Unsigned long print doesn't work */
			case 'd' :	putsi(larg,10); break;
			case 'o' :	racine = 8; goto p_ul;
			case 'x' :	racine = 16;
	p_ul:				putui(larg,racine);
					break;
				}
			break;
#endif
#ifndef NOFLOAT
		case 'f' :
		case 'e' :
		case 'g' :	
				if (realPr == -1) Pr = 6;
				prnt_p -= 1; /* total 32-bit update */
				putdb(*--arg.fval,ch);break;
#endif
		case 'o' :	racine = 8; goto p_ui;
		case 'u' :	racine = 10; goto p_ui;
		case 'x' :	racine = 16;
	p_ui:			uarg = *--arg.ival;
				putui((uns_type)uarg,racine);
				break;

		case 's' :	
				for (end = ptr = *--arg.ival; *end++; );
				if (--end - ptr > Pr && Pr) end = ptr + Pr;
				putfld(ptr,end);
				break;

		case 0	 :	return;
		default  :	Pc(ch); Ps(); goto again;
		}
		
	Ps();
}

static getnum () {
	int n;
	for (n=0; (ch = *Pf) >= '0' && ch <='9'; )
		n = 10*n + *Pf++ - '0';
	return n;
}

/* unsigned integer/long conversions to ascii. the number sn is
   converted in the specified radix sr. the ascii digits are
   generated in a buffer. the value returned is a pointer to
   the first character in the buffer.  The following routines use
   either longs or ints, depending on whether NOLONG is defined.
*/

static char *
ocvti (buflim, aln, alr)
char *buflim; uns_type aln;
	{
	static int lr;
	static uns_type ln;
	lr = alr; ln = aln;
	do {
		*--buflim = hexdig(lr == 10 ? ln % 10 : ln & (lr -1));
#ifndef NOLONG
		ln = 0x7FFFFFFF & (ln >> 1);	/* Fix for looping - WB */
		ln = lr == 8 ? ln >>2 : lr == 10 ? ln/5 : ln>>3 ;
#else
		ln = lr == 8 ? ln >>3 : lr == 10 ? ln/10 : ln>>4 ;
#endif
		}
	while (ln) ;
	return buflim;
}

/* Output a signed integer in the specified radix. */
static putsi(n,radix)
int_type n;	{
	char nbuf[NBS];  /* conversion buffer */
	static int_type dsn;
	dsn = n < 0 ? -n : n;
	nbp = ocvti ( nbpe = nbuf+NBS, dsn, radix);
	if (n < 0) {	if (Pad != ' ') { Pc('-'); --Width; }
			      else *--nbp = '-';
		   }
	putfld (nbp, nbpe);
}

static putui(ui,radix) /* output an unsigned integer in the specified radix */
uns_type ui;
	{
	char nbuf[NBS];  /* conversion buffer */

	nbp = ocvti (nbpe = nbuf + NBS, ui, radix);
	putfld (nbp, nbpe);
}
	
static putfld(string, end)/* output a field containing a specified string ending
			     at end. Takes care of justification and padding.
			  */
char *string,*end;
	{
	static int length;
	length = end - string;
	if (! ljust)
		putpad(Pad,length);
	while (length--) {
		Pc (*string++);
		--Width;
		}
	if (ljust) putpad(' ',0);
}

static putpad(ch,count) {
	while (Width > count) { Pc(ch); --Width; }
	}

static hexdig(c) {
	return c + (c <= 9 ? '0' : 'A' - 10); }

#ifndef NOFLOAT

#define MAXEXP	38		/* max absolute value of exponent */
#define MAXWID (NBS-MAXEXP-10)	/* Biggest decimal field to fit in NBS */

static putdb (f1, how)	       /* output a float in the specified format */
float f1; {
	char nbuf[NBS];  /* conversion buffer */

	if (Pr > MAXWID) Pr = MAXWID;		/* Prevent buffer overflow */
	if (how == 'g') how = 'E';		/* if g, try both conversions */
	nbpe = nbp = ftoa(how,Pr,f1,nbuf);
	if (how == 'E' &&			/* If trying both, */
	    (nbp = ftoa('F',Pr,f1,nbuf)) > nbpe)    /* and 'E' is smaller */
		nbp = ftoa('E',Pr,f1,nbuf);	    /* put buffer back to E. */
	putfld (nbuf, nbp);			/* This is slow but compact */
}
#endif

/* Definitions for printf and fprintf to allow multiple args. */

#define printf prnt_1(),prnt_2
#define fprintf prnt_1(),prnt_3
#define sprintf prnt_1(),prnt_4
o allow  + x * result;
    return result; }
#endif

#ifneed fabs
float fabs(f) float f; { return f < 0 ? -f : f; }
#endif
; ) re	/* return -1 for end of file */
} /* end function scanff() */

STK_pos(arg) int arg;
{ chan=memory=0; STKtop = &arg;}	/* find entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_sca; May 9, 1984  13:00  drm  "FIXMSOFT.ASM"

; generated from LISTREL1 output of CLIBRARY.REL

;module to fix 6-byte name restiction
	public putchar,getchar,@switch,.switch
	extrn putcha,getcha,.switc

putchar: jmp	putcha
getchar: jmp	getcha
.switch: ds	0
@switch: jmp	.switc

	end
ck to E. */
	putfld (nbuf, nbp);			/* This is slow but compact */
}
#endif

/* Definitions for printf and fprintf to allow ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* itoa - convert n to characters in s. */
char *itoa(n, s)
char s[];
int n;
{
	static int c, k;
	static char *p, *q;

	if ((k = n) < 0)
		k = -k;
	q = p = s;
	do {
		*p++ = k % 10 + '0';
	} while (k /= 10);
	if (n < 0) *p++ = '-';
	*p = 0;
	while (q < --p) {
		c = *q; *q++ = *p; *p = c; }
	return (s);
}

	} while (k /= 10);
	if (n < 0) *p++ = '-';
	*p = 0;nd entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* islower  -  is the input in [a..z] ?
*/
islower(c) {
/*  return ('a' <= c && c <= 'z'); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	INR L
#endasm
}

'a' <= c && c <= 'z'); */
#asm
	LXI H,2
	DAD SP
	MOV h: ds	0
@switch: jmp	.switc

	end
ck to E. */
	putfld (nbuf, nbp);			/* This is slow but compact */
}
#endif

/* Definitions for printf and fprintf to allow ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* isdigit  -  is the input in [0..9] ?
*/
isdigit(c) {
/*  return ('0' <= c && c <= '9'); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI '0'
	RC
	CPI '9'+1
	RNC
	INR L
#endasm
}

'0' <= c && c <= '9'); */
#asm
	LXI H,2
	DAD SP
	MOV 
	while (q < --p) {
		c = *q; *q++ = *p; *p = c; }
	return (s);
}

	} while (k /= 10);
	if (n < 0) *p++ = '-';
	*p = 0;nd entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееLINK $1,C80ILIB.IRL[S,OP,$$SZ]
A,M
	LXI H,0
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	INR L
#endasm
}

'a' <= c && c <= 'z'); */
#asm
	LXI H,2
	DAD SP
	MOV h: ds	0
@switch: jmp	.switc

	end
ck to E. */
	putfld (nbuf, nbp);			/* This is slow but compact */
}
#endif

/* Definitions for printf and fprintf to allow ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* CPROF - Profile library and print routines for C/80.

	1/17/84 - RMAC compatibility.
	8/11/83 - C/80 3.0 version
	2/26/82 - C/80 2.0 version
	9/23/81 - M80 compatibility.
	1/7/81 - add CP/M distinction; sort printout by time
	9/6/80 - add percentages of runtime
	4/13/80 - compile with c -l32600 */

#define CPM 1			/* Defined for CP/M, undefined for HDOS */

/* To generate version which does not use in-memory clock, delete
	following 5 lines, and recompile by "c -l32600 cprof"
	(omit the -l for M80 compatibility).  For non-Heath/Zenith
	systems with clocks, code may be modified by changing all
	references to TICCNT. */

#ifdef CPM
#define TICCNT 11
#else
#define TICCNT 8219
#endif

int *LINKPT -1; 		/* Chain of routines */

/* Routines to handle call and return */
#asm
; CPROF - C/80 Execution Profile (8/11/83)
;  Note - for use on other than Heath/Zenith systems,
;	CPROF.ASM must be regenerated.	See C/80 documentation.
CURRTN: DW 0		;CURRENT RTN
CALLTP: DW 0		;TEMP FOR TIME
CALLED: DW 0		;HOLDS RTN CALLED
FIRSTM: DB 0		;FIRST TIME FLAG
#endasm

CALL_() {
#asm
#ifdef TICCNT
#ifdef CPM
	LDA FIRSTM
	XRI 1
	JZ CALL1
	STA FIRSTM
#endif
	LXI H,0
	SHLD TICCNT
CALL1:	LHLD TICCNT
	SHLD CALLTP
#endif
	POP H
	MOV A,M
	STA CALLED
	INX H
	MOV A,M
	STA CALLED+1
	INX H
	MOV A,M
	STA CURRTN
	INX H
	MOV A,M
	STA CURRTN+1
	INX H
	PUSH H		;FIX RETURN ADDRESS
	PUSH B
	PUSH D
	CALL SCORET
	LHLD CALLED
	LXI D,exit	;CHECK IF QUITTING
	CALL CDEHL
	CZ PrinPr
	POP D
	POP B
	LHLD CALLED
	PCHL		;CALL ROUTINE
#endasm
}

RET_() {
#asm
	XTHL		;SAVE RETURN VALUE
	PUSH B
	PUSH D
#ifdef TICCNT
	PUSH H
	LHLD TICCNT
	SHLD CALLTP
	POP H		;GET CURRENT SUBR
#endif
	MOV A,M
	INX H
	MOV H,M
	MOV L,A
	SHLD CURRTN
	CALL SCORET
	MOV E,M 	;INCREMENT COUNT
	INX H
	MOV D,M
	INX D
	MOV M,D
	DCX H
	MOV M,E
	LHLD CURRTN
	LXI D,main	;IF RETURN FROM MAIN
	CALL CDEHL
	CZ PrinPr	;PRINT SUMMARY
	POP D
	POP B
	POP H		;RESTORE RETURN VAL
	RET

CDEHL:	MOV A,L 	;Is DE = HL?
	CMP E
	RNZ
	MOV A,H
	CMP D
	RET

SCORET: LHLD CURRTN
	DCX H		;PREPARE TO STORE VALUES
	DCX H
	PUSH H		;PUSH ADDRESS OF COUNT
	DCX H
	DCX H
	PUSH H		;ADDRESS OF TIME
	PUSH H
	DCX H
	DCX H
	PUSH H		;GET PTR TO LINK
	MOV A,M
	INX H
	MOV H,M
	MOV L,A
	MOV A,H 	;CHECK LINK=0?
	ORA L
	JNZ CALL2	;YES - ADD TO CHAIN
	LHLD LINKPT
	XCHG
	LHLD CURRTN	;IF NO LINK,
	SHLD LINKPT	;LINK IT IN
	XCHG
CALL2:	XCHG
	POP H
	MOV M,E
	INX H
	MOV M,D
	POP H		;ADD TO TIME
	MOV A,M
	INX H
	MOV H,M
	MOV L,A
	XCHG
	LHLD CALLTP
	DAD D
	XCHG
	POP H
	MOV M,E
	INX H
	MOV M,D
#ifdef TICCNT
	LXI H,0 	;ERASE TICCNT
	SHLD TICCNT
#endif
	POP H		;GET ADDR OF COUNT
#endasm
}

PrinPr() {
	static char *p,*besticks,*n;
	static int *q,time,count,*best;
	static unsigned totime;
#ifdef TICCNT
	for (p="ROUTINE\tCALLS\tTICKS\t% TIME (Approx.)\n"; *p; putchar(*p++));
#else
	for (p="ROUTINE\tCALLS\n"; *p; putchar(*p++));
#endif
	totime = 0;
	for (q = LINKPT; q != -1; q = q[-3]) {
		if (0100000 & (time = 100 + q[-2]))
			{ totime =+ 164; time =& 077777; }
		totime =+ time / 200; }
	for (;;) {
		for (best = besticks = 0, q = LINKPT; q != -1; q = q[-3]) {
			n = q[-2];			/* Find highest time */
			if (q[-1]) if (n >= besticks) {
				besticks = n;
				best = q;
			}	}
		if (best == 0) break;			/* Quit if all out */
		count = *--best;			/* Print it. */
		*best = 0;				/* Zero count to erase*/
		p = best =- 2;
		while (p[-1]) --p;
		while (p != best) putchar(*p++); putchar('\t');
		PrinNr(count);
#ifdef TICCNT
		putchar('\t');
		PrinNr(besticks = (unsigned)besticks >> 1);
		putchar('\t');
		PrinNr(((int)besticks + (totime >> 1)) / totime);
#endif
		putchar('\n');
	}	}
PrinNr(n) int n; {
	static char a[6],*p;
	static int nn;
	p = a;
	if ((nn = n) < 0) nn =- 20000;	/* Handle up to 52767 */
	do *p++ = '0' + nn % 10; while (nn =/ 10);
	if (n < 0) p[-1] =+ 2;
	do putchar(*--p); while (p > a);
	return; exit()==main(); n = n;	/* Dummy calls to declare externals */
	}

externals */
	}
xternals */
	}

	}
‹Iл*Ќ ГВK*ЏI µК]K!  е*‡IеНe ББГkK! 9е*‡IеН †ББГУK* I|µК‡K*S.8  9еPA,M
	LXI H,0
	CPI '0'
	RC
	CPI '9'+1
	RNC
	INR L
#endasm
}

'0' <= c && c <= '9'); */
#asm
	LXI H,2
	DAD SP
	MOV 
	while (q < --p) {
		c = *q; *q++ = *p; *p = c; }
	return (s);
}

	} while (k /= 10);
	if (n < 0) *p++ = '-';
	*p = 0;nd entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее* 32 bit common library routines; C/80 3.0 (7/1/83) - (c) 1983 Walter Bilofsky
* Rev. for DRI ASM's 5-2-85 drm

	public L?adsb,I?long,l?stak,Four?b
	public movrm@,llong@,C@1632,her@32,L@@C,L@@U,L@@I,C@3216
	public swaps@,long@0

	extrn I@@F,C@@F,U@@F,F@@C,F@@U,F@@I,L@@F,F@@L
	extrn facl?,facl?1,facl?2,fac?,fac?1,save?,fmlt?1,fmlt?2
	extrn dum?,save?1,fdiv?a,fdiv?b,fdiv?c,fdiv?g,flt?pk
	extrn R?b,f?stak,digc??,fmtc??
	extrn L?shif,L?comp,L?mdiv

Four?b: DS	0
movrm@:
llong@: MOV	E,M
	INX	H
	MOV	D,M
	INX	H
	MOV	C,M
	INX	H
	MOV	B,M
	INX	H
	RET
st4@:	XTHL
	CALL	llong@
	XTHL
slong@: MOV	M,E
	INX	H
	MOV	M,D
	INX	H
	MOV	M,C
	INX	H
	MOV	M,B
	RET
eq@4:	POP	H
	PUSH	B
	MVI	C,1
	JMP	comp@4
neq@4:	POP	H
	PUSH	B
	MVI	C,0
comp@4:
	PUSH	D
	PUSH	H
	LXI	H,2
	DAD	SP
	XCHG
	LXI	H,6
	DAD	SP
	MVI	B,4
lneq@4: LDAX	D
	CMP	M
	INX	H
	INX	D
	JNZ	diff
	DCR	B
	JNZ	lneq@4
	XRA	A
	JMP	exneq
diff:	MVI	A,1
exneq:	POP	H
	POP	D
	POP	D
	POP	D
	XTHL
	MVI	H,0
	XRA	C
	MOV	L,A
	RET
swap4@: LXI	H,2
swaps@: DAD	SP
	MOV	A,M
	MOV	M,E
	MOV	E,A
	INX	H
	MOV	A,M
	MOV	M,D
	MOV	D,A
	INX	H
	MOV	A,M
	MOV	M,C
	MOV	C,A
	INX	H
	MOV	A,M
	MOV	M,B
	MOV	B,A
	RET
long@0: MOV	A,B
	ORA	C
	ORA	D
	ORA	E
	RET
L@not:	LXI	H,1
	CALL	long@0
	RNZ
	DCR	L
	RET
l?stak: DS	0
C@@L:	XTHL
	PUSH	H
	LXI	H,Hc@Bl
	JMP	C@1632
U@@L:	XTHL
	PUSH	H
	LXI	H,Hu@Bl
	JMP	C@1632
I@@L:	XTHL
	PUSH	H
	LXI	H,Hi@Bl
C@1632: PUSH	B
	PUSH	D
	PUSH	H
	LXI	H,8
	DAD	SP
	CALL	movrm@
	POP	H
	PUSH	D
	LXI	D,her@32
	PUSH	D
	PUSH	H
	MOV	H,B
	MOV	L,C
	RET
her@32: LXI	H,8
	DAD	SP
	CALL	slong@
	POP	H
	POP	D
	POP	B
	RET
L@@C:	PUSH	H
	LXI	H,Bl@Hc
	JMP	C@3216
L@@U:	PUSH	H
	LXI	H,Bl@Hu
	JMP	C@3216
L@@I:	PUSH	H
	LXI	H,Bl@Hi
C@3216: PUSH	B
	PUSH	D
	PUSH	H
	LXI	H,10
	DAD	SP
	CALL	movrm@
	POP	H
	CALL	callhl
	MOV	B,H
	MOV	C,L
	LXI	H,6
	DAD	SP
	MOV	E,M
	INX	H
	MOV	D,M
	INX	H
	CALL	slong@
	POP	D
	POP	B
	POP	H
	POP	PSW
	RET
callhl: PCHL
	RET
I?long: DS	0
Hu@Bl:	XCHG
	LXI	B,0
	RET
Hc@Bl:	MOV	A,L
	CALL	sgnbyt
	MOV	E,L
	MOV	D,A
	MOV	C,A
	MOV	B,A
	RET
Hi@Bl:	MOV	A,H
	CALL	sgnbyt
	XCHG
	MOV	C,A
	MOV	B,A
	RET
sgnbyt: ORA	A
	MVI	A,-1
	RM
	INR	A
	RET
Bl@Hu:
Bl@Hi:	XCHG
	RET
Bl@Hc:	XCHG
	JMP	c@sxt##
	RET
L?adsb: DS	0
L@sub:	CALL	L@neg
L@add:	POP	H
	XTHL
	DAD	D
	XCHG
	POP	H
	XTHL
	MOV	A,L
	ADC	C
	MOV	C,A
	MOV	A,H
	ADC	B
	MOV	B,A
	RET
L@neg:	MVI	A,0
	SUB	E
	MOV	E,A
	MVI	A,0
	SBB	D
	MOV	D,A
	MVI	A,0
	SBB	C
	MOV	C,A
	MVI	A,0
	SBB	B
	MOV	B,A
	RET
L@com:	MOV	A,E
	CMA
	MOV	E,A
	MOV	A,D
	CMA
	MOV	D,A
	MOV	A,C
	CMA
	MOV	C,A
	MOV	A,B
	CMA
	MOV	B,A
	RET

		PrinNr(((int)besticks + (totime >> 1)) / totime);
#endif
		putchar('\n');
	}	}
PrinNr(n) int n; {
	static char a[6],*p;
	static int nn;
	p = a;
	if ((nn = n) < 0) nn =- 20000;	/* Handle up to 52767 */
	do *p++ = '0' + nn % 10; while (nn =/ 10);
	if (n < 0) p[-1] =+ 2;
	do putchar(*--p); while (p > a);
	return; exit()==main(); n = n;	/* Dummy calls to declare externaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* alloc and free - (c) 1983 Walt Bilofsky.

  Usage: alloc(n) returns pointer to n bytes of memory. 
	 free(p) returns memory at p to free pool; p must have
		been gotten from alloc.
	 Uses: sbrk(). */

static struct block0 {
	unsigned size0;
	char *next0; }
    freelist = { 0, -1 };		/* -1 is largest unsigned */

#define PSIZE sizeof(unsigned)		/* Size of header word */
#define TRIFLE sizeof(struct block0)	/* Largest allowable wastage */

alloc(n) unsigned n; {
	static char *p,*pn;
	static int size;
	if ((n =+ PSIZE) < sizeof(struct block0))
				n = sizeof(struct block0);
	for (;;) {
		for (p = &freelist; (pn = p->next0) != -1; p = pn)
			if (n <= pn->size0) {
				/* Decide whether to fragment block */
				if (n + TRIFLE <= pn->size0) {
					p = p->next0 = pn + n;
					p->size0 = pn->size0 - n;
					pn->size0 = n; }
				p->next0 = pn->next0;
				return pn + PSIZE; }
		if ((p = sbrk(size = n < 1024 ? 1024 : n)) == -1) return -1;
		p->size0 = size;
		free(p + PSIZE);
	}	}

free(q) char *q; {
	static char *p, *pn;
	q =- PSIZE;
	for (p = &freelist; p != -1; p = pn)
	    if ((pn = p->next0) > q) {
		/* Merge with following block? */
		if (q + q->size0 == pn) {
			q->size0 =+ pn->size0;
			pn = pn->next0; }
		/* Merge with preceding block? */
		if (p + p->size0 == q) {
			p->size0 =+ q->size0;
			q = p; }
		p->next0 = q;
		q->next0 = pn;
		return; }
	}

? */
		if (p + p->size0 == q) {
			p->size0 =+ q->size0;
			q = p; }
		p->next0 = q;
		q->next0 = pn;
		ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* cmp - compare two files */

#include printf.c

main(argc,argv)
int argc; char *argv[];
{	static int f1,f2,c,d;
	static int line = 1, block = 0, lflag = 0, charn = -1;

	if (argv[1][0] == '-' && (argv[1][1] == 'l' || argv[1][1] == 'L')) {
		lflag++; argc--; argv++; }
	if (argc != 3) {
		printf("Usage: cmp [-l] file1 file2\n"); 
		exit(); }
	f1 = file(argv[1]);
	f2 = file(argv[2]);
	while (1) {
		if (++charn == 256) { block++ ;charn = 0; }
		c = getc(f1); d = getc(f2);
		if (c == '\n') line++;
		if (c == d) {
			if (c < 0) {
				if (lflag <= 1) 
					printf("Files are identical.\n");
				exit(); }
			continue; }
		if (c < 0) {printf("%s is shorter.\n",argv[1]); exit(); }
		if (d < 0) {printf("%s is shorter.\n",argv[2]); exit(); }
		if (lflag) {
			printf("%s char %d block %d line %d = %3o; %s = %3o\n",
				argv[1],charn,block,line,c,argv[2],d);
			lflag = 2;
			continue; }
		printf("Files differ at character %d, block %d, line %d.\n",
							      charn,block,line);
		exit(); }
}

file(fname)
char *fname;
{	int i;
	i = fopen(fname,"rb");
	if (i > 0) return i;
	printf("Can't open: %s\n",fname);
	exit();
}
0) {
					p = p->next0 = pn + n;
					p->size0 = pn->size0 - n;
					pn->size0 = n; }
				p->next0 = pn->next0;
				return pn + PSIZE; }
		if ((p = sbrk(size = n < 1024 ? 1024 : n)) == -1) return -1;
		p->size0 = size;
		free(p + PSIZE);
	}	}

fееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

max(i,j) { return i > j ? i : j; }

               STDLIB  C     LxyЂ             ееееееееееееееееееееееееееееееееue; }
		if (c < 0) {printf("%s is shorter.\n",argv[1]); exit(); }
		if (d < 0) {printf("%s is shorter.\n",argv[2]); exit(); }
		if (lflag) {
			printf("%s char %d block %d line %d = %3o; %s = %3o\n",
				argv[1],charn,block,line,c,argv[2],d);
			lflag = 2;
			continue; }
		printf("Files differ at character %d, block %d, line %d.\n",
							      charn,block,line);
		exit(ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее#define NOLONG			/* define to defeat long integer code */
#define NOFLOAT 		/* define to defeat float code */
/*
 * SCANF.C for C/80 Version 3.1
 * by Grant B. Gustafson, 1982-83
 * Version Date: 1/25/84
 *
 * Purpose: To provide formatted input as described on pages 147-149
 *	    of Kernighan & Ritchie, "The C Programming Language",
 *	    Prentice-Hall, Englewood Cliffs, 1978.
 *	    Switchable float and long support for the C/80 Mathpak.
 *
 * Returns: The number of successfully matched and assigned data items
 *	    A short count is returned for missing or illegal data items
 *	    EOF = -1 is returned for end-of-file
 *
 * Limitations:
 *
 *     1. The function ungetc() must be used on exit from scanff() to meet
 *	  the K & R (p 148) specification.  A very limited ungetc is included,
 *	  but it only affects reading with scanf.  If you mix scanf calls with
 *	  other functions using getc or getchar, strange things will happen.
 *
 *     2. Under C/80, the coding n = (scanf(...)); returns the
 *	  number n of arguments processed. Double parentheses are required.
 *	  WARNING:  n = scanf(...); will fill n with a stack address.
 *
 * Portability:
 *
 * Radix 2 conversion %b is not listed in the K&R standard, however
 * it is available in many modern compilers. Primary use is debugging.
 *
 * Short integers %h are taken to be the same as integers %d. This is
 * in keeping with the PDP-11 16-bit machine standard (K & R page 182).
 *
 * Unix conversion %[...]: Reference: S.R.Bourne, "The Unix System", p 306.
 * String input using a limited character set. At least 2 chars must
 * follow %[ and the last must be ]. Use %[^ to mean "all but", or the
 * complement of the allowed character set.
 *
 * Examples:  %[^\n] inputs a string until a newline is found.
 *	      %[0-9A-F] inputs a string using 0123456789ABCDEF only.
 *	      %[^\1\3\n\32] inputs until ctrl-A, crtl-C or ctrl-Z.
 *	      %[^]--] inputs until a ']' or '-' is found.
 *
 * The Unix conversions %hd, %hx, %ho, %D, %O, %X, %E, %F are not supported.
 *
 * Both getchar() and getc() are assumed to follow the K&R convention
 * of returning -1 for END-OF-FILE. We do not translate getc() = 26 (^Z).
 *
 * History:
 * 7/83 first release
 * kill0x() bug, NOLONG/NOFLOAT switches, data type & function coercion. GBG
 * %% bug fix, Unix string input %[...]. 8/83 GBG
 * tolower and simple ungetc 1/84 WB
 *
 */

/* See S.R.Bourne, "The Unix System", p 309. NOT the same as in stdlib.c */
static char *index(str,c)ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* bdos(c,de) - call bdos with given values of c and de.
		return value from register a */
bdos() {
#asm
	extrn bdose
	POP H
	POP D		; Get arguments into d
	POP B		; and b.
	PUSH B		; Restore stack.
	PUSH D
	PUSH H
	CALL bdose	; Call BDOS.
			; Return value from HL.
#endasm
}

 B		; and b.
	PUSH B		; Restore stack.
	PUSH D
	PUSH H
	CALL bdose	; Call BDOS.
			;rk
	XCHG
	POP	H
	POP	H
	MOV	M,D	; Store block address */
	DCX	H
	MOV	M,E
	MOV	H,D
	MOV	L,E	; Get value to return */
	INееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее  #GDВўJdt$§,$) GMВўbvL&  #GQBўbLtш*&  *ЗdBЄb
"$u¦  §"Ghкb
љdul¦  ©©GkВЄbzlv@"¦ "$«GbВ*bjz$tђ"¦ &Є¦Gg‚Єbr*<wи&¦ ''ЄGZВbbz”v8*¦ )ЄЎG`BjbВz”v`'&&'§# Gq‚rbr*Љ¤wФ'&'§# G|АІjzІ2jwШ&§«#) GB@тjzІj2t&§«)# GfrjzІ’jv|&Є¦ GmBjr*Љ¤w(*©¤# GY@кЉJrўvШ
©¤Ј§ Gi‚rљbzr:v„&)Є GxBrљє
Ѓўwђ')« Ё) G]Ѓ"Є4t,**  &GD@jТ*’zf,*Ў )¬*FDЃRBdt# N   …ђУP“P`d3фФD€RE@2ЃРХ D4ДX1RC@GEЃPРQС`T4TДXURC@ULTЃPРХ T45(UMJC@ASLЃPРУУ`T4дхHMaRC@MULTЃPРQ T4D•h9O@Ђ– $ ВE@Ђ“ђ %4M ЖG@Ђ”P d5t•D8	!P 5c–Ђ K@ -)хfo>,Њм–EЉ}U›ПЉЈ;%‚СbџTfув€ОЙ>-Y  XЙ`ґX§ЕСфB  0©Ан…N Њ•{$шµeR@  Їd°Z,Sвиъ! Ђ¶ µ’л=/Uђ цЅaVр  ,dєПJЗХu =/Uј цЅЂ@Ѓk$ш§Ђ@Єж µdџИ8e’л>.V4 ъ»Ђ@+* -d­Y.іТс…gАkС ШІ]gАёuр|™ПЎу{У :Хм;P лѕ,;r Бh±OiSyй8gdЉП‚у9ф^odџЌаtщќ’~™Ќм—[…Жsњќl—[„њ##ПUэ ?Чgб
у .W Аit‘	ў  ф·T4¦\Љ]b—[JЉЂ‚G¬*ЙWЅXtЁф¬z«oЛ’ л>-Ю—$ љDЂ Ѓг
џ ћђ#аѓjЎЂљЉeБр RлєЪU,FеёZUL°Є­врuіnH­‡r@1Р †~љ‚Ё‘! hЁ
‘Т@ЉЂeb €hк‘Х0†Ђ‹c €h	Љ‘Х †ЂЋ‹… Ёh
Ёи±Ш`
†ЂЄ‹— Ёh
Ёк‘ЩЂ
†ЂЄ© Ёh
Љj‘ЪP
†Ђ‚¦Ґі Ёh
ЄjQЫЂ
†Ђ‚¦™К Ёhiй±У 
†Ђњћ©Т Ёh
k
‘Яа†ЂљЄ©Ёh
ЁЉССр†Ђ€’­Й Ёh	ИЁсР ћЃ
 KС@‚Ѓ hЁТ`ЉЃD IИЫр¦ЃВ jh1ЭЋЃЬ J(Ю@Ђ¦®’Ё‡Ч IЂ 
ЂЂЉњ‰8  …ђУP’SаDU„•H%:FOUTЃPS‘ T4ФфDXQ1.X0FCBЃVСђР D5DД(95V??PC2ЃOПРУ T3фД”(%=	UIOFCBЃ”NQS‘ dd4Дх4X=A:SBRKЃ‘СUТ`DtUD8%=AIPUTCHAЃUаd”хu$%=MRIORWЃRSХT D”ф4€%=%9IOMODEЃRSР’S d”х4TTё%=9"IOPCHAЃ’SФSС Uu$•DXIP5’–Ђ   ©    +€ЄА”EUЂ„ў*Ёn?Б"+J	Z0 HЉРЃ O/рHШ "Є@"±ІVща Ё†Й3@ *  Є0„  /„` d8  ¤aY8VјЄh „T r€h”B e¬`бЭ•j ВUc 'ї„LЄш юІ«а 8@+hџBA3аH&ХrЉДgе»*ЙЂ.XV l ёПВ7рс•r ГжUЪ Р Ј…‡XА#gшЊlяP (†Ѓ 9Y   ЄЋ џ¬«Љ еfЪP6  еЭ`+6г®АтЂЂ  ”CFЂ\¬ЫЊ"ЈЂ,jщ 8Z!°ЫU‡XА7ь 	fР0 p›~ fpњи 7њ¦б ш@o9‚1¤Шe	vд о   ,+TUQЂ\®V€%КеfУp‹
њЂ€AЏбЛ4  h°D/чыЦ"ЁА,W&Й
®А•›MБ,ђµP:Є #БUR_6°p(6Нї 
с•Q™¶@‡U@AА¶md[ІАmu Щ@ шКўа/аk
ЗЂЏЃEсUR?
ЧНРњ NcаRмfWАK6‹ЂЏ„tН§ЂM†(кЄ ®XW$›U@FUDѕ OМ;њіm ьa^0k
пЂ‡Ѓ@а6ж €A@H5…{ _А&U§™WФЮ& 2eѕ "ыэ’БhµXўЄ8Хrіmа#‚ЙuЏ„QѕfУА&‹aЄл>їЃL*J±Y·t‚>ЩґЂ	ВЙ1›НГЈ‘ђд:8MГЈaМи: 5„Єњю<Єp|, џ‰лv Э‡}@@                                         яїЯпчыь                                                               @!А 0   @ Р1‚бhµ\¬Q+®P04ц/W &#°®ЁEВi ! ВhѓЛvС„5аьюІЁ8Њ
Вї L:HБhµX®ірЊЊлЅЯб‘° ", FА ‹ею8_/рЙЬ"# FА•PЪр'[4  r€@АЛ4  `±O#Ч+6ё8YTђЄлfРрaр ШU„ўХЩґњhіjиDxК¤Ђ‚о9Ђ@а He^wЌЂ ьwќА/'ш$ь#[0­ UК  X¬Ъ<БuёNBіLцІhІ© #­^Й  -«цю6®(†Я3iаЌ°Ђ%гЪЭ‰XАД  $C]Аѓ'бг*’џмЪR!±ЂA“ушдКўА‚&'kрd2ХfУА3кЭ•EAoQUu<їЊLЄ
Ћв0г
я‰^.Q
  =yPрAK•›PAX,‰мzХfЧ `pA›oАЗЋ „  ІD5H2'ИМWЉєЃ2Y¶TnКµ@/бJЦ «Ч"¶grµEUФ	К!  \¬Ъв
Б`ґZ®°ЇњПk&‹…•}@Z®Vmйі@ [¬U]@ѓ$a“h†GЖ%у*И‚АЦU7™WФnК¦а†Ѓ0’б`ґZ¬W)нnИЪR!µаA“р†їC$бr{`ЂYАђ#dіlЁ"Э…s.‹UКЕaРЂ)n`#ш@Ъ»@Њ‹…КХb°иX­К! 'зр)…A\ў&??ЊLЄ
!їАѓVя\,:
 \#аPЄєЃNо7+”Аiіkp#…^ѕp°©ђ+ўХbµDўЗ(„ rіj+‚Б>-D/чы!р! &б0 uЃм«xЙWЊЇё(ш*ГЇ ІФ°W(„ іkP#­ВеЋЇё*‘к|Ц  ИewiVђQРC[Ђѓ/»…’>ЊЇё(ш(2©@ЈЄЁ·bW mшbћ,«И
Хr±Z®°pi›GБ#Є”
OfЩ0V
Э…lAD(ш$€Mp„P  ЛE‡aЃ\-ХJXWђВ№@ аK6Н‚€_пцк+њЌ'C(ЂКr9ОBhЂ€i9љДc©°Ш
‰&K6љ№AБ ЌA fЬ WҐ‚Л~D Ђ дь=№YµАВХ+
ЛВІ0¬њбuІ@ ° $EYЃ‡Вё¬ВЈ Куё ќДb3ё$ ќА.ш%Ц#?
ЯГ¦C?ДlЪРЦ ‚gбЭђю2Є 36ґuЦ*¬АВ±XinИfЦЂcёLFГ«@ТЦЂg1эьa|5„’x !ґ @ђIшѕ#+,Qђ еfСа[…ВrњМF±сjЙ–ЙKЂ  ЫђЉ°’©Ш hЙ)ССАЊћЄ©’Ё©И‘Х@†љћ€‹rЁj‰€iqРрj°`Њ†…«иИhQСЂ†Ё…h©И)Ё
±Т`Z~~ †e§зиi†QР 
†~’…R©)иJЁСЪ*’ћЊ†…  К'
(©И‘ЪP<Њ†ћ¦‹ЖЁЙк©ССа¦„¤—HИиЄ€i1УpHЋЉЁ‡єЙ)к
HЁ1Яђ ЄЁ†ђѓјЉ
Є€qЫа,’ћ ®¤“`Й)кhЁj‘Ца(’ћ¤Їu©)к‰ЄЧp(’ћ†‘~©)й)И‘ША,’ћљћ€‹“©)иI)СЩ ,’ћ¦ЉЉ—Ї©)йИiЫ`,’ћ †ђѓВЙ)к©иСФZ®¤’Ё‹qЉHЁ(‘њ`®„ћћЁ‹сЁH‰кh±Ђ €ЉЊЊ†…оИ€ЁИJЁС›pљ‚’ќ,Ёh
Ёк‘“p†ЂЄЋ‹  Ёh
k
‘ћЂV¦ЂcQI‘ TўЃ9  …TQСL T$Dх4X]	==QDEFDSKЃ‘Q‘ђР dDTd%Ti@ Ф 8
P‘ФСcЂ ]	==Q8‘Q‘Тг‹Ђ
9 ‘Qђ•Q§   ћrk
	XCHG
	POP	H
	POP	H
	MOV	M,D	; Store block address */
	DCX	H
	MOV	M,E
	MOV	H,D
	MOV	L,E	; Get value to return */
	IN/* isupper  -  is the input in [A..Z] ?
*/
isupper(c) {
/*  return ('A' <= c && c <= 'Z'); */
#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	INR L
#endasm
}

'A' <= c && c <= 'Z'); */
#asm
	LXI H,2
	DAD SP
	MOV бЭђю2Є 36ґuЦ*¬АВ±XinИfЦЂcёLFГ«@ТЦЂg1эьa|5„’x !ґ @ђIшѕ#+,Qђ еfСа[…ВrњМF±сjЙ–ЙKЂ  ЫђЉ°’©Ш hЙ)ССАЊћЄ©’Ё©И‘Х@†љћ€‹rЁj‰€iqРрj°`Њ†…«иИhQСЂ†Ё…h©И)Ё
±Т`Z~~ †e§зиi†QР 
†~’…R©)иJЁСЪ*’ћЊ†…  К'
(©И‘ЪP<Њ†ћ¦‹ЖЁЙк©ССа¦„¤—HА ‡H /чыjђ @ 	i &: ”ХђУT#  	p  …”ХђФ`e5E$5™@ Ф@Z -  `ёZ-W+V#?‚kv dЗ@ 2љў’‚М` # N   …”Х“S e5E$ДTй@ ФHZ -  `ґZ¬Q  [ІЁ€ LFГ аСLt )Є)&"§F  :а  …•УХС`eDфДхtY@ ФHZ -  ЂЂ“p }[вЫAЬ 7Іc  Q=1=]0  ‘Р'   …•ХT`eDхUY@ ФHZ -  ЂЂ“p }[гЫAЬ 7Іc  Q=UAA0  ‘Р'   …‘VP DDфh		2BF@HCЃP‘ђ`T$d…X	1	BL@HCЃP“`T$Д…X ДШМКC@3216ЃР D4ИFCF@FLSЃPСђС`T4duH1CF@LTЃPСђ‘`d4dE%XiI>CL@GEЃђУУ T4ДuH11CL@LTЃђУУT dD•cE ТF@@CЃђ`DdИVF@ADDЃQђU TdХTИ9F@NOTЃ‘ђ“ХS Td5T(FADDA@Ѓ‘ђУУT Td”еD19FLOAT@ЃQ“ ddхUEDQ=HC@BFЃRР“ d„U$3(!%	HI@BLЃRP‘ T…T$И%I@@LЃ’S–ђ DД81L@@IЃ`TДDH19L@ASLЃSTФ TД4фШ1%ZL@MODЃSUS TДдTx19=RL@ORЃSХP TД„х(11=9LNEQ@4Ѓ“У‘Р dФхddФ5=YIMOVMF@Ѓ“SХ”‘ђ dФхe$Ф5U0ДБNEQ@4Ѓ”TТђ U”еDM%9SLONG@ЃХ e5tDM]AMU@@FЃP U¤U$ф	@ Цр(                ґ<^ГЈааЏЂЂL:> >іo°…ўБr€h”CO мЄn =€Шtґ ь#3Э6¬Ф Yђкyw 	м–mg yUЂk%›YА¬*ћ <dіk8 хр-dіk8аZЙfЯ`&…ўгb‘	¬ЪX! Ђм–m• iZа–Uѓ ёX.7Xµ’НІ +jК°@; ЇЃА•ѓ*С +ЦМвШn ,Ыјx[ІTnКѕАI•Е ЏlЫМлfЯ`&Eьh=Yґ\ОсfЧ  †Ђ <ЇX6Ё ґ©€ЊhМµ bа6Г °й€
Ѕ G?&Лв3тh®#?&IнКёh1«Из•»
Џ ’Љ†Syб¬8Wь^2 `ђ(¤ф+ћQдч•<«vU1Р01ЭҐD@YЃ [ї*	F~s $цц0Њ c Ђ0v¤ьѓ/€ПИўёЊь‰'ІD4 ь/;«Нй9х6_>¦ЉзФЙ=’ 5ЃЄюC-AАrcMксk т'ћѓеsШ|ѕx‘Шv†Z(“Щ,ЫlИ µРт2 А±  Ђ А†ю 9D6мКеР рЌnКІЂ.Qp >g<ґ®Ё”UAА.·кѓ "CдуР|®{—Пт8ґшВёЂ.K6у D@€  НѕАL‹6Ы3-p№юН®ЂCA ¬ь2Ў`ірК† 
ПГ* Au«ЙеrшК‡ 9X§Ч(††Ђ%њ&уг”CC О9бК!Ў`	з	uCЂАыJўЁpЕв7i0\'‘аф>ъ¦@!sШ\ѕz•П!rx¤р#ЋЁp \eCЂ+%›
Ќ9D4 jбfZђ6<-ЩV`ъ! `
д>Ё<<¬ё we^Pm;ЉЩ,Ыl/p­Ь/ЛRГў ,Ъx[ІА&е©#іmX †ЃЂ;R: `v@кЃ ?…бtы xЙ&,; D@  'њ АЩ aЯђ ?;ђvK¬U@ nQU q№]l–m	u€Ё ЂТ" @¶H†Ђ 0мАHЌ’   ` hоЃXT8’! @а8Ь>w‡Дb3№д7“ГкжIбnК¶АB~еfЫ`#Л C@ЂЗ—Г6Ј‡Х,‘б|АћWМYй|АћТМ…’ J%–m« Р0сћW/­ЩVmfСp5qќщb@ЗЙ„ѓ6ё џнК† 7*а…’=(ЗЊ [$C@АПдАкЂ 4МЪК6LЮ§ђ»6ьЂ<Y,Ыfdіm’гzЋЁPЭ…p ПГ* #xёЩ,ЪаГ№ lЪтНё L:Н­aG…»КріlрPщюхbѓЂЫЉБfЮ`"Й@ fЬP!Х [ІЇр 2 `‹6ХЂ<VпЛјГ  lЪ.лaЂ С FmuІOv '•Лм‘  yw T¬ћ$<?”*¤юL6©Р#XG9Y·Ш	›V@ААµ…SA$ўx %`0мрPюїЯм:љ! Ђv µ’x[Іe¬АЋ7(†е°иАSЌК!ёЂl:0гr€nЊ9D4,‡RBњў$Г©!NQaФђҐ{М‚Ђ,V«”CKњўP rНі+vUЦaСpFIэ,L ‡D   @!А
0 Ђ Ђ  d            !С& (Т  q  ‘  !  `   НfЂ¦ёЊтn	 ОБe№Dд«b‰Нй5щXЦvf
Н@ rН  Ј+n! ,Р  ъ2· ‚  rНі,ЫмСp№Z¬Ыlт§@ЈahЊl0eV@g+тп­А#ѕю"ІЄЁ(кЫ‚1ЂМЪаЇzіkЂ,µhClБ¶`%›K Цп+
НіаOлХ‡VЃe® ў^Ні,ЪX·pё«ш+Ґ›yА^#З«6ёЋ­А#ѕю"°¬Ш(кЫ‚3kЂ36ёЏЂ,ЪКНѕАOO[ЂG1}ьE Џ,«°
ЖЗАUАy]ЂQ°ёF:¶аЂQ°АF=eVP`#кг‚ЃЂ+nЇzЋ­ё#Фu€mИ#¬ъ¤@АWХтa_ЂQ°ёFсѕ©€3ХЉеjіh„/ТЕсй<WћSДсX­Ґ@A™µ@F#fЯ`'[„а#`°п )аzН­ АQ°№йAАЮ,ЪР:· Ћa
ўѓ
ППбѓ*њѓ?…МJс[І«(0ШК#
ЮUXl-Џ Вр#XТ« В3ЂЌЊ:;€ЖАHхр6Шu шrшX !є Ѓ–m	aЪ°L¶B KВ2і¬ьНІ`М:юЅYV|ь+eYрa[6€Ђ‘Кесy=›HБЫWФь.e] gс••oџДVФfТ0vm3fТ0vХ
0® 2Ѕ&_VњК{H=/h3Ксѓ=Y·њв<a]pf‹Е™wЂќl–CХ›gАћ#ЦKT®xD‘Ш®V«6ПЃ<ZГmp°Z,;NНјАLЫ–Бh°нXмAЃРНaЃ}‡pЃ„gзрй ю2©;ш`?Y!WтЎђюІЏб[!ь§d
Щ2Ф0q 9?(Лв3т€®#?(Iв3тЂЋбЊЬl•zБbІaXђu›*ВѓћЯВ•‰ P е^~[ј«И8Ьь;ЉА¬*тaVАwE‚йЃ@“тЬ| yYPqиwЃXV\‡aAХлЉЙ…qБЦl«
{WЂЂ•yш.wЃXVа:В¶ м;
!Ђ*ц•dЛtД @6т€@ +6Ѓ„8^¬ЫкВЅ псx€@@•сґX,Ёµ’! ·ђ$B 0оИ8„ џ’eсщ4Wџ“$сшРgLЮ§ЕkКђ„<Gм—‹%“-$bµB  UЄ@аКјь;ЉА¬*dТЄA ` „ єД   е^GВb0+
¤„@Ђ)рr¶aV@Ѓ…VuШ ‚Ђ•yш.wЃXU¬!‡JВ Ђ дј#+Дb3ЊдС`€A Ле’. 0мђ@ёеbµOw•џfХ`‘уэк!  ®QpDrF“…eaYyЉХ<-ЮVм!›U‚GПс$ 9WД  •К>=D ` е^‚зq…t Р еЦ!	Ђ  4ѕm_0†т†А¬+ИЅD @ ев‚зq…+vU	„ —X„ «Э`` i<„А¬*,с°®@@„$ џ–м*‚! .±  9uЃЂ‡ађЊ&aSђ‘4 9?-Я•X%ўБ„ —Л„f3qІ\¬P ! *уКxо#°« KВЙЂЂ“тМѕ#?,Љв3тДћ#?,м:ў! 'еY|F~UДgеI<F~TШuD%“-	/КВ2pЊЊ#dёЩ¶`%Жsњ„gБ’бbѓЂ,;rбbѓЂW(„ єД ` д/„a6Х	°®0JЅ‡uВGАEўСq‰Ђ
“{$B OЗ2шЊьr+€ПЗxЊьp#ІO’Н’! Ђ·Ф%Ђ-dЛ@ВњnQp
aСЂ§”CZВt`)ЖеЧђ¦+UК! ,Ы0бj„i`SUК`4ІD Ђ е›i‚\-%К!±!L:’еШp¦I
r€l8SЄе‚Ђ–m	pіkHQљ! %бXFНґБ-…вЙtІe­aN°  Й>іlQt®O#ІOЊЫл'‘Щ+qуэр<dєЩ.¶dЛc‚™¶x)ВгєЬ.3к$ћ|DЩ#аLѕ> &Љгаdћ> &м“Шјѕz•П"тyа^GdЗaў
ўz4t\Ў# !&GBБ*2BtHЎ# $$ЗDЃ*2B¬wXЎ& !#GbBЄbBv*Ў& $$ЗaВЄbB¬t`+! ›™GRBІ™‘‰ґuё!  #G@ВўduдЎЈ "ЁЗ`Ђ222bњuhЎЈ #ўЗX@*2:¤u$ЎЈ &"ЗT@*2b¤v$ЎЈ '"З`А22ў’¬vT!Ј -)'ЗAкb:,wd!¦ #¦*GuЃкb:¤wЬЎ¦ &"Зtкbb¤vд'!§¦Ё GyАr"J±‰‚vё&"Ё G_Ѓ"2v0#  $ЗeБ"2dv#  *ЗCА*2
"$ttЈ "$«GF *2jЄduЈ '"ЈЗVБ*2rz¤uА# )'Є§GDА*2љЄv¬Ј ў" GT r2
""
t°#!§¦Ё GV@к2Jrўwx#&'"Ј GrАІ2bz
ўuЊЈ&* GZІ2zЄўўt4#*' Зq кB4uА*¤! !&GKІB*’™”w(¤$ !#G^BЄBJdwL¤* !#GZВЄBЄdu$Є ГЄ`Њ:¬ГЎ@‚¬, |ZІ« « Ђ¬ |Z°«p#эѓ°пh;6МЂП‹V}aЯ°qV >-YVHUѓ ґКНі иI›{ЂwґB  ±  ‹ 
±@ ЊEЉ fб0 E‡Ђ*'шeљ  2®h „ b V( €±@ ¬Ь& °р « 9D%Р•›@ ,& fЫ@FUжaЯ°q  9b@V& uЉ±@4  ePpQV €°А D  fС &meWАQV$ €±  ­К*ГАиHUЉ В` E¦яџ¬*Ц
*Е 1( bЂp лaаmeTрQV €°А D  fУРVmeV°QV$ €±  ­К*ГА1 hџBL:d-kbЂ‹ 
НВ` ‹ 0пh « ДX  U‰ АV fШђA$ fЩђ іjЂ+*ю‚€@ Л”U‡Ђ¬Ъ  Б`€±0 « ¬«z
*ДАЫјНі ¬+Ё
*ДАЕ«*и‚Љ± 6Э‚іmр+6йІЇё(« ¬«в
*ДЂ1$ №EXxў}	3opэ°пи+И‚Љ°°сjКЎ@В¬H 6 0пh8« ДX  Vn ¬Ъє БaЯ@fmћ„ , Г« В@ EЃ udB ° ¬ѓ3hX6МЂZoрЙсjКЄ М:І!їДX`›{Ђ%« ТХђfmв h      Ы2 еfТP‹ Щ·T•kБ„8Ёљ  1Zў¬ Н    Є*ГАЫН  8Ёљ  3op « 
ДXp шµaZАfЇaЦ`aV џ¬«Ћ!Е@ЪшН  8Ё›f…X шµa] fыa`вХ•zБ…X0›c\ўT Н·ЂОmЕaСЂyop4·ё‡~БШt`љ  R cА–АФД §АЖ@Y:Ђ/p1”{ЃЊА  ‡{ЃwґZ6НЎ`"  r"ДЂ¬8 uџЩ  J›ѓ€BЂ –›ѓіlИ ‹ ЩµМ•`Д6ђ!К*ГАVm  `°O‹VUkb@‹ 
Ьў¬< С>„™·ё‡[ЃШv U‡ b,8 |Z°«и;А°йё8« Ђ¬ |Z°¬Ђ;эѓЉ°°сjКµЂв¬ Н»АОQ 9rі@ …›zAwґ‡~БШwґ›}AЄ€аW@На
Мb Vр3@·Ѓ™ (к ѕАg0q1Ђ,А!lCAЌЂ
6e Q°s0   aЪрqV uЉ°° dE… uh
[ц*Б@Е«*‡
° ¬BQ _.¶Lґ8!›f@Xx FН§амЄ *ГАіь2|Z°©PCЁ
°р•›O@'Е«*ћ„3op¦„
°р”UЂЂ¬ЫўБ`°кЂC‡3lИ Ќ›E‚UЂ U… uЊ Bя°и0@„  `  ЂЂ‘ dіh0$Uѓ b± fЩАq fР`&H« 
Еb, Н°Ѓ, Н АL‘ $
 #!Рj6Ћ"бh¬Љe Gt@rЄr:*ўu#)Є%џЁ'З]В2љ
qъ4uм##©Ў §GcB2™ъљ
tfX!$ FH@љeђ! &"Ж\ b:,eT!ў FSAb:¤fф	' F@ Т*gё! &Є¦*F|@ТЉg<Ў ''ЄF}A*Є:,eЂ)Є FyAІbbzr:f<¤$ !&FaБЄbjЄdfH¦  ў"FjЃтљbzr:fь¦ '"ЈЖmЃтљєJўd°Ў *)ЄFn ":*ўg #ўЄ!¤ ЖiAв
ўz4` # N   …”‘SђSQ`e$TдФY@ Х@Z  !e?З/‘а 9fЂ Q 9„ —+4  `°D#  е›BЂў rеfСpB 9E@ •љ  0X"ёК! .Vm6 `°]b° rщuІc  I952d‘Qђ•QЈ$ 	!2R“PRСђРЈ(Ђ	=N0  ‘Р'   …•S“S’аeTдД”д№@ ФаZ  !n?З/‘ 9fЂ Q 9rі@ B 9E@ •љ  0X"К! .Vm  `°D"@ етЙЋЂ eTдД”дёИаDEFBUFЊ… $„ИMAKFCBЊ— D$Dх8А G@њ   „РP”а4%9@ Ф”Z  ! ,Р  "  3@ U ЂЂ–m fЂ :H ! ,Ъ* ЙЋЂ 4%8ЙH@Њ…ЂD4uHИАC@NEGЊ  $t	А  …ђS”‘`TДДф8IP5щ–Ђ   чьё        	h  „ №Y   ЊFН   @4  eR0 9c`ґЊ C@ X  UЂ b6m
 ` 4  e\РG `   aТђV fТр(„ іjXEљ  2®P „ іj D №EX›X@,Р •lАX  F#rЉ°¬B Yµ° 2НЎа,  *А QV fШ@(„ іlЁ4  fШЂV r€@ЂЛ6ОЂ3m «  ДnQV €Щ¶ё›l@X F#d°йр „ іmш D fСPUг Ђ Њ;Ф ! ,Ы¤ "АЂVh  Б` 4  eP эюЙ` (« 3n «  ДnVm`°й&\     СЂ 9rіo@ ¬VНЎ "  "АА¬ #>-YWа‡P EX  EЃЂt¬UЃЂb6m`Ђ(„ іj0E›v WФB YµD›WА]b rН¬@!—(« 3@ U™ЂЂ–mjrіkа”U‚ ¶ ўfТ0V €Щ¶E‚ X›e ]b¬ r€@ЂЛ6ОЂіkђ*к Љ°0•›jЂ\ў0 rН¶а,Ы~Сіl`„ №EX›qАEX F#r€@ЂЛ6б іnђ„ іnшЊFе`Ђmвd°йё&:PSРгЈ 1I3Т’#>@)E2ЄPРQХ#&А В2®PРQСc. U13@ ”Р#>а9=R3Z‘P#=аM	I.0  ‘Р'   …UТ`DDф™@ ЦT\      Р  "А@  EЂ    ељ  „А. їЯв, ! .Vm і@ ; fЂ d Z Ја°  -; ЂЂ–m% 7	ЂЂљ  2Єр „ іj ёL Ћ@Р љ  2¬P «  A@h  еЃ —+6©ЂЩґ¤ Vn !ђ‹Aю` ; ` X«  3kX&: UТc.Ђ	!2р ”P#%аM]%Q2’Рc+Ђ2ѕ СP#2@5U1R0  ‘Р'   …‘ФаD$Dх9@ Ф(Z -  pґX,V«•љ  2c  	=N2P‘ФСc  	p  …‘СUS dtUDД”й@ХЁ\    K@  @ ељ  °  „ №Yґ VН    4  eS V  rі@ ‰ф${?Г,Р ›KЂU  UЂ В` Ќ›L@ґш•UЂuL UЂ b,  ГЎ@:’ *А ` «  9D ` е›D   &: ‘СUSЈ,Ђ	!2( ”P##@1R2‚ СP#,а	M2H‘СUТc  	p  …RS‘V T”дDU‰@0Цњ\        ґ  B  °  „ і@ X«  MВ`сjКґ`:P *А 1  °и0 «  ° „  `@ 9fР°X« MВ`4  eV° 9fУђX« MВ`”B Yµ8Ц*АЂ“p Н  µ•b v UЂЂb, *АЂ1 aУ@t ЂЂ–m^ uЉ°  dЬ& ¬+@ *А – їЯми INDEXЊЖЂ$„Л`E@0ЊґЂ$TА G@њ   …’TРS d•4Е‰@ Ф\Z -  ЂЂ“р„  [гЫ@Xю0ґЕ¶Аµ“  Й*h)Љ	Ђ ЋЃ8  …’TСQТ`d•4D”t™@ Ф@Z -  ЂЂ“р„  бУ@XЙЋЂ d•4D”tА G@њ   …’TУХС`d•4ДхtY@ Ф@Z -  ЂЂ“р„  [гЫ@XЙЋЂ d•4ДхtXА G@њ   …’TФФPаd•559@ ФZ  ! ,Р ‡D@%Ў@Р  ЙaТ h BЂ 
 	 P  P   Ђ и ISSPACЊ‚Ђ$„Иђ@SWITCЊ  $t	А  …’TХT`d•5UY@ Ф@Z -  ЂЂ“р„  [вЫ@XЙЋЂ d•5UXА G@њ   …UР`D•Dф@@ЦШ\          -  Ѓ –h  "А@ љ  2Ёа « 3@  ЂЂ–m `@ `@‹ 
Ьў¬ л‚ЂР Ц -иHUЂЂbP›NЂX шµaRђ 9fТ € Н  UА UЃ b, +EX l `@X‹ :ЕXљ  2­p « „А  ``‹ 
Ьў¬ n 'Рђ« 9EX ў}	0лЁ „ іjШ&: UРc6`	!2РХ#"а92PРUЈ, QMR3PРQХ#  	p  …“PRСђР dФґd4)@ Ф(Z -  `ёZ-W+љ  2c  5-
2VђРЈ  	p  „УPV 4Ф‰@ Ф Z  ! ,Р К! ,Ъ
 СfЂ Є@ ! ,Ъ Г¤а rНЈ`и MAXЊ’Ђ$„И€C@GTЊ  $t	А  „УRS 4Ф”й@ Ф Z  ! ,Р К! ,Ъ
 СfЂ Є@ ! ,Ъ Г¤а rНЈ`и MINЊ’Ђ$„И€C@LTЊ  $t	А  …”ХђРU e5E$4I@ ХZ -  Ѓ –h  ~[ІЁШ „ №Yґ FН  t Z6 ! .Vm іh° ­К! .Vm! іi( ¬Ь& 4OЎ#вХ•Q tl“  КjЉHh*‘’рђЃ3 J(Ђ ЋЃ8  …”ХђУT e5E$4Х	@ Ф„Z -  `ёZ-W+4ѕaQp ЌnВ 6ш “ЊЪ@Ђ'з1ьо!  .‹UК7‰Ђ—EЄеuџ„fc{%ВБhµX®SИHB  2\-ЄеїЯз…» тюґ	d$9|, ЧђЙxFVu«ЩµаЮ& 2]4<‡ЂРр`g@mЁЕµ`7„‡ЂЪ°"НЎа"Єt 'жH8ЉН¤ !h 2"§@MK„UNЂ™ в#Р –J в6ЩЂЉ©РD џ™"ЄtЂ.Sу™оwСа r-›nЂ\'з0!•vЂY"ЄtЂ.Sу™цw—„ea ,”  `­›@@B4°‹fЭp	щМePp!Yщ’  QА"q”иM,     Ґ@Dг)Ржt0ќ    N Љfг!ґжg       Й)Й*‰И±Х њЉЁЊЄќИ«	*‰И±У0 ЉЉ—<ЄЁ©jсФ` ћ–‹ЁH‰кhіЂ  …QR`dD•4”еH9%9RP 5 yІ_lи DISINTЋЃ dTд”еIА  …‘”’S• e$еCуAI9PьКPRNT?3Ѓ”“•Н ddх$ФH=I5SFORMAЃ”’S•ҐаZ`yp      K@ -(<ё                 ґ B DX ’*А ±X‹  3@ +6Б 0eЈ@ rл` h  К¦`¬  еfУ Ќ 2EX  V+` m ` V rЉ°  ¬V"А Ъz еfЩ@‡FЂ"¬  +€° 6§Ђ°  « 9EX  V+` md rіm`‚ГЈ@‘P  еЃ –mv rіl ‚ЙЃ –m‹ `  9fЩђ  fЬЂH„ іm ‹ _Пч(„ іm€•›e ,L·  U@ В`4  e^U  7	ЂЫь2Н№аЫѕ Кї@Є  #P YёL rіoШ‡r "¬ #џ¬*<*АЂ1 №D @ дЬ& 4OЎ!V  " rn ў¬ еfЂ &\&                ґАB \ў¬  Н  X  V+`   "Б ,& !їДXT U@ b*  n X(љ  2«0$B  FX0 U‚Ђ-7шe›X DX4 шµeXРU  €Ё  ¬Ь& °P « ZрЙсjВµА"Ђ ъ2БЂЄ  #P YёL ` mп``V
 ґџб“вХ…t ET  F"  ЫЮ"Б ,* *  1  ›„А
 Ј_б–mв e_V ЃАР ›xАYWфB °@ « 0нё„ №Y¶ь V+fУђ aР(«ЂЬ¬Ъ>Б`°пX„ №Yґ$V+fРа&m*fЂ VЁ„ rіiЁ+‚БaЮ°1V  ЉДX  B \¬Ъd~?Г,Ъ^Н  8dљ  
Ё  ЊE@ fб0 E‚ЂvМ
Zо!Г ЪјЕj€A@+6љ‚°X,И‚ ,& Гі`BЂ E„А8d›^А­QV rіo +‚БaЬЂ&ИfЂ Ьк ®аF@Њ7Ђ,Ёа   0пX·,
[–*В 3вХ…vЂ„ ` ‹ 
°  ¬V"А  rеfХ@ ‹сюfХ°&mџbµEX(КН» М‡zАД Ђ ‹	Ђ0иШ„ a0„ ,& ! .VmиЉЩ·ј	›H@ДX\ U…А  Є*В`Vmа`°X,;Ц! .Vm)ЉЩґ›R@ДXt E‡АX| F"ГаітЭ•Z@ШudU‡Аb,> еaРh  л`Ђh  К°Ђb¬ Нѕ@,«**Г ±V €°ш «Ђ9EX|КНЈаМхЃІEX(КНї`mИ aФ0лfЫ@*c R@# Ј ,М №`FPЛ3Ђ(јC О 
*x T03ТЃЂ   Уіn@&\B   K{АЕX„К!  X„ U@ В` ‹ F h  КўЂ‚¬ Ђ  6ВЃІ©Ш «ЂA@h  еP ЉЂ 
НВ`D2h?Г",B Гї b¬B лp€±­“.#       ZЉ! ,Ъў"Д`  rНѕ@BJ Н¬ЂB@ rеfФ A[6§№EXЊ "ц†YµФ•bЃ8”›U­Q( Н¦ LР ‡gXЊ VН°@ЊVЁ‡Ђ3kР#4  bµY¶Ш‚БhџBBJ НІаЊVЁ„ fШрFh  Еj„_прьюНі@‚J Н«@‚¬F |?Г,ЪвКЅ ‚J Нµ@ЊVЁ„ fЫ FmµaС°QV# Ѕџб–mРeP Q% fЭђF+TB 3o#4  aС°Q% fЯ F+TB 3h+6тKFБD8”›qЃ8”›CЃY  
®A Л6±2eЕ     -5¬г—И„Ё іi(+Є!  ґXљ  2Єа(„Ё іiш+4  aЦ0Q	P 9fХ@Q) fСрQ  9” ‘ r€qH6°‚±ZўА rН¦@®VmE`°X, • –mybµD  6Ј‚іjP+*ж‚Љ°`  p?Г'Е«*в€E +6эЂ0EX V"АА;љ
*Ба± e№ ў¬ еa+6Џѓ0X"Ђ rщd€VсЛдB  B%  dE„@ў° rНІЂ¬VЁ„° іl+•›QA,EѓАX<К*В Vm`°D%  етЙ—Ђ  Срa 9fЯрW(„ іi 36єЃ€±h «Ђ3o€#*¦
°`  еbР+6З0X2ФАaV- €±h ЊшµeWЂa 9rіi`0Ќ›YЃfб0КНї`V €°0¦
°hсjК± В К!  ¬ЫБ`Іe±АВ rН«аО±V fЮрUµЃ –m“rіoШUЃЂb, Г±АМ‘ 9fЪ@`€$ Нў@Њ«! w<B7 :Д   е›nБѓ,‘
Бю9|Љ°@ D@ fЩ fUр€ , !) ,ЫЄLїГ'Е«
„ѓ€J@ИШЉ# %  е›}Aњў¬ е– –mцbµD Ђ еКН  ,‚"Ба," !) ,Ъ]їГ,ЪpК­@в0К*Б Q	` 9fС v+TB \¬ЪHБ`°X, uЉ°€4  fСPFU‘‘@QV r€K Л6§ѓ±Zў@ rеfХђv‚Б`€°x „  №EX<КНЈаМ„  ѕY иPRNT?1Ћ… e$еCу(й PRNT?3Ћ­Ђe$еCуHмFORMATЋК dddх$Фн`SFORMAЋ е$”еDhЙ°:H@Њ‘ЂT4TЕHМFOUTЊµѓґTЛ2Q@ЊћѓФ4дхHП(4C@LTЊОФ„”$ИЛи>LLONG@Њі‚е4ДфдtНА@SWITCЊ™Ф…T$ИЙx2S@ЊѕД4uHИ0$C@LEЊаѓD4tXЙ&C@MULTЊВ‚TДФфHО %L@ANDЊЊ‚ФД5(И(-L@DIVЊ”дДфдtМш-CL@LTЊ«‚ФДдTxЛ@=C@UGTЊ•ЂЕUD8М8<FTOAЊ  $t	А  …TРРS‘ eTдtUD8MQ,эA>SCAN?FЃ‘ЏФРРS e3х44йApЦР"\    K@  @ ељ  °  «  –мЄr *А б0К! ,Ъ
 Н  ‹VU2 ` ‹  0й° «  2Xt( B  2D6|!К! &б0КН  	сjК« ‡W   $B MВ` D‚ fЂ Єф ! &б0 "Z 3@ h  К±а rе7	Ђ  2С>„„   дЬ& 2@ 	p                ЩђU— >-YV” UѓЂ"ыьEeАX шµe[рV rі@ ‹ 2EX( шµe^pV
 7	ЂЕ«*р 
°P ЊE‚Ђfб0‡xА/чш‹ 2Y   ‹ 2eВ   ·ё›f@X@ FНЇ`Є!  V\ B °0 « 2eЎ`,Ы2 еfУР	сjКЈА,ЫЬ ГЎ`"  EЃЂ2б   ZJ! ,Ъ< "В@Ђ›Z UU„Ђ#ђ6ј 3o°*Є Љ°ђ E я€°ђДЂЉ°ђ  }sНв,$  ЂґМ•\ЂEXH "F 3iш6Ў І¬(«	 Y/рИ‹	 0мH…юяdЛb@EXЦ*В@Р •fЂEXH’!їЩ,ЪНі ѓь2|ZІ­p%›{Ђ¶dКН« Љ!ю>-XW›{Ђ             B YґЁ"  3l€*хЂ€@@Л6л °п°„ іo0EОя„n0eК! ,ЫаС>„™2б@                             Z!WїЗ/‘V € ЫёКЈ B¬ Г¤ЂB¬ sїГ",( ёА!“p "Б +. *ВЂЊr€@ ‰ф$"ВЂ r"Д@¬ +€°`6Ђ±@ « ДX  Vn XЂ шµeW@&m™ іk6№2ЇШ8« 9Yґф‚|ZІ¬P­
±  E¶яџ¬+d*Е б0 "Ы†O‹VU«aЬ°&ІbЂ‹ KlЂ™ґ,›f@ў¬@ Н  W	‡~БЩ·ё‡VЂ„  ‹ °А « „А ‹Yю>-XWМB  °° « ДX ‡B ЕX0 V+`А(« 3@ UaЯ°yh@„  aА( "АЂ¬P #bЂYёL b +6’Ђ°DXx FН® LЄЊ*ГЂ±V fЂ ±V €°аЉЉ± •›W@,;jНіА"Ђ EЃ v(B ° Е€@@ aШ 9kx6…ЂіlИ E¦яџ¬«Г±@bыьE† ·ё[!  Xh›BАY¶dКН¤ , іi`*жЉ°Р¬UЃ ґдЦ*ГА‘ fЮаV €°асjВ№ l;ГІ`b¬ |Z°®ёэѓЉ°°сjКѕ`b¬ НЄ NQV uЉ°Р6ЦЃі@ нfР°V >-YT(Uѓ ·ЊE‰ %Ў@ЊЫ2 "ГА6m eU`AV rіiишµeRpFVfЮаV >-YUU‰ b,H +rЉ°рDъaАX‹ ¬/* tolower  -  if the input is in [A..Z], convert to lower case
*/
tolower(c) {
/*  if ('A' <= c && c <= 'Z')
	return (c + 0x20);
    return c;		*/
#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	XRI 20H
	MOV L,A
#endasm
}

	*/
#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	XRI 20H
	MOVEN
RMAC STRLEN $$SZPZ
ERA STRLEN.ASM
C TOLOWER
RMAC TOLOWER $$SZPZ
ERA TOLOWER.ASM
C TOUPPER
RMAC TOUPPER $$SZPZ
ERA TOUееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее                                                                                                                                  INITNEю   NETFUNю   EXITNEю   PEEKю   PEEKWю   POKEю DISINTю ENAINTю ;PRNT?1ю ;PRNT?2ю ;PRNT?3ю ;PRNT?4ю ;FORMATю ;FFORMAю ;SFORMAю ;PRINTFю vUNGETCю vSTK?POю vSCAN?Fю vF?SCANю vS?SCANю 3'RENAMEю 4LUNLINKю 5VABSю 67ALLOCю 67FREEю <ATOIю >BDOSю >ZGETLINю @+INDEXю B.ISALPHю BuISDIGIю C5ISLOWEю CuISSPACю D`ISUPPEю E ITOAю GPMAKFCBю HMAXю HmMINю IISTRCATю JSSTRCMPю K)STRCPYю KiSTRLENю L.TOLOWEю LpTOUPPEю M2ATOFю M2BF@BLю M2BF@HCю M2BF@HIю M2BF@HUю M2BL@BFю M2BL@HCю M2BL@HIю M2BL@HUю M2C@1632ю M2C@3216ю M2C@@Fю M2C@@Lю M2CF@EQю M2CF@FLSю M2CF@GEю M2CF@GTю M2CF@LEю M2CF@LTю M2CF@NEю M2CF@TRUю M2CF@ZROю M2CL@GEю M2CL@GLTю M2CL@GTю M2CL@LEю M2CL@LTю M2COMP@4ю M2DIV10@ю M2EQ@4ю M2F@@Cю M2F@@Iю M2F@@Lю M2F@@Uю M2F@ADDю M2F@DIVю M2F@MULю M2F@NEGю M2F@NOTю M2F@ROUNю M2F@SUBю M2FADD@ю M2FADDA@ю M2FCOMP@ю M2FINT@ю M2FLNEG@ю M2FLOAT@ю M2FLT@0ю M2FOUTT@ю M2FTOAю M2HC@BFю M2HC@BLю M2HER@32ю M2HI@BFю M2HI@BLю M2HU@BFю M2HU@BLю M2I@@Fю M2I@@Lю M2INXHR@ю M2L@@Cю M2L@@Fю M2L@@Iю M2L@@Uю M2L@ADDю M2L@ANDю M2L@ASLю M2L@ASRю M2L@COMю M2L@DIVю M2L@MODю M2L@MULю M2L@NEGю M2L@NOTю M2L@ORю M2L@SUBю M2L@XORю M2LLONG@ю M2LNEQ@4ю M2LONG@0ю M2MOVFM@ю M2MOVFR@ю M2MOVMF@ю M2MOVRF@ю M2MOVRM@ю M2MUL10@ю M2NEQ@4ю M2PUSHF@ю M2QINT@ю M2SIGN@ю M2SLONG@ю M2ST4@ю M2SWAP4@ю M2SWAPS@ю M2U@@Fю M2U@@Lю M2ZERO@ю qkC?MATHю qkE@Tю qkE@2ю qkC@GTю qkC@LEю qkC@LTю qkC@GEю qkC@UGEю qkC@ULEю qkC@UGTю qkC@ULTю qkC@TSTю qkC@ASRю qkC@USRю qkC@ASLю qkC@COMю qkC@NOTю qkC@SXTю qkC@MULTю qkC@UDVю qkC@DIVю qkC@NEGю qkO@ю qkX@ю qkA@ю qkE@0ю qkE@ю qkN@ю qkS@ю qkS@1ю qkG@ю qkQ@ю qk@SWITCю qkH@ю xKEXITю xKFINю xKFOUTю xK@@ENDю xKCMODEю xKCTLCKю xKX0FCBю xKX?FCBю xKCTLBю xKNAM@Uю xK??PC2ю xK??CL2ю xKC?LIBю xKIOBUFю xKIOFCBю xKQ8QENDю xKFCLOSEю xKFOPENю xKSBRKю xKGETCHAю xKGETCю xKIOPREAю xKPUTCHAю xKPUTCю xKIOPWRIю xKIOSECTю xKIORWю xKIOTMPю xKIOCHю xKIOINDю xKIOMODEю xKIOBINю xKIOSEEKю xKIONCHю xKIOPCHAю xKIOPEOFю xKWRITEю xKREADю~BDOSEю~WBOOTEю~DEFDSKю~DEFFCBю~DEFBUFю ю…’S’U‘`d”д•DдX9QU:EXITNEЃQRаUTTµxA=-P 5=–Ђ Ђ*x3@ гшК¶ афC_АYWмь0mWP .3—„ecТН•CАD   dьюf2©И­‡HА!0 dњ#3@Г!р‘|#eU +
ЎЂ0иxЊEdЂDb1ЉЕЂ€ЛВ2і¬F^•„*Р dENЂ„6,‡~А@ ёџМ–U‰ €Дb0+
ј 0иxЊF^•„ p dј#+_ЇрИЉЙ єДV,F^•„*Р dENЂ„6,‡~АПс•<С  r›B ПцUСа r›o ПцUТА r›r@ПцU'·X " OПdЬ#D ЃИ–mа QА!:ШPЌy ЃЂађЊ&<,XTB  2D/чы$uO –мЄ^ў @д[	; Get FCB in DE */
	POP	H
	PUSH	D		; Save it */
	MOV	D,M
	DCX	H
	MOV	E,M
	DCX	H
	MOV	B,M
	DCX	H
	MOV	C,M
	POP	H		; Restore FCB */
	XCHG
	RET

; CP/M name->FCB routine.  Call with file name address in DE, FCB IN HL. */
@@pars: shld	pfcb+2
	xchg
	shld	pfcb+0
	lxi	d,pfcb
	mvi	c,152
	call	bdose	;ignore parse errors...
	lhld	pfcb+2
	lxi	d,16
	dad	d
	lxi	d,20
	xchg
	dad	d
	mvi	c,8
@@p0:	ldax	d
	mov	m,a
	inx	h
	inx	d
	dcr	c
	jnz	@@p0
	ret

pfcb:	dw $-$,$-$

x0fcb:	;another name, callable from "C" programs
x?fcb:
	lda	dos?v	;CP/M+ or MP/M can parse filename
	cpi	30h	;(handles passwords too)
	jnc	@@pars	;
	LXI	B,11	; Erase the name area with blanks. */
	DAD	B
	SHLD	@XTMP	; Save FCB+11 */
	MVI	A,' '
nam@1:	MOV	M,A
	DCX	H
	DCR	C
	JNZ	nam@1
	XRA	A		
	MOV	M,A	; Erase drive number */
	LXI	B,12
	DAD	B
	MOV	M,A	; Erase EX, S2 and CR */
	INX	H
	INX	H
	MOV	M,A
	LXI	B,18
	DAD	B
	MOV	M,A
	LXI	B,-32	; Get start of FCB */
	DAD	B
	XCHG
	INX	H
	MOV	A,M	; IS : IN NAME */
	DCX	H
	CPI	':'
	JNZ	nam@2
	MOV	A,M	; YES - GET DRIVE. */
	INX	H
	INX	H		; STEP PAST DRIVE: */
	CALL	NAM@U
	SUI	'A'-1
	STAX	D
nam@2:	INX	D		; GET NAME*/
	MOV	A,M
	INX	H
	ORA	A		; DONE? */
	RZ	; YES - RETURN. */
	CPI	'.'	 ; START TYPE? */
	JZ	nam@3
	CALL	NAM@U	; NO. STORE CHAR. */
	STAX	D
	JMP	nam@2
nam@3:	XCHG		; START TYPE */
	LHLD	@XTMP
	DCX	H		; Restore FCB+11 */
	DCX	H
nam@4:	LDAX	D
	ORA	A		; DONE? */
	RZ	; RETURN. */
	CALL	NAM@U
	MOV	M,A
	INX	D
	INX	H
	JMP	nam@4

@XTMP:	DS 2

NAM@U:	ANI	177Q	; CAPITALIZE (A). */
	CPI	'a'
	RM
	SUI	'a'-'A'
	RET

@CPC:	MOV	C,A	; Get FCB location in DE from channel number in A. */
	MVI	B,0	; Return zero flag if error. */
	LXI	H,IOfcb
	DAD	B
	DAD	B
	MOV	A,M	; Allocated yet? */
	MOV	E,A
	INX	H
	MOV	D,M
	ORA	D
	RNZ		; Yes - return */
	PUSH	H		; No - allocate it */
	LXI	H,FCBLEN
	PUSH	H
	CALL	sbrk
	XCHG
	POP	H
	POP	H
	MOV	M,D	; Store block address */
	DCX	H
	MOV	M,E
	MOV	H,D
	MOV	L,E	; Get value to return */
	INX	H	; Set Z flag if can't alloc */
	MOV	A,H
	ORA	L
	RET

@@END:	DS	0	; End of library (code segment) */

	dseg
Q8QEND: db	0	; End of library (data segment) */

	END	@@INIT

	inx	d
L0153:	dcr	a
	jnz	L0143
	xchg
	pop	psw
	rp
	xchg
	call	c@neg
	xchg
	jmp	c@neg
	ret

	end
1)			/*	EOF Value		    */
#define TRUE	(1)			/*	Function TRUE  value	    */
#define FALSE	(0)			/*	Function FALSE value	    */C RENAME
RMAC RENAME $$SZPZ
ERA RENAME.ASM
C UNLINK
RMAC UNLINK $$SZPZ
ERA UNLINK.ASM
C ABS
RMAC ABS $$SZPZ
ERA ABS.ASM
C ALLFRE
RMAC ALLFRE $$SZPZ
ERA ALLFRE.ASM
C ATOI
RMAC ATOI $$SZPZ
ERA ATOI.ASM
C BDOS
RMAC BDOS $$SZPZ
ERA BDOS.ASM
C GETLINE
RMAC GETLINE $$SZPZ
ERA GETLINE.ASM
C INDEX
RMAC INDEX $$SZPZ
ERA INDEX.ASM
C ISALPHA
RMAC ISALPHA $$SZPZ
ERA ISALPHA.ASM
C ISDIGIT
RMAC ISDIGIT $$SZPZ
ERA ISDIGIT.ASM
C ISLOWER
RMAC ISLOWER $$SZPZ
ERA ISLOWER.ASM
C ISSPACE
RMAC ISSPACE $$SZPZ
ERA ISSPACE.ASM
C ISUPPER
RMAC ISUPPER $$SZPZ
ERA ISUPPER.ASM
C ITOA
RMAC ITOA $$SZPZ
ERA ITOA.ASM
C MAKFCB
RMAC MAKFCB $$SZPZ
ERA MAKFCB.ASM
C MAX
RMAC MAX $$SZPZ
ERA MAX.ASM
C MIN
RMAC MIN $$SZPZ
ERA MIN.ASM
C STRCAT
RMAC STRCAT $$SZPZ
ERA STRCAT.ASM
C STRCMP
RMAC STRCMP $$SZPZ
ERA STRCMP.ASM
C STRCPY
RMAC STRCPY $$SZPZ
ERA STRCPY.ASM
C STRLEN
RMAC STRLEN $$SZPZ
ERA STRLEN.ASM
C TOLOWER
RMAC TOLOWER $$SZPZ
ERA TOLOWER.ASM
C TOUPPER
RMAC TOUPPER $$SZPZ
ERA TOUPPER.ASM
rom channel number in A. */
	MVI	B,0	; Return zero flag if error. */
	LXI	H,IOfcb
	DAD	B
	DAD	B
	MOV	A,M	; Allocated yet? */
	MOV	E,A
	INX	H
	MOV	D,M
	ORA	D
	RNZ		; Yes - return */
	PUSH	H		; No - allocate it */
	LXI	H,FCBLEN
	PUSH	H
	CALL	sbrk
	XCHG
	POP	H
	POP	H
	MOV	M,D	; Store block address */
	DCX	H
	MOV	M,E
	MOV	H,D
	MOV	L,E	; Get value to return */
	INееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееZ	@G2
	MOV	A,B
	CPI	EOL	; In CP/M, ignore CRs */
	JZ	@G3
	CPI	EOF	; and return EOF for ctrl-Z */
	JZ	@@RM

   ;	       if (c) return (c); }    ; Ignore nulls in ascii file */

	ORA	A
	JZ	@G3
@G2:	MOV	L,B
	MVI	H,0
	RET

; Subroutine for putc and getc to increment buffer pointers */
; Does: if ((IOind[unit]&255)==0) IOind[unit]=IOind[unit]-256; 
;  returns IOind[unit] in BC, address+1 in HL, and unit in DE and A.
;  Also sets up IOtmp to point to buffer. */

@GPC:	POP	H
	POP	B
	POP	D
	PUSH	D
	PUSH	B
	PUSH	H
	MOV	A,E	; Return if unit 0 */
	ORA	A
	RZ
	CPI	PUNIT	; Check if phys channel */
	RNC
	CALL	TM@@
	LXI	H,IOnch ; Get nr chars in buffer */
	DAD	D
	MOV	A,M
	LXI	H,IOind
	DAD	D
	DAD	D
	MOV	C,M
	INX	H
	MOV	B,M
	CMP	C
	MOV	A,E	; Leave unit in A */
	RNZ
	MVI	B,0
	MOV	M,B
	DCX	H	; On CP/M, C might be 00 or 80.  HDOS: only 00 */
	MOV	M,B
	MOV	C,B
	INX	H
	ret


  ;    if ((IOind[unit] & 255) == 0) IOind[unit] = IOind[unit] - 256;  */

putc:	CALL	@GPC
	ORA	A	; If to console */
	JNZ	PC@8
	POP	B
	POP	H
	POP	D	; Get character in D */
	PUSH	D
	PUSH	H
	PUSH	B
	JMP	@@B7	 ; Go output it */
PC@8:	DS	0
	CPI	PUNIT	; Check if phys device */
	JC	PC@9
	POP	B		; Get char in HL */
	POP	D
	POP	H
	PUSH	H
	PUSH	D
	PUSH	B
	JMP	@@PCH	 ; Go do it */
PC@9:	DCX	H
	PUSH	H

   ;   IObuf[IOind[unit]++] = c;       */

	LXI	H,6
	DAD	SP
	MOV	A,M
	CPI	LF		; LF on non-bin file? */
	JNZ	PC@1
	PUSH	H
	LXI	H,IObin
	DAD	D
	MOV	A,M
	CPI	'b'
	JZ	PC@3
	LXI	H,C@LFD  ; Yes - check flag to see if CR output already */
	DCR	M
	JNZ	PC@2
	MVI	A,EOL
	POP	H
	JMP	PC@1
C@LFD:	DB 1
PC@2:	MVI	M,1
PC@3:	POP	H
	MVI	A,LF
PC@1:	LHLD	IOtmp
	DAD	B
	MOV	M,A
	XTHL
	PUSH	H
	PUSH	H
	MOV	H,B
	MOV	L,C
	INX	H
	CALL	q@
	POP	H

   ;   if ((IOind[unit] & 255) == 0)   */

	XRA	A
	CMP	M
	POP	H
	JNZ	@PC1

   ;	       if (write(unit,&IObuf[IOind[unit]-256],256) <= 0) return -1; */

	POP	B
	POP	D
	PUSH	D
	PUSH	B
	PUSH	D
	DCR	H
	INR	L
	PUSH	H
	LXI	H,256
	PUSH	H
??PC2	EQU	$+1
	CALL	write		; This location may be modified by seek */
	POP	B
	POP	B
	POP	B
	MOV	A,H
	ORA	L
	LXI	H,-1
	RZ
	RM

   ;   return (c & 255);       */

@PC1:	LXI	H,4
	DAD	SP
	MOV	L,M
	MVI	H,0
	LDA	C@LFD
	ORA	A
	JZ	putc	; If output CR, follow with LF */
	ret

; Routines to write, read one block */

write:	XRA	A		; Remember whether write */
	STA	RD@RW
	MVI	A,writef
	JMP	RD@0
RD@T:	DS	1
@@RW@2: PUSH	H		; Increment sector count */
	LXI	H,8
	DAD	SP
	CALL	h@
	XCHG
	POP	H
	PUSH	H		; Retrieve sectors read/written */
	DAD	H		; (CP/M - Multiple of 128 bytes) */
	LDA	RD@RW
	ANA	H		; R/W flag is number of sectors read */
	PUSH	PSW		; Save it on stack */
	MOV	A,H
	LXI	H,IOsect
	DAD	D
	DAD	D
	ADD	M		; Add to sector count */
	MOV	M,A
	JNC	@PC5
	INX	H		; And carry if necessary */
	INR	M
@PC5:	LXI	H,IOrw		; Store R/W flag */
	DAD	D
	POP	PSW		; Get nr sectors read back */
	MOV	M,A
	POP	H
	ret


read:	MVI	A,-1
	STA	RD@RW
	MVI	A,readf
RD@0:	STA	RD@T
	LDA	Cmode	; If not in raw mode, give ^c a shot */
	ORA	A
	CNZ	CtlCk
	CALL	@@RW@
	PUSH	B		; Save original count */
RD@1:	MOV	A,B		; Done reading? */
	ORA	C
	JZ	RD@4		; Yes - quit */
	PUSH	D		; Save FCB */
	PUSH	H		; Save address */
	PUSH	B		; Save remaining count */
	PUSH	D		; Save FCB */
	XCHG
	MVI	C,SETDMA
	CALL	bdose
	POP	D		; Get FCB */
	LDA	RD@T	; Get read/write code */
	MOV	C,A
	CALL	bdose
	POP	B		; Get count */
	ORA	A		; If EOF */
	JNZ	RD@2		; Quit */
	LXI	H,-128
	DAD	B
	MOV	B,H
	MOV	C,L
	POP	H		; Bump address */
	LXI	D,128
	DAD	D
	POP	D		; Get FCB back */
	JMP	RD@1
RD@2:	POP	H		; Error - Pop adr, FCB off stack */
	POP	D		; saving adr in H */
	LDA	RD@T	; Check read or write */
	CPI	writef
	JNZ	RD@4		; If read, EOF. Just return count */
	POP	H
	LXI	D,RD@M		; Write - it's an error. */
	MVI	C,PRINT 	; Print message */
	CALL	bdose
	LXI	H,-1		; Return -1 */
	JMP	RD@3
RD@M:	DB	'Write error - Disk full'
	DB	0AH,0DH,'$'
RD@4:	POP	D		; Restore orig. count */
	MOV	H,B
	MOV	L,C
	CALL	s@1		; Return amount read */
RD@3:	PUSH	H
	MVI	C,SETDMA	; Restore DMA address */
	LXI	D,defbuf	; (because CDOS uses it) */
	CALL	bdose
	POP	H
	JMP	@@RW@2		 ; Return */
RD@RW:	DS	1

; Subroutine to set up channel and transfer addresses.
;	CALL	with stack = [ret.ad; ret.ad; xfer count; buffer adr; channel].
;	RETurns with addresses set up for read/write call.
;  CP/M: BC=count, DE=FCB, HL=address. */

@@RW@:	LXI	H,8
	DAD	SP
	MOV	A,M
	DCR	A
	DCX	H
	PUSH	H		; Save address */
	CALL	@CPC	) return NULL;      */
	JMP	RN@@

   ;   scall = 34;	       ; Compute system call - .OPENR, W or U. */
   ;   if (*mode == 'w') scall = 35;
   ;	if (*mode == 'u') scall = 36;	*/

O2@@:	POP	B
	POP	D
	PUSH	D
	PUSH	B
	XCHG

   ;   IOmode[i] = *mode++;
   ;	IObin[i] = *mode;
   ;	IOseek[i] = IOrw[i] = 0;	   */

	MOV	A,M
	INX	H
	MOV	B,M
	XCHG
	LXI	D,IOrw-IOch
	DAD	D
	MVI	M,0
	LXI	D,IOseek-IOrw
	DAD	D
	MVI	M,0
	LXI	D,IObin-IOseek
	DAD	D
	MOV	M,B
	LXI	D,IOmode-IObin
	DAD	D
	MOV	M,A
IOguy	equ IOnch
	LXI	D,IOnch-IOmode	; CP/M - set chars in buffer to 0 (= 256) */
	DAD	D
	MVI	M,0
	STA	O6@@+1
	LXI	D,IOguy 	; Macro-80 can't relocate neg. addr. */
	XCHG
	CALL	s@1
	PUSH	H
	LXI	H,6
	DAD	SP
	CALL	h@
	POP	B
	PUSH	B
	MOV	A,C
	DCR	A
	PUSH	H			; Save file name */
	CALL	@CPC		; Get FCB from "channel" */
	POP	H
	JZ	RN@@			 ; Return if can't alloc */
	PUSH	D			; Save FCB */
	XCHG
	CALL	x?fcb		; Put name in it */
O6@@:	MVI	A,0		; Gets plugged with mode */
	MVI	C,OPENR
	CPI	'w'		; If not open for write, */
	JNZ	O6@@B		 ; just do OPEN. */
	POP	D
	PUSH	D
	MVI	C,DELETE	; Open for write - delete file */
	CALL	bdose
	MVI	C,MAKE		; Then make new one. */
O6@@B:	POP	D			; Restore FCB */
	CALL	bdose
	POP	D
	INR	A			; Check for error */
	JZ	RN@@

  ;    IOch[i] = i;	       ; Initialize index into buffer */

	LXI	H,IOch
	DAD	D
	MOV	M,E

  ;    IOind[i] = 256;	       ; to point to LWA + 1 */

	LXI	B,IOind-IOch
	DAD	B
	DAD	D
	XRA	A
	MOV	M,A
	INX	H
	MVI	M,1

  ;    IOsect[i] = 256;        ; Clear sector count */

	LXI	B,IOsect-IOind
	DAD	B
	MOV	M,A
	DCX	H
	MOV	M,A

  ; See if buffer already allocated */

	LXI	B,IObuf-IOsect
	DAD	B
	MOV	A,M
	INX	H
	ORA	M
	JNZ	O8@@

  ; No - allocate 256 bytes for it. */

	PUSH	D
	PUSH	H
	LXI	B,256
	PUSH	B
	CALL	sbrk
	POP	B
	XCHG
	POP	H
	MOV	M,D
	DCX	H
	MOV	M,E

  ; Return NULL if sbrk returned -1 */

	INX	D
	MOV	A,E
	ORA	D
	POP	D
	JZ	RN@@

  ;    return i;	       (Clear carry for internal call) */

O8@@:	XCHG
	XRA	A
	ret

unit:	dw	0

fclose: POP	B	
	POP	D
	PUSH	D
	PUSH	B
	MOV	A,E				; Check if physical unit */
	CPI	PUNIT
	JC	F@@1
	LXI	H,IOpwri			; Yes - check if can write */
	CALL	@@PU
	INX	H				; If not, just return */
	RC
	LXI	D,IOpeof-IOpwri-1		; Else write EOF */
	DAD	D
	MOV	E,M
	MOV	A,E
	ORA	A
	CNZ	bdose
	LXI	H,0
	RET			; and return */
F@@1:	LXI	H,IOch
	DAD	D
	MOV	A,M
	INR	A
	JZ	RN@@	 
	MVI	M,-1	;	 IOch[unit] = -1;	 ; Release channel. */
	CALL	TM@@			 ; Put buffer address in IOtmp */
	LXI	H,IOmode
;    if (IOmode[unit] <=> 'r') { ; If file being written, */
	DAD	D
	MOV	A,M
	CPI	'r'
	JZ	F2@@
	LXI	H,IObin 	;  and binary char*/
	DAD	D
	MOV	C,M
	LXI	H,IOind   ;   i = IOind[unit];	   */
	DAD	D
	DAD	D
	PUSH	D
	CALL	h@
	MOV	A,L	 ;	  if (i & 255) {	  */
	ORA	A
	JZ	F3@@
	XCHG
	PUSH	PSW	; CP/M - save whether >= 128 bytes */
	LHLD	IOtmp
	MOV	A,C	 ;	      if (IObin[unit] <=> 'b')		  */
	CPI	'b'
	JZ	F5@@
	DAD	D	 ;	      while (i & 255) IObuf[i++] = 0;	 */
	MVI	A,EOF		; Fill last record with ctrl-Z for CP/M */
F4@@:	MOV	M,A
	INX	H
	INR	E
	JNZ	F4@@
	DCR	H  ;	 write(unit,&IObuf[i-256],256); ; dump buffer */
F5@@:	POP	PSW		; CP/M - might want to write 128 */
	PUSH	H
	LXI	H,128
	DCR	A		; or 256 if index > 128 */
	JP	F5A@@
	DAD	H
F5A@@:	PUSH	H
??CL2	EQU	$+1
	CALL	write		; This location may be modified by seek */
	POP	B
	POP	B
F3@@:	POP	D

F2@@:	MOV	A,E
	DCR	A
	PUSH	D
	CALL	@CPC
	MVI	C,CLOSE
	CALL	bdose
	INR	A
	POP	H
	RNZ

  ;    return NULL;	       */

RN@@:	LXI	H,NULL
	STC
	RET

  ; Subroutine to put buffer address in IOtmp */
TM@@:	LXI	H,IObuf
	DAD	D
	DAD	D
	MOV	C,M
	INX	H
	MOV	B,M
	PUSH	B
	POP	H
	SHLD	IOtmp
	ret

getc:
@G3:	CALL	@GPC	
	ORA	A	; If unit 0 */
	JZ	@@B8	 ; Read from console */
	CPI	PUNIT	; Check if phys device */
	JNC	@@GCH
	XRA	A
	CMP	C
	DCX	H
	JNZ	@G1
	PUSH	H	 ;  IOind[unit] = IOind[unit] - 256; */
	PUSH	D	 ;  if (read(unit,&IObuf[IOind[unit]],256) == 0)  */
	LHLD	IOtmp
	PUSH	H
	LXI	H,256
	PUSH	H
	CALL	read
	POP	B
	POP	B
	POP	D
	PUSH	D
	XCHG	; Store amount read in IOnch[unit] */
	LXI	B,IOnch
	DAD	B
	MOV	M,E
	MOV	A,E
	ORA	D
	POP	D
	POP	H
	JZ	@@RM	    ;	     return -1; }    */

   ;	       c = 255 & IObuf[IOind[unit]++]; */
   ; (IOind+unit is still in (SP)). */

@G1:	PUSH	D
	PUSH	H
	CALL	h@
	INX	H
	CALL	q@
	DCX	H
	XCHG
	LHLD	IOtmp
	DAD	D
	MOV	B,M

   ;	       if (IObin[unit] == 'b') return c;       */

	LXI	H,IObin
	POP	D
	DAD	D
	MVI	A,'b'
	CMP	M
	Jw count in A and Cbuf in HL */
	CMP	M		; Past last char? */
	RC		; No - return */
	RZ
	XCHG			; Yes - read another line */
	MVI	C,READC
	DCX	D
	CALL	bdose
	XRA	A
	STA	Ccnt
	MVI	E,LF
	CALL	@@RADD		 ; Add Line Feed */
	JMP	@@RLIN
CtlCk:	MVI	C,CONSTAT	; Check for console input (maybe ctrl-c) */
	CALL	bdose
	ORA	A
	RZ
	MVI	C,SCIN
	CALL	bdose		; Char waiting - read it */
	CPI	3		; Check ctrl-C */
	JZ	0		; and reboot if there */
	CPI	2		; Check ctrl-B */
	JZ	CtlB-1
	CPI	EOL
	JNZ	@@CC
	MVI	A,LF
@@CC:	MOV	E,A
@@RADD: LHLD	Cbuf	; Add character fm E to console line buffer */
	MOV	A,M
	DCX	H
	CMP	M
	RNC			; Return if no room */
	INX	H
	INR	M		; Inc count */
	MOV	C,M
	MVI	B,0
	DAD	B
	MOV	M,E		; Store char */
	MVI	A,LF
	CMP	E
	MVI	C,SCOUT
	CZ	bdose		; If CR, echo line feed */
	RET		; CHARACTER INPUT ROUTINE */
@@B8Z:	CALL	CtlB-1		; Enter here to process ^B and reread */
@@B8:	MVI	A,PUNIT 	; Enter here to read from console */
@@GCH:	LXI	H,IOprea	; Enter here for CHAR IN; A = unit */
	CALL	@@PU
	RC			; Return if error */
	PUSH	B		; Save sys fn */
	LDA	Cmode		; Check if line mode & console input(both 1)*/
	CMP	C
	JNZ	@@GC1		 ; If so, */
	CALL	@@RLIN		 ; read a char from console in line mode */
	STA	Ccnt
	MOV	E,A
	MVI	D,0
	DAD	D
	MOV	A,M
	JMP	@@GC2
@@GC1:	MVI	E,-1		; Otherwise, get char the regular way. */
	CALL	bdose		; (put FF in E in case it's fn 6) */
@@GC2:	POP	B
	CPI	EOL		; If char is CR */
	JNZ	@@B8P
	DCR	C		; If fn is SCIN = 1 */
	JNZ	@@B8M
	MVI	E,10		; echo LF */
	MVI	C,SCOUT
	CALL	bdose
@@B8M:	LXI	H,10		; Return LF. */
	RET
@@B8P:	DCR	C		; If fn is SCIN = 1, */
	JNZ	@@B8G
	CPI	2		; Check for ctl-b */
	JZ	@@B8Z
@@B8G:	CPI	EOF		; Ctl-z? */
	JZ	@@B9
	MOV	L,A		; Return the char (12/83) */
	MVI	H,0
	RET

@@B9:	DS 0
@@RM:	LXI	H,-1
	ret

; Write a character to the console */
;    return putc(c,fout);  */
putcha:
	POP	B
	POP	D
	PUSH	D
	PUSH	B
	LHLD	fout
	PUSH	D
	PUSH	H
	CALL	putc
	POP	B
	POP	B
	RET
@@B7:	XCHG
	MVI	A,PUNIT
@@PCH:	PUSH	H		; Char out; A = unit, HL = char */
	LXI	H,IOpwri
	CALL	@@PU
	POP	D		; Restore char */
	RC		; Return if error */
	PUSH	D
	XCHG
	MOV	A,L
	CPI	LF		; If outputting LF */
	JNZ	@@B7A
	MVI	E,EOL		; First put CR */
	PUSH	B		; Save scall number */
	CALL	bdose
	POP	B
	MVI	A,LF		; Get LF into A */
@@B7A:	MOV	E,A
	CALL	bdose
	POP	H
	RET

	; Check for physical unit - return carry if no good */
	; Call with IOprea or IOpwri in HL, log unit in A */
	; Return sys call in C, HL points to it in table. */
IOdev:	DB	'con:rdr:pun:lst:'
	DB	0

@@PU:	SUI	PUNIT		; Check channel in bounds */
	JC	@@PU1
	CPI	4
	JP	@@PU1
	MOV	E,A
	MVI	D,0
	DAD	D
	MOV	A,M
	MOV	C,A		; Get call number */
	ORA	A
	RNZ		; Check can do operation */
@@PU1:	STC			; error ret */
	JMP	@@RM

; io storage
IObuf:	dw	0,0,0,0,0,0,0	; Start of buffer for file */
IOsect: dw	0,0,0,0,0,0,0	; Current sector, for seek */
IOrw:	db	0,0,0,0,0,0,0	; # sectors read on last op on chan */
IOtmp:	dw	0		; Holds buffer start within routines */
IOch:	db -1,-1,-1,-1,-1,-1,-1 ; Channel for open files */
IOind:	dw	0,0,0,0,0,0,0	; Index of next character in current rec */
IOmode: db	0,0,0,0,0,0,0	; Mode in which opened */
IObin:	db	0,0,0,0,0,0,0	; Binary? */
IOseek: db	0,0,0,0,0,0,0	; If seek performed on file */

IOfcb:	dw	0,0,0,0,0,0,0	; FCB addresses for files.  In CP/M, */
				;  channel is index into this array. */
IOnch:	db	0,0,0,0,0,0,0	; Nr chars in buffer: 0 or 128 */
IOpcha: db	32,33,34,35	; Logical channels */
IOprea: db	1, 3, 0, 0	; System call for read */
IOpwri: db	2, 0, 4, 5	; System call for write */
IOpeof: db	0,EOF,EOF,12	; EOF char: FF for LST */


; Open file sname with indicated mode - "w", "r" or "u". */
   ; For CP/M, check if device is any of the logical hardware devices */
fopen:	POP	B
	POP	H
	POP	D		; Get name in D, table in H */
	PUSH	D
	PUSH	H
	PUSH	B
	LXI	H,IOdev
	MVI	C,32	; Loop count */
Z1@@:	PUSH	D
	PUSH	H
	MVI	B,4
Z2@@:	LDAX	D
	ORI	' '	; lower case */
	CMP	M
	JNZ	Z3@@
	INX	D
	INX	H
	DCR	B
	JNZ	Z2@@
	POP	D	; Match succeeds */
	POP	H
	MOV	L,C	; Return channel */
	MVI	H,0
	RET
Z3@@:	LXI	D,4	; Match fails - inc IOdev ptr */
	POP	H
	DAD	D
	POP	D
	INR	C
	MOV	A,M
	ORA	A
	JNZ	Z1@@	 ; Check next channel if not done */
   ;   i = 1;		       ; Find an available channel */
   ;   while (i <= NFILES)     */
   ;	  if (IOch[i] == -1) break;
   ;		else i++;	*/

	MVI	B,NFILES
	LXI	H,IOch+1
O1@@:	MOV	A,M
	CPI	-1
	JZ	O2@@
	INX	H
	DCR	B
	JNZ	O1@@

   ;   if (i>NFILESwithout charge, provided this notice is included.

	extrn	wboote,bdose,deffcb,defbuf
	extrn	main,c@ugt,c@uge,c@sxt,s@1,h@,q@

	public	??ver,dos?v,sys?v
	public	exit,fin,fout,@@END
	public	Cmode,CtlCk,x0fcb,x?fcb,CtlB,NAM@U,??PC2,??CL2
	public	c?lib,iobuf,iofcb,q8qend,fclose,fopen,sbrk,getcha
	public	getc,ioprea,putcha,putc,iopwri,iosect,iorw,iotmp,ioch
	public	ioind,iomode,iobin,ioseek,ionch,iopcha,iopeof,write,read

c?lib:	cseg
??ver:
dos?v:	db	0
sys?v:	db	0

@@AS	EQU	$+2	   ; CP/M- use this code area for argv arg list */
@@AG	EQU	$

@@INIT: DW	0		; No-op; initializes $AG */
	mvi	c,12	;provide system version, etc
	call	bdose	;for program and lib routines
	shld	??ver	;
	LHLD	bdose+1 	; Max mem address */
	DCX	H
	DCR	H		; At this point, HL contains max usable */
	SHLD	IObuf+6 	; memory address.  Allocate 3 buffers; */
	DCR	H		; use likely HDOS overlay area at top memory */
	SHLD	IObuf+4
	DCR	H
	SHLD	IObuf+2
	LXI	B,-FCBLEN	; Allocate 3 FCBs */
	DAD	B
	SHLD	IOfcb+4
	DAD	B
	SHLD	IOfcb+2
	DAD	B
	SHLD	IOfcb
	LXI	B,-135		; and console buffer */
	DAD	B
	MVI	M,0
	SHLD	Cbuf
	DCX	H
	MVI	M,132
	DCX	H
	SPHL			; Set up stack */
	LXI	D,Q8QEND       ; Set sbrk locn to higher of code, data segs */
	PUSH	D
	LXI	H,@@END
	CALL	c@ugt
	POP	H
	JZ	@@A81
	SHLD	@@LM
@@A81:	LXI	H,defbuf	; Get address of arg line */
	MOV	E,M		; And char count */
	MVI	M,' '		; Add on space we might or might not take */
	MVI	D,0
	DAD	D		; Get end of string */
	INR	E		; Fix char count */
	LXI	B,0		; Push 2 0 bytes to start */
@@A8:	PUSH	B
	MOV	B,M		; Move string onto stack 2 bytes at a time */
	DCX	H		; (necessary because CP/M 1.4 clobbers 80H) */
	MOV	C,M
	DCX	H
	DCR	E
	DCR	E
	JP	@@A8
	LXI	H,202AH 	; Push first arg, which is always * */
	PUSH	H
	LXI	H,@@AS		; Push fwa of arg stack */
	PUSH	H
	LXI	H,2		; Leave arg line address in HL */
	DAD	SP
@@A2:	DS	0		; Scan next argument. */
@@A7:	MOV	A,M		; Skip over blanks between args. */
	INX	H		
	ORA	A		
	JZ	@@A6		; Terminate on 0 byte */
	CPI	' '
	JZ	@@A7
	MOV	C,A		; Save first character of arg in C */
	CPI	'"'		; If it's a quote character, leave it */
	JZ	@@A3		;  (so C contains terminator char) */
	CPI	047Q
	JZ	@@A3
	MVI	C,' '		; Otherwise terminate on blank */
	DCX	H		;  and include first char in arg */
@@A3:	POP	D		; Store address of arg in arg list */
	MOV	A,L
	STAX	D
	INX	D
	MOV	A,H
	STAX	D
	INX	D
	PUSH	D
	PUSH	H		; Save address of arg on stack */
	DCX	H
@@A9:	INX	H		; Skip to end of argument */
	MOV	A,M
	ORA	A
	JZ	@@A5
	CMP	C
	JNZ	@@A9
	MVI	M,0		; Terminate arg with 0 byte */
	INX	H
@@A5:	XTHL		; Check for > or < arg for I/O redirection */
	MOV	A,M
	INX	H
	CPI	'<'
	JZ	@@B1
	CPI	'>'
	JZ	@@B2
	LXI	H,@@AG		; Bump arg count */
	INR	M
	POP	H		; Restore command line pointer */
	JMP	@@A2		; Go do next arg */
@@A6:	POP	H		; Done with command line.  Put -1 at end */
	MVI	M,-1		; of array, push argv and argc. */
	INX	H
	MVI	M,-1
	LHLD	@@AG
	PUSH	H
	LXI	H,@@AS
	PUSH	H
	CALL	main
exit:	LHLD	fout
	MOV	A,H
	ORA	L
	JZ	@@B4
	PUSH	H
	CALL	fclose
@@B4:	JMP	wboote
exic	EQU	exit

; I/O redirection: open a file */
@@B1:	PUSH	H
	LXI	H,@@BR
	PUSH	H
	CALL	fopen
	SHLD	fin
	JMP	@@B3
@@BR:	DB	'r',0
fin:	DW	0
@@B2:	PUSH	H
	LXI	H,@@BW
	PUSH	H
	CALL	fopen
	SHLD	fout
@@B3:	POP	B
	POP	B
	JC	@@B0

; Restore command line pointer; discard the > or < arg */

	POP	H
	POP	D
	DCX	D
	DCX	D
	PUSH	D
	JMP	@@A2
@@B0:	LXI	D,@@BMS
	MVI	C,PRINT
	CALL	bdose
	MVI	C,abort
	CALL	bdose

@@BMS:	DB	'Can''t open > or < file.$'

CtlB	EQU	$+1	; Patch here for ctl-c action */
	JMP	exic	; Patch here for ctl-c action */

@@BW:	DB	'w',0
fout:	DW	0

; Allocate memory; return -1 if none available (with 500 byte threshold) */

; WARNING : upon program execution, @@LM MUST point to the very end
;	     of the program.  Because LINK and L80 load the data segment
;	     differently, @@LM is computed at initialization time.

sbrk:	POP	D
	POP	B
	PUSH	B
	PUSH	D
	LHLD	@@LM
	PUSH	H
	PUSH	H
	POP	D
	DAD	B
	PUSH	H
	PUSH	H
	CALL	c@ugt
	POP	D
	JNZ	al@1
	LXI	H,-500
	DAD	SP
	CALL	c@uge
al@1:	POP	D
	POP	B
	LXI	H,-1
	RNZ
	XCHG
	SHLD	@@LM
	PUSH	B
	POP	H
	RET
@@LM:	DW	@@END

; Get a character from the console */
;      return getc(fin);       */
getcha:
	LHLD	fin
	PUSH	H
	CALL	getc
	POP	B
	RET
Ccnt:	DB	0
Cbuf:	DS	2
Cmode:	DB	1		; Set to 0 for raw console input */
@@RLIN: LDA	Ccnt	; Check if console buffer needs more chars */
	INR	A		; Returns with chars in buffer, */
	LHLD	Cbuf	; neora	c
	jz	L00FD
	mov	a,m
	inx	h
	cmp	e
	mov	a,m
	inx	h
	jnz	L00E6
	cmp	d
	jnz	L00E6
	mov	h,b
	mov	l,c
L00FD:	pchl

	; multiply
c@mult: mov	b,h
	mov	c,l
	lxi	h,0
	mov	a,d
	ora	a
	mvi	a,16
	jnz	L010D
	mov	d,e
	mov	e,h
	rrc	; 8
L010D:	dad	h
	xchg
	dad	h
	xchg
	jnc	L0115
	dad	b
L0115:	dcr	a
	jnz	L010D
	ret

	; unsigned division
c@udv:	xra	a
	push	psw
	jmp	L012A

	; division
c@div:	mov	a,d
	xra	h
	push	psw
	xra	h
	xchg
	cm	c@neg
	xchg
	mov	a,h
	ora	a
L012A:	cp	c@neg
	mov	c,l
	mov	b,h
	lxi	h,0
	mov	a,b
	inr	a
	jnz	L013E
	mov	a,d
	add	c
	mvi	a,16
	jc	L0143
L013E:	mov	l,d
	mov	d,e
	mov	e,h
	mvi	a,8
L0143:	dad	h
	xchg
	dad	h
	xchg
	jnc	L014B
	inx	h
L014B:	push	h
	dad	b
	pop	h
	jnc	L0153
	dad	b
	inx	d
L0153:	dcr	a
	jnz	L0143
	xchg
	pop	psw
	rp
	xchg
	call	c@neg
	xchg
	jmp	c@neg
	ret

	end
1)			/*	EOF Value		    */
#define TRUE	(1)			/*	Function TRUE  value	    */
#define FALSE	(0)			/*	Function FALSE value	    *//* delete - delete filename */
/* Feb 26, 1986 20:15 drm */
delete(name)
char *name;
    {
    char fcb[44];
    makfcb(name,fcb);	    /* setup fcb from name string */
    bdos(26,&fcb[36]);	    /* allow for possible password */
    return bdos(19,fcb);    /* delete the file */
    }

 */
    bdos(26,&fcb[36]);	    /* allow for possible password */
    return bdos(19,w
	jmp	L012A

	; division
c@div:	mov	a,d
	xra	h
	push	psw
	xra	h
	xchg
	cm	c@neg
	xchg
	mov	a,h
	ora	a
L012A:	cp	c@ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее; Feb 26, 1986	19:47  drm  "CLIBIO.C" */
; modified for DRI RMAC and .PRL generation */
; CLIBIO.C : includes environment dependent routines (e.g, argument list
;	     preparation, I/O).  This code is not ROMable and must
;	     be replaced if a ROMable object module is to be generated.
; IMPORTANT: CLIBIO must be loaded last in the object module to define @@END.

; C/80 3.1 runtime library. (c) 1983 Walter Bilofsky.  All rights
;  reserved.  This library in C source and assembler source form may
;  not be copied or transmitted to other than the original purchaser
;  of C/80.  Executable object modules including code produced by
;  C/80 and by this library may be distributed without restriction;
;  acknowledgement that C/80 is used would be appreciated. */

; NFILES = number of files open at one time. */
NFILES	equ 6
NULL	equ 0

abort	equ 0
SCIN	equ 1
SCOUT	equ 2
PRINT	equ 9
READC	equ 10
CONSTAT equ 11
OPENR	equ 15
CLOSE	equ 16
DELETE	equ 19
readf	equ 20
writef	equ 21
MAKE	equ 22
SETDMA	equ 26

EOL	equ 13		; End of line = CR, */
LF	equ 10		; LF. */
EOF	equ 26		; ASCII End of file */
FCBLEN	equ 36+8	; Length of an FCB, plus space for password
PUNIT	equ 32		; Lowest physical I/O channel */


; Entry for all C programs.  Initialize I/O channel array.
; Get all possible memory and put stack up at the top. */

; CLIBRARY.ASM 3.0 (4/3/84) - (c) 1982, 1983, 1984 Walter Bilofsky
; Multiply and divide routines (c)1981 UltiMeth Corp. Permission is gran-
; ted to reproduce them ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее; May 9, 1984  15:40  drm  "CLIBMATH.ASM"

;generated from LISTREL1 output of CLIBRARY.REL
;modified for use with RMAC (no ".","$" or "_" in labels)
; changed "$" to "@@", changed "_" to "?".
; (all "." labels duplicated with "@", so were deleted)

	public c?math
	public e@t,e@2,c@gt,c@le,c@lt,c@ge,c@uge,c@ule,c@ugt
	public c@ult,c@tst,c@asr,c@usr,c@asl,c@com,c@not,c@sxt,c@mult
	public c@udv,c@div,c@neg,o@,x@,a@,e@0,e@,n@,s@,s@1,g@,q@
	public @switc,h@

	extrn @@end

	cseg
c?math: org	0

	; .OR.
o@:	pop	b	;return address
	pop	d	;parameter in DE
	push	b
	mov	a,l	; HL=HL|DE
	ora	e	;
	mov	l,a	;
	mov	a,h	;
	ora	d	;
	mov	h,a	;
	ret

	; .XOR.
x@:	pop	b
	pop	d
	push	b
	mov	a,l
	xra	e
	mov	l,a
	mov	a,h
	xra	d
	mov	h,a
	ret

	; .AND.
a@:	pop	b
	pop	d
	push	b
	mov	a,l
	ana	e
	mov	l,a
	mov	a,h
	ana	d
	mov	h,a
	ret

	;force .TRUE. or .FALSE.
e@0:	mov	a,h
	ora	l
	rz
	;set .TRUE.
e@t:	lxi	h,0	;make .TRUE.
	;increment
e@2:	inr	l	;( 0001 )
	ret

	; .EQ.
e@:	pop	b
	pop	d
	push	b
	mov	a,h
	cmp	d
	mov	a,l
	lxi	h,0	;.FALSE.
	jnz	L0038
	cmp	e
	jnz	L0038
	inr	l	;.TRUE.
	ret
L0038:	xra	a
	ret

	; .NOT.
c@not:	mov	a,h
	ora	l	;if .FALSE.
	jz	e@2	;set .TRUE.
	lxi	h,0	;else set .FALSE.
	xra	a
	ret

	; .NE.
n@:	pop	b
	pop	d
	push	b
	mov	a,h
	cmp	d
	mov	a,l
	lxi	h,1
	rnz
	cmp	e
	rnz
	dcr	l
	ret

	; .GE.
c@ge:	xchg
	; .LE.
c@le:	mov	a,d
	cmp	h
	jnz	L0064
	mov	a,e
	cmp	l
	jnz	L006F
	lxi	h,0
	inr	l
	ret

	; .GT.
c@gt:	xchg
	; .LT.
c@lt:	mov	a,d
L0064:	xra	h
	jm	L0075
	mov	a,d
	cmp	h
	jnz	L006F
	mov	a,e
	cmp	l
L006F:	lxi	h,1	;set .TRUE.
	rc
L0073:	dcr	l	;set .FALSE.
	ret

L0075:	mov	a,h
	ana	a
	lxi	h,1	;set .TRUE.
	jm	L0073
	ora	l
	ret

	;
c@tst:	mov	a,h
	xri	80h
	mov	h,a
	dad	d
	ret

	;
c@uge:	xchg
	;
c@ule:	mov	a,h
	cmp	d
	jnz	L008D
	mov	a,l
	cmp	e
L008D:	lxi	h,1	;set .TRUE.
	jnc	L0095
	dcr	l
	ret
L0095:	ora	l
	ret

	;
c@ugt:	xchg
	;
c@ult:	mov	a,d
	cmp	h
	jnz	L009F
	mov	a,e
	cmp	l
L009F:	lxi	h,1	;set .TRUE.
	rc
	dcr	l
	ret

	;
c@asr:	xchg
L00A6:	mov	a,h	;extend sign thru shift...
	ral		;
L00A8:	dcr	e
	rm
	mov	a,h
	rar
	mov	h,a
	mov	a,l
	rar
	mov	l,a
	jmp	L00A6

	;
c@usr:	xchg
	xra	a
	jmp	L00A8

	;
c@asl:	xchg
L00B9:	dcr	e
	rm
	dad	h
	jmp	L00B9

	; subtract
s@:	pop	b
	pop	d
	push	b
	;
s@1:	mov	a,e
	sub	l
	mov	l,a
	mov	a,d
	sbb	h
	mov	h,a
	ret

	; negate
c@neg:	dcx	h
	; 1s compliment
c@com:	mov	a,h
	cma
	mov	h,a
	mov	a,l
	cma
	mov	l,a
	ret

	; get 8 bit value (sign extended)
g@:	mov	a,m
	; sign-extend A into HL
c@sxt:	mov	l,a	;test sign of 8 bit value
	rlc
	sbb	a	;make 00 of FF based on sign
	mov	h,a
	ret

	; get HL from pointer HL
h@:	mov	a,m
	inx	h
	mov	h,m
	mov	l,a
	ret

	; put HL into pointer
q@:	xchg
	pop	h	;return address
	xthl		;get paramter, put ret.adr back on stack
	mov	m,e
	inx	h
	mov	m,d
	xchg
	ret

	; SWITCH command
@switc: xchg
	pop	h
L00E6:	mov	c,m
	inx	h
	mov	b,m
	inx	h
	mov	a,b
	LIB STDLIB0=RENAME,UNLINK,ABS,ALLFRE,ATOI,BDOS,GETLINE,INDEX,ISALPHA
LIB STDLIB0=STDLIB0,ISDIGIT,ISLOWER,ISSPACE,ISUPPER,ITOA,MAKFCB,MAX
LIB STDLIB0=STDLIB0,MIN,STRCAT,STRCMP,STRCPY,STRLEN,TOLOWER,TOUPPER
f */

#undef scanf
#undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscanf STK_pos(),s_scan
undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* rename - rename oldfile to be newfile  */
/* Feb 26, 1986 20:19 drm */
rename(old,new)
char *old,*new;
    {
    char fcb[60];
    makfcb(new,fcb+16); 	   /* enter new name */
    makfcb(old,fcb);		   /* and old one. */
    bdos(26,fcb+36);	/* possible password */
    return bdos(23,fcb);	   /* rename it */
    }

);		   /* and old one. */
    bdos(26,fcb+36);	/* p1)			/*	EOF Value		    */
#define TRUE	(1)			/*	Function TRUE  value	    */
#define FALSE	(0)			/*	Function FALSE value	    */ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* makfcb(file,fcb) - unpack filename into char fcb[44]. */
makfcb(file,fcb) {	/* may include password at &fcb[36] */
#asm
	POP B
	POP H
	POP D
	PUSH D
	PUSH H
	PUSH B
#endasm
	x0fcb();
}

b) {	/* may include password at &fcb[36] */
#asm
	Pf */

#undef scanf
#undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscanf STK_pos(),s_scan
undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define ssc************/
#define FAILURE (-1)			/*	Function failure return val */
#define SUCCESS (0)			/*	Function success return val */
#define YES	1			/*	"TRUE"			    */
#define NO	0			/*	"FALSE" 		    */
#define FOREVER for(;;) 		/*	Infinite loop declaration   */
#define NULL	0			/*	Null character value	    */
#define NULLPTR (char *) 0		/*	Null pointer value	    */
#define EOF	(-1)			/*	EOF Value		    */
#define TRUE	(1)			/*	Function TRUE  value	    */
#define FALSE	(0)			/*	Function FALSE value	    */


/* printf.h: definitions for printf and fprintf to allow multiple args.
 */

#undef printf
#undef fprintf
#undef sprintf
#define printf prnt_1(),prnt_2
#define fprintf prnt_1(),prnt_3
#define sprintf prnt_1(),prnt_4

/* Header file for scanf */

#undef scanf
#undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscanf STK_pos(),s_scan
undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее; May 10, 1984	09:28  drm  "DIEI.ASM"

; routines to disable/enable interupts from "C"

	public DISINT,ENAINT

disint: di
	ret

enaint: ei
	ret

	end
   */
#define NULL	0			/*	Null character value	    */
#define NULLPTR (char *) 0		/*	Null pointer value	    */
#define EOF	(-1)			/*	EOF Value		    */
#define TRUE	(1)			/*	Function TRUE  value	    */
#define FALSE	(0)			/*	Function FALSE value	    */ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

abs(i) { return i < 0 ? -i : i; }

                STDLIB  C     LxyЂ             ееееееееееееееееееееееееееееееееB
	LXI	H,0	; initialize length
SLLOOP: LDAX	D	; get next char
	ORA	A	; test for zero
	JZ	SLDONE	; end of string
	INX	D	; point at next character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONE: DS	0	; fall through for timer
#endasm
}

xt character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONE: DS	0	; fall through for timer
#endasееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/***************************************************************************
*
*	  C P / M   C	R U N	T I M E   L I B   H E A D E R	F I L E
*	  -------------------------------------------------------------
*	Copyright 1982 by Digital Research Inc.  All rights reserved.
*
*	This is an include file for assisting the user to write portable
*	programs for C.  All processor dependencies should be located here.
*
****************************************************************************/

/*
 *	Standard type definitions
 */

#define BYTE	char				/* Signed byte		   */
#define UBYTE	char				/* Unsigned byte	   */
#define BOOLEAN int				/* 2 valued (true/false)   */
#define WORD	int				/* Signed word (16 bits)   */
#define UWORD	unsigned int			/* unsigned word	   */

#define LONG	long				/* signed long (32 bits)   */
#define ULONG	long				/* Unsigned long	   */

#define REG	register			/* register variable	   */
#define LOCAL	auto				/* Local var on 68000	   */
#define EXTERN	extern				/* External variable	   */
#define MLOCAL	static				/* Local to module	   */
#define GLOBAL	/**/				/* Global variable	   */
#define VOID	/**/				/* Void function return    */
#define DEFAULT int				/* Default size 	   */
#define FLOAT	float				/* Floating Point	   */
#define DOUBLE	double				/* Double precision	   */


/****************************************************************************/
/*	Miscellaneous Definitions:					    */
/****************************************************************atic int i;
	if (t) {walk(t->left,n+1);
		for (i = n; i--; putchar('-'));
		putchar('\t'); putstr(t->value);
		if (t->count > 1) {
			putchar('(');
			if (t->count > 9) putchar('0' + t->count / 10);
			putchar('0' + t->count % 10); putchar(')'); }
		putchar('\n');
		walk(t->right,n+1);
	}	}

/* This routine recursively finds the place in the tree to hang the string c */
entree(c,tree) struct tree **tree; char c[20]; {
	char *p;
	if (*tree == 0) {
		*tree = alloc(sizeof (struct tree));
		(*tree)->left = (*tree)->right = 0;
		for (p = (*tree)->value; *p++ = *c++; );
		(*tree)->count = 1;
		return; }
	switch (strcmp(c,(*tree)->value)) {
		case 0: (*tree)->count += 1; break;
		case -1: entree(c,&(*tree)->left); break;
		case 1: entree(c,&(*tree)->right);
	}	}

putstr(s) char *s; {while (*s) putchar(*s++); }

#include "stdlib.c"

turn *p < *q ? -1 : 1; }
dd@
finedg: MOV	A,E
	RLC
	RLC
	ADD	E
	RLC
	ADD	M
	SUI	'0'
	MOV	E,A
	JMP	finec
chrgtr: INX	H
chrgt2: MOV	A,M
	CPI	':'ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

strlen(string)
char *string;
{
#asm
	POP	B	; return address
	POP	D	; the string
	PUSH	D	; restore stack
	PUSH	B
	LXI	H,0	; initialize length
SLLOOP: LDAX	D	; get next char
	ORA	A	; test for zero
	JZ	SLDONE	; end of string
	INX	D	; point at next character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONE: DS	0	; fall through for timer
#endasm
}

xt character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONE: DS	0	; fall through for timer
#endasееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*	*	*/

index(s,t)	/* find string t in s, return index, or -1 if fail*/
char s[], t[];
{
	static int i,j,k;

	for (i = 0; s[i] != '\0'; i++) {
	   for (j=i,k=0; t[k] != '\0' && s[j]==t[k]; ++j, ++k)
		;
	   if (t[k] == '\0') return(i);
	}
	return(-1); /* no match*/
}

r (j=i,k=0; t[k] != '\0' && s[j]==t[k]; ++j, ++k)
		;
	   if (t[k] == '\0') return(i);
	}
	retdd@
finedg: MOV	A,E
	RLC
	RLC
	ADD	E
	RLC
	ADD	M
	SUI	'0'
	MOV	E,A
	JMP	finec
chrgtr: INX	H
chrgt2: MOV	A,M
	CPI	':'ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее1
	PUSH	PSW
fout8f: PUSH	B
	PUSH	H
	PUSH	D
	CALL	movrf@
	POP	H
	MVI	B,2FH
fout10: INR	B
	MOV	A,E
	SUB	M
	MOV	E,A
	INX	H
	MOV	A,D
	SBB	M
	MOV	D,A
	INX	H
	MOV	A,C
	SBB	M
	MOV	C,A
	DCX	H
	DCX	H
	JNC	fout10
	CALL	fadda@
	INX	H
	INX	H
	CALL	movfr@
	XCHG
	POP	H
	MOV	M,B
	INX	H
	POP	B
	JMP	fout8
fout8b: MOV	A,B
	DCR	A
	CALL	foutt@
	DCR	B
	MVI	M,DECPNT
	CP	inxhr@
	POP	PSW
	CALL	foutt@
fout11: LDA	fmtc??
	ANI	040Q
	JNZ	fout12
fout11a: DCX	 H
	MOV	A,M
	CPI	'0'
	JZ	fout11a
	CPI	DECPNT
	CNZ	inxhr@
fout12: POP	PSW
	ORA	A
	JZ	fout17
fout20: MVI	M,'e'
	INX	H
	MVI	M,'+'
	JP	fout14
	MVI	M,'-'
	CMA
	INR	A
fout14: MVI	B,'0'-1
fout15: INR	B
	SUI	10
	JNC	fout15
	INX	H
	MOV	M,B
fout19: INX	H
	ADI	'0'+10
	MOV	M,A
fout19a: INX	H
fout17: MVI	M,0
	RET
foutt@: DCR	A
	RM
	MVI	M,'0'
	INX	H
	JMP	foutt@
f@round: ADD	A
	RM
	CPI	28
	RNC
	ADD	A
	MOV	E,A
	MVI	D,0
	LXI	H,@wmvb
	DAD	D
	CALL	movrm@
	JMP	fadd@
	RET
atof:	DS	0
	LXI	H,2
	DAD	SP
	MOV	E,M
	INX	H
	MOV	D,M
	XCHG
	MOV	A,M
	CALL	ffin
	JMP	movrf@
ffin:	CPI	'-'
	PUSH	PSW
	JZ	fin1
	CPI	'+'
	JZ	fin1
	DCX	H
fin1:	CALL	zero@
	MOV	B,A
	MOV	D,A
	MOV	E,A
	CMA
	MOV	C,A
finc:	CALL	chrgtr
	JC	findig
	CPI	DECPNT
	JZ	findp
	CPI	'e'
	JZ	founde
	CPI	'E'
	JNZ	fine
founde:
	CALL	chrgtr
	CALL	minpls
finec:	CALL	chrgtr
	JC	finedg
	INR	D
	JNZ	fine
	XRA	A
	SUB	E
	MOV	E,A
	INR	C
findp:	INR	C
	JZ	finc
fine:	PUSH	H
	MOV	A,E
	SUB	B
fine2:	CP	finmul
	JP	fine3
	PUSH	PSW
	CALL	div10@
	POP	PSW
	INR	A
fine3:	JNZ	fine2
	POP	D
	POP	PSW
	CZ	flneg@
	XCHG
	RET
finmul: RZ
finmlt: PUSH	PSW
	CALL	mul10@
	POP	PSW
dcrart: DCR	A
	RET
findig: PUSH	D
	MOV	D,A
	MOV	A,B
	ADC	C
	MOV	B,A
	PUSH	B
	PUSH	H
	PUSH	D
	CALL	mul10@
	POP	PSW
	SUI	30H
	CALL	finlog
	POP	H
	POP	B
	POP	D
	JMP	finc
finlog: CALL	pushf@
	CALL	float@
faddt:	POP	B
	POP	D
	JMP	fadd@
finedg: MOV	A,E
	RLC
	RLC
	ADD	E
	RLC
	ADD	M
	SUI	'0'
	MOV	E,A
	JMP	finec
chrgtr: INX	H
chrgt2: MOV	A,M
	CPI	':'
	RNC
chrcon: CPI	' '
	JZ	chrgtr
notlf:	CPI	'0'
	CMC
	INR	A
	DCR	A
	RET
minpls: DCR	D
	CPI	0A8H
	RZ
	CPI	'-'
	RZ
	INR	D
	CPI	'+'
	RZ
	CPI	0A7H
	RZ
	DCX	H
	RET
 string
	PUSH	D	; restore stack
	PUSH	B
	LXI	H,0	; initialize length
SLLOOP: LDAX	D	; get next char
	ORA	A	; test for zero
	JZ	SLDONE	; end of string
	INX	D	; point at next character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* This is a sample program using structures.  It sorts a list of input
   words alphabetically using a binary sort tree. */

struct tree {
	struct tree *left,*right;
	char value[20];
	int count; } *tree = 0;
main() {
	char c[20];
	while (putstr("Word: "), getline(c,20)) entree(c,&tree);
	putstr("Here are the sorted words:\n");
	walk(tree,1);
	}

/* This routine prints out the tree recursively: walk left node, print
	value of this node, and walk right node */
walk(t,n) struct tree *t; {
	st
	XTHL
	PUSH	H
	LHLD	facl?2
	XTHL
	PUSH	H
	XCHG
	RET
movfm@: CALL	movrm@
movfr@: XCHG
	SHLD	facl?
	MOV	H,B
	MOV	L,C
	SHLD	facl?2
	XCHG
	RET
movrf@: LXI	H,facl?
	JMP	movrm@
inxhr@: INX	H
	RET
movmf@: LXI	D,facl?
move:	MVI	B,4
move1:	LDAX	D
	MOV	M,A
	INX	D
	INX	H
	DCR	B
	JNZ	move1
	RET
unpack: LXI	H,facl?2
	MOV	A,M
	RLC
	STC
	RAR
	MOV	M,A
	CMC
	RAR
	INX	H
	INX	H
	MOV	M,A
	MOV	A,C
	RLC
	STC
	RAR
	MOV	C,A
	RAR
	XRA	M
	RET
fcomp@: MOV	A,B
	ORA	A
	JZ	sign@
	LXI	H,fcomps
	PUSH	H
	CALL	sign@
	MOV	A,C
	RZ
	LXI	H,facl?2
	XRA	M
	MOV	A,C
	RM
	CALL	fcomp2
fcompd: RAR
	XRA	C
	RET
fcomp2: INX	H
	MOV	A,B
	CMP	M
	RNZ
	DCX	H
	MOV	A,C
	CMP	M
	RNZ
	DCX	H
	MOV	A,D
	CMP	M
	RNZ
	DCX	H
	MOV	A,E
	SUB	M
	RNZ
	POP	H
	POP	H
	RET
fint@:	LXI	B,6900H
	MOV	D,C
	MOV	E,C
	CALL	fadd@
	LXI	H,fac?
	MOV	A,M
qint@:	MOV	B,A
	MOV	C,A
	MOV	D,A
	MOV	E,A
	ORA	A
	RZ
	PUSH	H
	CALL	movrf@
	CALL	unpack
	XRA	M
	MOV	H,A
	CM	qinta
	MVI	A,98H
	SUB	B
	CALL	shiftr
	MOV	A,H
	RAL
	CC	rounda
	MVI	B,0
	CC	negr
	POP	H
	RET
qinta:	DCX	D
	MOV	A,D
	ANA	E
	INR	A
	RNZ
dcxbrt: DCX	B
	RET
int:	LXI	H,fac?
	MOV	A,M
	CPI	98H
	LDA	facl?
	RNC
	MOV	A,M
	CALL	qint@
	MVI	M,98H
	MOV	A,E
	PUSH	PSW
	MOV	A,C
	RAL
	CALL	fadflt
	POP	PSW
	RET
overr:	CALL	erreur
	DB	1
	RET
dv0err: CALL	erreur
	DB	3
	RET
erreur:
	XTHL
	PUSH	PSW
	LDA	errcod
	ORA	A
	JNZ	exiterr
	MOV	A,M
	STA	errcod
exiterr:
	INX	H
	POP	PSW
	XTHL
	RET
Hc@Bf:	CALL	Hc@Bl
	JMP	HiBf0
Hi@Bf:	CALL	Hi@Bl
HiBf0:	CALL	fflo
	JMP	movrf@
Hu@Bf:	CALL	Hu@Bl
Bl@Bf:
	MOV	A,B
	ORA	A
	JP	BlBf0
	CALL	L@neg
	MVI	A,-1
BlBf0:	PUSH	PSW
	PUSH	B
	MVI	C,0
	CALL	fflo
	POP	B
	CALL	pushf@
	MOV	E,C
	MOV	D,B
	MVI	C,0
	CALL	fflo
	LDA	fac?
	ORA	A
	JZ	R?b
	ADI	16
	STA	fac?
R?b:	POP	B
	POP	D
	CALL	fadd@
	POP	PSW
	ORA	A
	CM	flneg@
	JMP	movrf@
Bf@Hc:	CALL	Bf@Bl
	XCHG
	JMP	c@sxt
Bf@Hu:	DS	0
Bf@Hi:	CALL	Bf@Bl
	XCHG
	RET
Bf@Bl:	MOV	A,B
	ORA	A
	JNZ	BfBl0
	MOV	C,A
	MOV	D,A
	MOV	E,A
	RET
BfBl0:
	LXI	H,0
	MOV	A,C
	XRI	80H
	JM	BfBl1
	MOV	C,A
	INR	H
BfBl1:	MOV	A,B
	CPI	128+32
	JNC	BfBlov
	CPI	128+24
	JC	BfBl2
	SUI	8
	MOV	B,A
	INR	L
BfBl2:	PUSH	H
	CALL	movfr@
	CALL	fint@
	MVI	B,0
	POP	H
	DCR	L
	JNZ	BfBl3
	MOV	B,C
	MOV	C,D
	MOV	D,E
	MVI	E,0
BfBl3:	DCR	H
	RNZ
	JMP	L@neg
BfBlov: LXI	B,7FFFH
	LXI	D,-1
	JMP	BfBl3
F@not:	LXI	H,1
	MOV	A,B
	ORA	A
	RNZ
	DCR	L
	RET
flt@0:	MOV	A,B
	ORA	A
	RET
f?stak: DS	0
I@@F:	XTHL
	PUSH	H
	LXI	H,Hi@Bf
	JMP	C@1632
C@@F:	XTHL
	PUSH	H
	LXI	H,Hc@Bf
	JMP	C@1632
U@@F:	XTHL
	PUSH	H
	LXI	H,Hu@Bf
	JMP	C@1632
F@@C:	PUSH	H
	LXI	H,Bf@Hc
	JMP	C@3216
F@@U:	PUSH	H
	LXI	H,Bf@Hu
	JMP	C@3216
F@@I:	PUSH	H
	LXI	H,Bf@Hi
	JMP	C@3216
L@@F:	XRA	A
	JMP	C3232
F@@L:	MVI	A,1
C3232:	PUSH	B
	PUSH	D
	PUSH	H
	LXI	H,her@32
	PUSH	H
	LXI	H,10
	DAD	SP
	CALL	movrm@
	ORA	A
	JZ	Bl@Bf
	JMP	Bf@Bl
	RET
@tmvb:	DW	-27009,-26600
@umvb:	DW	9216,-27532
digc??: DB	0
fmtc??: DB	0
@vmvb:	DW	16960,15,-31072,1,10000,0,1000,0
	DW	100,0,10,0,1,0
@wmvb:	DW	9216,-27788,20480,-28605,16384,-29412,0,-30342
	DW	0,-31160,0,-31968,0,32768,-13107,31820
	DW	-10486,31011,4718,30211,-18666,29265,-14933,28455
	DW	-16493,27478,-13194,26667
ftoa:	LXI	H,8
	DAD	SP
	CALL	h@
	MOV	A,L
	STA	digc??
	LXI	H,10
	DAD	SP
	CALL	g@
	MOV	A,L
	STA	fmtc??
	LXI	H,4
	DAD	SP
	CALL	movrm@
	CALL	movfr@
	POP	D
	POP	H
	PUSH	H
	PUSH	D
	CALL	sign@
	JP	fout1
	MVI	M,'-'
	INX	H
fout1:	MVI	M,'0'
	JZ	fout19a
	PUSH	H
	CM	flneg@
	LDA	fmtc??
	ANI	0137Q
	CPI	'E'
	JZ	fout41
	LDA	digc??
	ADI	6
	CALL	f@round
fout41: XRA	A
	PUSH	PSW
	CALL	foutcb
fout3:	DS	0
	LXI	H,@umvb
	CALL	llong@
	CALL	fcomp@
	ORA	A
	JP	fout5
	CALL	mul10@
	POP	PSW
	DCR	A
	PUSH	PSW
	JMP	fout3
foutcb: DS	0
	LXI	H,@tmvb
	CALL	llong@
	CALL	fcomp@
	ORA	A
	POP	H
	JPO	fout9
	PCHL
fout9:	CALL	div10@
	POP	PSW
	INR	A
	PUSH	PSW
	CALL	foutcb
fout5:	LDA	fmtc??
	ANI	0137Q
	CPI	'E'
	JNZ	fout5a
	LDA	digc??
	CALL	f@round
	CALL	foutcb
fout5a: MVI	A,1
	CALL	qint@
	CALL	movfr@
	POP	PSW
	POP	H
	ADI	7-1
	MOV	C,A
	LDA	fmtc??
	ANI	0137Q
	CPI	'E'
	MVI	B,2
	MOV	A,C
	JZ	fout6
	ADI	2
	MOV	B,A
	MVI	A,0
	JZ	fout6a
	JP	fout6
fout6a: MVI	M,DECPNT
	INX	H
	LDA	digc??
	DCR	B
fout32: MVI	M,'0'
	INX	H
	DCR	A
	JZ	fout17
	INR	B
	JM	fout32
	MVI	B,0
	STA	digc??
	XRA	A
fout6:	PUSH	PSW
	LDA	digc??
	PUSH	PSW
	MVI	C,7
	XCHG
	LXI	H,@vmvb
	XCHG
fout8:	DCR	C
	JM	fout8b
	DCR	B
	JM	fout8g
	JNZ	fout8f
	MVI	M,DECPNT
	INX	H
fout8g: POP	PSW
	DCR	A
	JM	fout1V	C,A
	RET
cf@le:	CALL	relopf
	JP	ftrue
ffalse: DCR	L
	RET
cf@lt:	CALL	relopf
	DCR	A
	JNZ	ffalse
ftrue:	INR	A
	RET
cf@ge:	CALL	relopf
	DCR	A
	RM
	DCR	L
	RET
cf@gt:	CALL	relopf
	RM
	DCR	L
	RET
relopf:
	CALL	movfr@
	POP	B
	POP	H
	POP	D
	XTHL
	PUSH	B
	MOV	B,H
	MOV	C,L
	CALL	fcomp@
	LXI	H,1
	ORA	A
	RET
cf@eq:	CALL	cf@zro
	JNC	eq@4
	JZ	cf@tru
cf@fls: DCR	E
cf@tru: POP	H
	POP	B
	XTHL
	XCHG
	DCR	L
	RET
cf@ne:	CALL	cf@zro
	JNC	neq@4
	JZ	cf@fls
	JMP	cf@tru
cf@zro: XRA	A
	LXI	H,7
	DAD	SP
	ORA	B
	JZ	zer1
	XRA	A
	ORA	M
	RNZ
	INR	A
zer1:	ORA	M
	STC
	LXI	D,2
	RET
fsub:	CALL	flneg@
fadd@:	MOV	A,B
	ORA	A
	RZ
	LDA	fac?
	ORA	A
	JZ	movfr@
	SUB	B
	JNC	fadd1
	CMA
	INR	A
	XCHG
	CALL	pushf@
	XCHG
	CALL	movfr@
	POP	B
	POP	D
fadd1:	CPI	25
	RNC
	PUSH	PSW
	CALL	unpack
	MOV	H,A
	POP	PSW
	CALL	shiftr
	ORA	H
	LXI	H,facl?
	JP	fadd3
	CALL	fadda@
	JNC	round
	INX	H
	INR	M
	CZ	overr
	MVI	L,1
	CALL	shradd
	JMP	round
fadd3:	XRA	A
	SUB	B
	MOV	B,A
	MOV	A,M
	SBB	E
	MOV	E,A
	INX	H
	MOV	A,M
	SBB	D
	MOV	D,A
	INX	H
	MOV	A,M
	SBB	C
	MOV	C,A
fadflt: CC	negr
normal: MOV	L,B
	MOV	H,E
	XRA	A
norm1:	MOV	B,A
	MOV	A,C
	ORA	A
	JNZ	norm3
	MOV	C,D
	MOV	D,H
	MOV	H,L
	MOV	L,A
	MOV	A,B
	SUI	8
	CPI	0E0H
	JNZ	norm1
zero@:	XRA	A
zero0:	STA	fac?
	RET
norm2:	DCR	B
	DAD	H
	MOV	A,D
	RAL
	MOV	D,A
	MOV	A,C
	ADC	A
	MOV	C,A
norm3:	JP	norm2
	MOV	A,B
	MOV	E,H
	MOV	B,L
	ORA	A
	JZ	round
	LXI	H,fac?
	ADD	M
	MOV	M,A
	JNC	zero@
	RZ
round:	MOV	A,B
roundb: LXI	H,fac?
	ORA	A
	CM	rounda
	MOV	B,M
	INX	H
	MOV	A,M
	ANI	80H
	XRA	C
	MOV	C,A
	JMP	movfr@
rounda: INR	E
	RNZ
	INR	D
	RNZ
	INR	C
	RNZ
	MVI	C,80H
	INR	M
	RNZ
overr1: JMP	overr
fadda@: MOV	A,M
	ADD	E
	MOV	E,A
	INX	H
	MOV	A,M
	ADC	D
	MOV	D,A
	INX	H
	MOV	A,M
	ADC	C
	MOV	C,A
	RET
negr:	LXI	H,fac?1
	MOV	A,M
	CMA
	MOV	M,A
	XRA	A
	MOV	L,A
	SUB	B
	MOV	B,A
	MOV	A,L
	SBB	E
	MOV	E,A
	MOV	A,L
	SBB	D
	MOV	D,A
	MOV	A,L
	SBB	C
	MOV	C,A
	RET
shiftr: MVI	B,0
shftr1: SUI	8
	JC	shftr2
	MOV	B,E
	MOV	E,D
	MOV	D,C
	MVI	C,0
	JMP	shftr1
shftr2: ADI	9
	MOV	L,A
shftr3: XRA	A
	DCR	L
	RZ
	MOV	A,C
shradd: RAR
	MOV	C,A
	MOV	A,D
	RAR
	MOV	D,A
	MOV	A,E
	RAR
	MOV	E,A
	MOV	A,B
	RAR
	MOV	B,A
	JMP	shftr3
fmult3: MOV	B,E
	MOV	E,D
	MOV	D,C
	MOV	C,A
	RET
fmult:	CALL	sign@
	RZ
	MVI	L,0
	CALL	muldiv
	MOV	A,C
	STA	fmlt?1
	XCHG
	SHLD	fmlt?2
	LXI	B,0
	MOV	D,B
	MOV	E,B
	LXI	H,normal
	PUSH	H
	LXI	H,fmult2
	PUSH	H
	PUSH	H
	LXI	H,facl?
fmult2: MOV	A,M
	INX	H
	ORA	A
	JZ	fmult3
	PUSH	H
	MVI	L,8
fmult4: RAR
	MOV	H,A
	MOV	A,C
	JNC	fmult5
	PUSH	H
	LHLD	fmlt?2
	DAD	D
	XCHG
	POP	H
	LDA	fmlt?1
	ADC	C
fmult5: RAR
	MOV	C,A
	MOV	A,D
	RAR
	MOV	D,A
	MOV	A,E
	RAR
	MOV	E,A
	MOV	A,B
	RAR
	MOV	B,A
	DCR	L
	MOV	A,H
	JNZ	fmult4
pophrt: POP	H
	RET
div10@: CALL	pushf@
	LXI	B,8420H
	LXI	D,0000H
	CALL	movfr@
fdivt:	POP	B
	POP	D
fdiv:	CALL	sign@
	CZ	dv0err
	MVI	L,0FFH
	CALL	muldiv
	INR	M
	INR	M
	DCX	H
	MOV	A,M
	STA	fdiv?a
	DCX	H
	MOV	A,M
	STA	fdiv?b
	DCX	H
	MOV	A,M
	STA	fdiv?c
	MOV	B,C
	XCHG
	XRA	A
	MOV	C,A
	MOV	D,A
	MOV	E,A
	STA	fdiv?g
fdiv1:	PUSH	H
	PUSH	B
	MOV	A,L
fdivc:
	PUSH	H
	LXI	H,fdiv?c
	SUB	M
	POP	H
	MOV	L,A
	MOV	A,H
fdivb:
	PUSH	H
	LXI	H,fdiv?b
	SBB	M
	POP	H
	MOV	H,A
	MOV	A,B
fdiva:
	PUSH	H
	LXI	H,fdiv?a
	SBB	M
	POP	H
	MOV	B,A
fdivg:
	LDA	fdiv?g
	SBI	0
	CMC
	JNC	fdiv2
	STA	fdiv?g
	POP	PSW
	POP	PSW
	STC
	DB	0D2H
fdiv2:	POP	B
	POP	H
	MOV	A,C
	INR	A
	DCR	A
	RAR
	JM	roundb
	RAL
	MOV	A,E
	RAL
	MOV	E,A
	MOV	A,D
	RAL
	MOV	D,A
	MOV	A,C
	RAL
	MOV	C,A
	DAD	H
	MOV	A,B
	RAL
	MOV	B,A
	LDA	fdiv?g
	RAL
	STA	fdiv?g
	MOV	A,C
	ORA	D
	ORA	E
	JNZ	fdiv1
	PUSH	H
	LXI	H,fac?
	DCR	M
	POP	H
	CZ	overr
	JNZ	fdiv1
muldiv: MOV	A,B
	ORA	A
	JZ	muldv2
	MOV	A,L
	LXI	H,fac?
	XRA	M
	ADD	B
	MOV	B,A
	RAR
	XRA	B
	MOV	A,B
	JP	muldv1
	ADI	80H
	MOV	M,A
	JZ	pophrt
	CALL	unpack
	MOV	M,A
dcxhrt: DCX	H
	RET
mldvex: CALL	sign@
	CMA
	POP	H
muldv1: ORA	A
muldv2: POP	H
	CM	overr
	JMP	zero@
mul10@: CALL	movrf@
	MOV	A,B
	ORA	A
	RZ
	ADI	2
	CC	overr
	MOV	B,A
	CALL	fadd@
	LXI	H,fac?
	INR	M
	RNZ
	JMP	overr
sign@:	LDA	fac?
	ORA	A
	RZ
signc:	LDA	facl?2
	DB	(CPI)
fcomps: CMA
	RAL
	SBB	A
	RNZ
inrart: INR	A
	RET
fflo:	MVI	B,98H
	MOV	A,C
	JMP	floatr
float@: MVI	B,88H
	LXI	D,0000H
floatr: LXI	H,fac?
	MOV	C,A
	MOV	M,B
	MVI	B,0
	INX	H
	MVI	M,80H
	RAL
	JMP	fadflt
flneg@: LXI	H,facl?2
	MOV	A,M
	XRI	80H
	MOV	M,A
	RET
pushf@: XCHG
	LHLD	facl?IC	makfcb

makfcb:	DS	0
;#asm
	POP B
	POP H
	POP D
	PUSH D
	PUSH H
	PUSH B
;#endasm
	CALL	x0fcb
	RET

	PUBLIC	max

max:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	POP	D
	CALL	c@gt
	EXTRN	c@gt
	JZ	@ad
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	JMP	@bd
@ad:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
@bd:	RET

	PUBLIC	min

min:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	POP	D
	CALL	c@lt
	EXTRN	c@lt
	JZ	@cd
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	JMP	@dd
@cd:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
@dd:	RET

	PUBLIC	strcat

strcat:	DS	0
@ed:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	MOV	A,M
	ORA	A
	JZ	@fd
	LXI	H,4
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	INX	H
	CALL	q@
	EXTRN	q@
	JMP	@ed
@fd:	DS	0
@gd:	LXI	H,4
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	INX	H
	CALL	q@
	EXTRN	q@
	DCX	H
	PUSH	H
	LXI	H,4
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	INX	H
	CALL	q@
	EXTRN	q@
	DCX	H
	MOV	L,M
	MVI	H,0
	POP	D
	MOV	A,L
	STAX	D
	MOV	A,H
	ORA	L
	JZ	@hd
	JMP	@gd
@hd:	RET

	PUBLIC	strcmp

strcmp:	DS	0
;#asm
	POP	B	; return address
	POP	H	; get first string (str2)
	POP	D	; get second string (str1)
	PUSH	D	; restore stack for caller
	PUSH	H
	PUSH	B
SCLOOP: LDAX	D	; get next byte from second string
	CMP	M	; compare that with first string
	JNZ	SCDIFF	; they didn't compare
	INX	D	; increment both pointers
	INX	H
	ORA	A	; both the same.  see if both zero
	JNZ	SCLOOP	; nope.  get the next ones
	LXI	H,0	; yup.	they matched all the way to the null
	JMP	SCRET	; unified return for timing
SCDIFF: LXI	H,-1	;
	JC	SCRET	; first string < second string
	LXI	H,1	; first string > second string
SCRET:	DS	0	; unified return
;#endasm
	RET

	PUBLIC	strcpy

strcpy:	DS	0
;#asm
	POP	B	; return address
	POP	H	; get from arg
	POP	D	; get to arg
	PUSH	D	; restore stack for caller
	PUSH	H
	PUSH	B
	DCX	H	; back off for a running start
STLOOP: INX	H	; point at next FROM char
	MOV	A,M	; put it into accumulator
	STAX	D	; store it in TO string
	INX	D	; increment TO string
	ORA	A	; check for last char
	JNZ	STLOOP	; copied the 0 byte.  Go away.
;#endasm
	RET

	PUBLIC	strlen

strlen:	DS	0
;#asm
	POP	B	; return address
	POP	D	; the string
	PUSH	D	; restore stack
	PUSH	B
	LXI	H,0	; initialize length
SLLOOP: LDAX	D	; get next char
	ORA	A	; test for zero
	JZ	SLDONE	; end of string
	INX	D	; point at next character
	INX	H	; increment counter
	JMP	SLLOOP	; and around again
SLDONE: DS	0	; fall through for timer
;#endasm
	RET

	PUBLIC	tolower

tolower:	DS	0
;#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	XRI 20H
	MOV L,A
;#endasm
	RET

	PUBLIC	toupper

toupper:	DS	0
;#asm
	LXI H,2
	DAD SP
	MOV L,M
	MVI H,0
	MOV A,L
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	XRI 20H
	MOV L,A
;#endasm
	RET
	EXTRN	sbrk
	EXTRN	getchar
	EXTRN	x0fcb
	EXTRN	g@
	END
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее* Floating point library; C/80 3.0 (7/7/83) - (c) 1983 Walter Bilofsky
* Rev. for DRI ASM's 5-2-85 drm

	public I@@F,C@@F,U@@F,F@@C,F@@U,F@@I,L@@F,F@@L
	public facl?,facl?1,facl?2,fac?,fac?1,save?,fmlt?1,fmlt?2
	public dum?,save?1,fdiv?a,fdiv?b,fdiv?c,fdiv?g,flt?pk
	public R?b,f?stak,digc??,fmtc??

	extrn L?adsb,I?long,l?stak,Four?b
	extrn movrm@,llong@,C@1632,her@32,L@@C,L@@U,L@@I,C@3216
	extrn L?shif,L?comp,L?mdiv

facl?:	DB	0
facl?1: DB	0
facl?2: DB	0
fac?:	DB	0
fac?1:	DB	0
save?:	DB	0
fmlt?1: DB	0
fmlt?2: DB	0
dum?:	DB	0
save?1: DB	0
errcod: DB	0
fdiv?a: DB	0
fdiv?b: DB	0
fdiv?c: DB	0
fdiv?g: DB	0
flt?pk: DS	0
F@add:	XRA	A
	JMP	Dual
F@sub:	MVI	A,1
	JMP	Dual
F@mul:	MVI	A,2
	JMP	Dual
F@div:	MVI	A,3
Dual:	CALL	movfr@
	POP	H
	POP	D
	POP	B
	PUSH	H
	LXI	H,movrf@
	PUSH	H
	LXI	H,Ftab
Fexecl: ORA	A
	JZ	Fexec
	DCR	A
	INX	H
	INX	H
	JMP	Fexecl
Fexec:	MOV	A,M
	INX	H
	MOV	H,M
	MOV	L,A
	PCHL
Ftab:	DW	fadd@
	DW	fsub
	DW	fmult
	DW	fdiv
F@neg:	MOV	A,C
	XRI	80H
	MO
	DSEG
@hb:	DW	0
@ib:	DW	0
	CSEG

atoi:	LXI	H,1
	SHLD	@ib
	LXI	H,0
	SHLD	@hb
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	MOV	L,M
	MVI	H,0
	JMP	@kb
@lb:	LXI	H,-1
	SHLD	@ib
@mb:	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	INX	H
	CALL	q@
	EXTRN	q@
	JMP	@jb
@kb:	CALL	@switch
	EXTRN	@switch
	DW	@lb,45
	DW	@mb,43
	DW	0
@jb:	DS	0
@nb:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	MOV	L,M
	MVI	H,0
	LXI	D,48
	CALL	c@le
	EXTRN	c@le
	JZ	@pb
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	MOV	L,M
	MVI	H,0
	LXI	D,57
	CALL	c@ge
	EXTRN	c@ge
@pb:	CALL	e@0
	EXTRN	e@0
	JZ	@ob
	LHLD	@hb
	LXI	D,10
	CALL	c@mult
	EXTRN	c@mult
	PUSH	H
	LXI	H,4
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	INX	H
	CALL	q@
	EXTRN	q@
	DCX	H
	MOV	L,M
	MVI	H,0
	POP	D
	DAD	D
	LXI	D,-48
	DAD	D
	SHLD	@hb
	JMP	@nb
@ob:	LHLD	@ib
	XCHG
	LHLD	@hb
	CALL	c@mult
	EXTRN	c@mult
	RET

	PUBLIC	bdos

bdos:	DS	0
;#asm
	extrn bdose
	POP H
	POP D		; Get arguments into d
	POP B		; and b.
	PUSH B		; Restore stack.
	PUSH D
	PUSH H
	CALL bdose	; Call BDOS.
			; Return value from HL.
;#endasm
	RET

	PUBLIC	getline
	DSEG
@qb:	DW	0
	CSEG

getline:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	SHLD	@qb
@tb:	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	DCX	H
	CALL	q@
	EXTRN	q@
	LXI	D,0
	CALL	c@lt
	EXTRN	c@lt
	JZ	@ub
	LHLD	@qb
	PUSH	H
	CALL	getchar
	POP	D
	MOV	A,L
	STAX	D
	LXI	D,-10
	DAD	D
	CALL	e@0
	EXTRN	e@0
@ub:	CALL	e@0
	EXTRN	e@0
	JZ	@vb
	LHLD	@qb
	MOV	L,M
	MVI	H,0
	INX	H
	CALL	e@0
	EXTRN	e@0
@vb:	CALL	e@0
	EXTRN	e@0
	JZ	@sb
	JMP	@wb
@rb:	LHLD	@qb
	INX	H
	SHLD	@qb
	JMP	@tb
@wb:	JMP	@rb
@sb:	LHLD	@qb
	MVI	M,0
	LHLD	@qb
	PUSH	H
	LXI	H,6
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	s@
	EXTRN	s@
	RET

	PUBLIC	index
	DSEG
@xb:	DW	0
@yb:	DW	0
@zb:	DW	0
	CSEG

index:	LXI	H,0
	SHLD	@xb
@cc:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	XCHG
	LHLD	@xb
	DAD	D
	MOV	L,M
	MVI	H,0
	MOV	A,H
	ORA	L
	JZ	@bc
	JMP	@dc
@ac:	LHLD	@xb
	INX	H
	SHLD	@xb
	DCX	H
	JMP	@cc
@dc:	LHLD	@xb
	SHLD	@yb
	LXI	H,0
	SHLD	@zb
@gc:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	XCHG
	LHLD	@zb
	DAD	D
	MOV	L,M
	MVI	H,0
	CALL	e@0
	EXTRN	e@0
	JZ	@hc
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	XCHG
	LHLD	@yb
	DAD	D
	MOV	L,M
	MVI	H,0
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	XCHG
	LHLD	@zb
	DAD	D
	MOV	L,M
	MVI	H,0
	CALL	e@
	EXTRN	e@
@hc:	CALL	e@0
	EXTRN	e@0
	JZ	@fc
	JMP	@ic
@ec:	LHLD	@yb
	INX	H
	SHLD	@yb
	LHLD	@zb
	INX	H
	SHLD	@zb
	JMP	@gc
@ic:	JMP	@ec
@fc:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	XCHG
	LHLD	@zb
	DAD	D
	MOV	L,M
	MVI	H,0
	MOV	A,H
	ORA	L
	JNZ	@jc
	LHLD	@xb
	RET
@jc:	JMP	@ac
@bc:	LXI	H,-1
	RET

	PUBLIC	isalpha

isalpha:	DS	0
;#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'z'+1
	RNC
	INR L
	CPI 'a'
	RNC
	CPI 'Z'+1
	RC
	DCR L
;#endasm
	RET

	PUBLIC	isdigit

isdigit:	DS	0
;#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI '0'
	RC
	CPI '9'+1
	RNC
	INR L
;#endasm
	RET

	PUBLIC	islower

islower:	DS	0
;#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'a'
	RC
	CPI 'z'+1
	RNC
	INR L
;#endasm
	RET

	PUBLIC	isspace

isspace:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	JMP	@lc
@mc:	DS	0
@nc:	DS	0
@oc:	LXI	H,1
	RET
	JMP	@kc
@lc:	CALL	@switch
	EXTRN	@switch
	DW	@mc,32
	DW	@nc,9
	DW	@oc,10
	DW	0
@kc:	LXI	H,0
	RET

	PUBLIC	isupper

isupper:	DS	0
;#asm
	LXI H,2
	DAD SP
	MOV A,M
	LXI H,0
	CPI 'A'
	RC
	CPI 'Z'+1
	RNC
	INR L
;#endasm
	RET

	PUBLIC	itoa
	DSEG
@pc:	DW	0
@qc:	DW	0
@rc:	DW	0
@sc:	DW	0
	CSEG

itoa:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	SHLD	@qc
	LXI	D,0
	CALL	c@gt
	EXTRN	c@gt
	JZ	@tc
	LHLD	@qc
	CALL	c@neg
	EXTRN	c@neg
	SHLD	@qc
@tc:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	SHLD	@rc
	SHLD	@sc
@wc:	LHLD	@rc
	INX	H
	SHLD	@rc
	DCX	H
	PUSH	H
	LHLD	@qc
	XCHG
	LXI	H,10
	CALL	c@div
	EXTRN	c@div
	XCHG
	LXI	D,48
	DAD	D
	POP	D
	MOV	A,L
	STAX	D
@uc:	LHLD	@qc
	XCHG
	LXI	H,10
	CALL	c@div
	EXTRN	c@div
	SHLD	@qc
	MOV	A,H
	ORA	L
	JNZ	@wc
@vc:	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	LXI	D,32768
	CALL	c@tst
	EXTRN	c@tst
	JC	@xc
	LHLD	@rc
	INX	H
	SHLD	@rc
	DCX	H
	MVI	M,45
@xc:	LHLD	@rc
	MVI	M,0
@yc:	LHLD	@rc
	DCX	H
	SHLD	@rc
	XCHG
	LHLD	@sc
	CALL	c@ugt
	EXTRN	c@ugt
	JZ	@zc
	LHLD	@sc
	MOV	L,M
	MVI	H,0
	SHLD	@pc
	LHLD	@sc
	INX	H
	SHLD	@sc
	DCX	H
	PUSH	H
	LHLD	@rc
	MOV	L,M
	MVI	H,0
	POP	D
	MOV	A,L
	STAX	D
	LHLD	@rc
	PUSH	H
	LHLD	@pc
	POP	D
	MOV	A,L
	STAX	D
	JMP	@yc
@zc:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	RET

	PUBLееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;C/80 Compiler 3@1 (4/11/84) - (c) 1984 The Software Toolworks


	PUBLIC	rename
	CSEG

rename:	LXI	H,-54
	DAD	SP
	SPHL
	LXI	H,56
	DAD	SP
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,2
	DAD	SP
	LXI	D,16
	DAD	D
	PUSH	H
	CALL	makfcb
	POP	B
	POP	B
	LXI	H,58
	DAD	SP
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	makfcb
	POP	B
	POP	B
	LXI	H,26
	PUSH	H
	LXI	H,128
	PUSH	H
	CALL	bdos
	POP	B
	POP	B
	LXI	H,23
	PUSH	H
	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	bdos
	POP	B
	POP	B
@d:	XCHG
	LXI	H,54
	DAD	SP
	SPHL
	XCHG
	RET

	PUBLIC	unlink

unlink:	LXI	H,-36
	DAD	SP
	SPHL
	LXI	H,38
	DAD	SP
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	makfcb
	POP	B
	POP	B
	LXI	H,26
	PUSH	H
	LXI	H,128
	PUSH	H
	CALL	bdos
	POP	B
	POP	B
	LXI	H,19
	PUSH	H
	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	bdos
	POP	B
	POP	B
@e:	LXI	H,36
	DAD	SP
	SPHL
	RET

	PUBLIC	abs

abs:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	LXI	D,0
	CALL	c@gt
	EXTRN	c@gt
	JZ	@f
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	c@neg
	EXTRN	c@neg
	JMP	@g
@f:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
@g:	RET
@h:	DW	0,-1

	PUBLIC	alloc
	DSEG
@i:	DW	0
@j:	DW	0
@k:	DW	0
	CSEG

alloc:	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	INX	H
	INX	H
	CALL	q@
	EXTRN	q@
	LXI	D,4
	CALL	c@ugt
	EXTRN	c@ugt
	JZ	@l
	LXI	H,2
	DAD	SP
	MVI	M,4
	INX	H
	MVI	M,0
@l:	DS	0
@o:	LXI	H,@h
	SHLD	@i
@r:	LHLD	@i
	INX	H
	INX	H
	CALL	h@
	EXTRN	h@
	SHLD	@j
	INX	H
	CALL	e@0
	EXTRN	e@0
	JZ	@q
	JMP	@s
@p:	LHLD	@j
	SHLD	@i
	JMP	@r
@s:	LHLD	@j
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	POP	D
	CALL	c@uge
	EXTRN	c@uge
	JZ	@t
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	LXI	D,4
	DAD	D
	PUSH	H
	LHLD	@j
	CALL	h@
	EXTRN	h@
	POP	D
	CALL	c@ule
	EXTRN	c@ule
	JZ	@u
	LHLD	@i
	INX	H
	INX	H
	PUSH	H
	LHLD	@j
	XCHG
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	DAD	D
	CALL	q@
	EXTRN	q@
	SHLD	@i
	LHLD	@i
	PUSH	H
	LHLD	@j
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,6
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	s@
	EXTRN	s@
	CALL	q@
	EXTRN	q@
	LHLD	@j
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	q@
	EXTRN	q@
@u:	LHLD	@i
	INX	H
	INX	H
	PUSH	H
	LHLD	@j
	INX	H
	INX	H
	CALL	h@
	EXTRN	h@
	CALL	q@
	EXTRN	q@
	LHLD	@j
	INX	H
	INX	H
	RET
@t:	JMP	@p
@q:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	LXI	D,1024
	CALL	c@ugt
	EXTRN	c@ugt
	JZ	@w
	LXI	H,1024
	JMP	@x
@w:	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
@x:	SHLD	@k
	PUSH	H
	CALL	sbrk
	POP	B
	SHLD	@i
	INX	H
	CALL	c@not
	EXTRN	c@not
	JZ	@v
	LXI	H,-1
	RET
@v:	LHLD	@i
	PUSH	H
	LHLD	@k
	CALL	q@
	EXTRN	q@
	LHLD	@i
	INX	H
	INX	H
	PUSH	H
	CALL	free
	POP	B
	JMP	@o
@n:	RET

	PUBLIC	free
	DSEG
@y:	DW	0
@z:	DW	0
	CSEG

free:	LXI	H,2
	DAD	SP
	PUSH	H
	CALL	h@
	EXTRN	h@
	DCX	H
	DCX	H
	CALL	q@
	EXTRN	q@
	LXI	H,@h
	SHLD	@y
@cb:	LHLD	@y
	INX	H
	MOV	A,H
	ORA	L
	JZ	@bb
	JMP	@db
@ab:	LHLD	@z
	SHLD	@y
	JMP	@cb
@db:	LHLD	@y
	INX	H
	INX	H
	CALL	h@
	EXTRN	h@
	SHLD	@z
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	POP	D
	CALL	c@ugt
	EXTRN	c@ugt
	JZ	@eb
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	h@
	EXTRN	h@
	XCHG
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	DAD	D
	PUSH	H
	LHLD	@z
	CALL	e@
	EXTRN	e@
	JZ	@fb
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	PUSH	H
	CALL	h@
	EXTRN	h@
	PUSH	H
	LHLD	@z
	CALL	h@
	EXTRN	h@
	POP	D
	DAD	D
	CALL	q@
	EXTRN	q@
	LHLD	@z
	INX	H
	INX	H
	CALL	h@
	EXTRN	h@
	SHLD	@z
@fb:	LHLD	@y
	CALL	h@
	EXTRN	h@
	XCHG
	LHLD	@y
	DAD	D
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	e@
	EXTRN	e@
	JZ	@gb
	LHLD	@y
	PUSH	H
	CALL	h@
	EXTRN	h@
	PUSH	H
	LXI	H,6
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	h@
	EXTRN	h@
	POP	D
	DAD	D
	CALL	q@
	EXTRN	q@
	LXI	H,2
	DAD	SP
	PUSH	H
	LHLD	@y
	CALL	q@
	EXTRN	q@
@gb:	LHLD	@y
	INX	H
	INX	H
	PUSH	H
	LXI	H,4
	DAD	SP
	CALL	h@
	EXTRN	h@
	CALL	q@
	EXTRN	q@
	LXI	H,2
	DAD	SP
	CALL	h@
	EXTRN	h@
	INX	H
	INX	H
	PUSH	H
	LHLD	@z
	CALL	q@
	EXTRN	q@
	RET
@eb:	JMP	@ab
@bb:	RET

	PUBLIC	atoi { ln = ln * radix + x;
				       advCHR();
				       if(--width == 0) break;
				     } /* end while */
				  if(sign - 1) ln = -ln;
				  if (hadany == 0) goto quit;
				  if(NOsupr) (*STKtop)->l = ln;
				  break;
			     case 'e':	/* double is an error */
			     case 'f':
			     default:  goto quit;
			   } /* end switch */
			 break;
#endif
/* float code */
#ifndef NOFLOAT
	       case 'e':
	       case 'f': skipBL(); p = strBUF;
			 if(width > 20) width = 20;
			 while((x = nxtCHR()) != -1)
			      { if(index("0123456789.-+Ee",x) )
				  { *p++ = x; advCHR();}
				else break;
				if(--width == 0) break;
			      } /* end while */
			 *p = '\0';
			 if (hadany == 0) goto quit;
			 if (NOsupr) (*STKtop)->f = atof(strBUF);
			 break;
#endif
	       default:  goto quit;
	     } /* end switch case */
	     n += NOsupr;
	} /* end while */
quit:
 if(memory) return n;			/* no end of file for a string */
 while((x = nxtCHR()) != -1)
      { if(x == '\n') break;		/* normal with linefeed terminator */
	if(Isspace(x)) advCHR();	/* delete trailing blanks */
	else { ungetc(x,chan);		/* put last char back on input */
	       break;}
      } /* end while */
 return nxtCHR() != -1 ? n :		/* not at end of file */
			     -1;	/* return -1 for end of file */
} /* end function scanff() */

STK_pos(arg) int arg;
{ chan=memory=0; STKtop = &arg;}	/* find entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scan()
{ memory = *--STKtop; return scanff();}

/* definitions for multiple args */
#undef scanf
#undef fscanf
#undef sscanf
#define scanf STK_pos(),scan_f
#define fscanf STK_pos(),f_scan
#define sscanf STK_pos(),s_scan

/* end file SCANF.C */
f0) {
					p = p->next0 = pn + n;
					p->size0 = pn->size0 - n;
					pn->size0 = n; }
				p->next0 = pn->next0;
				return pn + PSIZE; }
		if ((p = sbrk(size = n < 1024 ? 1024 : n)) == -1) return -1;
		p->size0 = size;
		free(p + PSIZE);
	}	}

fееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/* isspace  -  is the input blank ?
*/
isspace(c)
{   switch (c) {
	case ' ': case '\t': case '\n': return 1; }
    return 0;
}

  -  is the input blank ?
*/
isspace(c)
{   switch (c) {
	case ' ': case '\t': case '\n': return 1; }
    return 	/* return -1 for end of file */
} /* end function scanff() */

STK_pos(arg) int arg;
{ chan=memory=0; STKtop = &arg;}	/* find entry stack level */

int scan_f()
{ return scanff();}

int f_scan()
{ chan = *--STKtop; return scanff();}

int s_scaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее char *str;
{ static char *p; p = str;
  while(*p) { if(*p - c) ++p; else return p;}
  return 0;}

/* Define white space for binary mode.	NOT the same as in stdlib.c */
static int Isspace(ch) char ch;
{ return (index("\40\t\r\n",ch) ? 1:0);}

static tolower(c) char c; {
	if (c >= 'A' && c <= 'Z') c += 'a' - 'A';
	return c; }

static int bufFLAG = 0,chan,radix,hadany,_keep;
static char *memory;
static union { char c; int i;
#ifndef NOLONG
	long l;
#endif
#ifndef NOFLOAT
	float f;
#endif
		} **STKtop;

static int nxtCHR()			/* get buffered char from input */
{ static int _keep;			 /* return -1 for end of file */
  if(bufFLAG) return _keep;		 /* or next input stream char */
  bufFLAG = -1;
  if(chan) return (_keep = getc(chan));
  if(memory) return (_keep = (*memory ? *memory++ : -1));
  return (_keep = getchar());
}

static advCHR() 			/* advance to next buffered char */
{ static i;
  if((i = nxtCHR()) != -1) { bufFLAG = 0;
		hadany = 1; }		/* tally to remember nr chars eaten */
  return i; }

static skipBL() 			/* skip over BLanks */
{ while( Isspace(nxtCHR()) ) advCHR();
  hadany = 0; } 			/* remember no chars eaten */

static int cvDIGIT(ch)			/* return value of digit or -1 */
{ static int z;
	if((z = ch) >= '0' && z <= '9') z -= '0';
  else	if((z &= 0137) >= 'A' && z <= 'F') z -= 'A' - 10;
  else	return (-1);
	if(z < radix) return z;
  return (-1);
}

static kill0x() 			/* kill 0x from hex string */
{ skipBL();
  if(nxtCHR() != '0') return;
  advCHR();
  if(tolower(nxtCHR()) == 'x') advCHR();
}

static char unchars[11] = {0,0,0,0,0,0,0,0,0,0,0};

ungetc(c,chan) {
	unchars[chan < 32 ? chan : chan - 25] = c; }

static int scanff(arg)			/* called by scanf, sscanf, fscanf */
char *arg;
{ static int n,NOsupr,sign,value,width,x,cc,*STKlow;
  static char *p,*q,*format;
  auto char strBUF[81];

#ifndef NOLONG
  static long ln;
#endif
#ifndef NOFLOAT
  float atof();
#endif
  bufFLAG = _keep = unchars[n = chan < 32 ? chan : chan - 25];
  n = unchars[n] = 0;
  STKlow = &arg;
  format = *--STKtop;
   while((cc = *format++) && nxtCHR() != -1)
	{ if(Isspace(cc)) continue;
	  if(cc == '%')
	    if(*format != '%') goto start; else ++format;
	  skipBL(); if(cc != nxtCHR() ) break; advCHR(); continue;
start:	  sign = NOsupr = 1;
	  if(*format == '*') { NOsupr = 0; ++format;}
	  else if(--STKtop == STKlow) goto quit;
	  width = 0; radix = 10;
	  while((x = cvDIGIT(cc = *format++)) != -1) width = width*radix + x;
	  switch(tolower(cc))
	     { case 'x': kill0x(); radix = 16; goto loop;
	       case 'o': radix = 8; goto loop;
	       case 'b': radix = 2; goto loop;
	       case 'h':
	       case 'd': skipBL(); if(nxtCHR() != '-') goto loop;
			 sign = -1; advCHR();
  loop:        case 'u': value = 0; skipBL();
			 while((x = cvDIGIT(nxtCHR())) != -1)
			      { value = value*radix + x;
				advCHR();
				if(--width == 0) break;
			      } /* end while */
			 if (hadany == 0) goto quit;	/* If no chars eaten */
			 if(NOsupr) (*STKtop)->i = sign*value;
			 break;
	       case 's': skipBL();
			 if(NOsupr) p = *STKtop;
			 while((x = nxtCHR()) != -1)
			      { if(Isspace(x)) break;
				advCHR();
				if(NOsupr) *p++ = x;
				if(--width); else break;
			      } /* end while */
			 if(NOsupr) *p = '\0';
			 if (hadany == 0) goto quit;	/* If no chars eaten */
			 break;
	       case 'c': if (nxtCHR() == -1) goto quit;
			 if(NOsupr) (*STKtop)->c = nxtCHR();
			 advCHR(); break;
	       case '[': sign = cc = 0;
			 if((x = *format++) == '^') { cc = 1; x = *format++;}
			 if((q = index(format,']')) == 0) goto quit;
			 p = strBUF;
			 while(format <= q && ++sign < 80)
			      { *p++ = x;
				if(*format == '-')
				  { ++format;
				    while(x < *format && ++sign < 80)
					 *p++ = ++x;
				  }
				x = *format++;
			      }
			 format = q+1; *p = '\0';

			 p = *STKtop;
			 while((x = nxtCHR()) != -1)
			      { q = index(strBUF,x);
				if((cc && q == 0) || (q && cc == 0))
				  { if(NOsupr) *p++ = x; advCHR();}
				else break;
			      }
			 if(NOsupr) *p = '\0';
			 break;
/* long integer code */
#ifndef NOLONG
	       case 'l': switch(tolower(*format++))
			   { case 'x': kill0x(); radix = 16;
				       goto loop1;
			     case 'o': radix = 8; goto loop1;
			     case 'b': radix = 2; goto loop1;
			     case 'd': skipBL();
				       if(nxtCHR() - '-');
				       else { sign = -1; advCHR();}
	  loop1:	     case 'u': skipBL();
				  ln = 0;
				  while((x = cvDIGIT(nxtCHR())) != -1)
				    5m512z9p2s40t1d0i7l
                                                                                                            